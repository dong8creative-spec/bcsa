# 카카오 로그인·회원가입 동작 확인 체크리스트

## 1. 환경 설정

| 구분 | 항목 | 확인 |
|------|------|------|
| 프론트 | `VITE_KAKAO_JS_KEY` (카카오 JavaScript 키) | `.env` 또는 배포 시 GitHub Secrets에 설정 |
| 프론트 | `VITE_API_URL` | 백엔드 주소 (예: `https://apibid-oytjv32jna-du.a.run.app`) |
| 백엔드 | `KAKAO_REST_API_KEY` (REST API 키) | Cloud Run/Functions 환경 변수 |
| 백엔드 | `FRONTEND_URL` | 콜백 후 리다이렉트할 프론트 주소 (예: `https://bcsa.co.kr`) |
| 로컬 테스트 시 | 백엔드 `FRONTEND_URL` | `http://127.0.0.1:5173` 등 로컬 주소로 설정 시 로컬에서 콜백 수신 가능 |

## 2. 카카오 개발자 콘솔

- [ ] **카카오 로그인** > **Redirect URI**에 아래가 **완전 동일**하게 등록됨  
  `https://apibid-oytjv32jna-du.a.run.app/api/auth/kakao/callback`
- [ ] **웹** 플랫폼 등록, 사이트 도메인에 사용하는 도메인(또는 로컬 시 `http://127.0.0.1:포트`) 포함

## 3. 동작 흐름 요약

**카카오 로그인**
1. 로그인 모달에서 "카카오로 로그인" 클릭
2. 카카오 인증 페이지 이동 → 로그인/동의
3. 카카오가 백엔드 `.../api/auth/kakao/callback?code=xxx` 로 리다이렉트
4. 백엔드가 code로 토큰·프로필 조회 후 `FRONTEND_URL/#auth=kakao&token=...&p=...` 로 리다이렉트
5. 프론트가 token으로 Firebase 로그인, Firestore에 없으면 프로필로 사용자 생성 후 로그인 처리

**카카오로 회원가입**
1. "가입하기" → "카카오로 회원가입" 클릭 (이때 `kakao_signup` 플래그 저장)
2. 위 2~4 동일
3. 프론트가 플래그 확인 후 `/signup?from=kakao` 로 이동, 프로필을 sessionStorage에 저장
4. 회원가입 페이지에서 이름·연락처·이메일 자동 입력(초록), 비밀번호 없이 나머지 입력 후 제출 → Firestore에 `uid`(카카오 커스텀 토큰 uid)로 사용자 문서 생성

## 4. 수동 테스트 순서

1. **로그인**
   - 이미 가입된 카카오 계정으로 "카카오로 로그인" 클릭
   - 카카오 로그인/동의 후 다시 우리 사이트로 돌아오는지
   - 로그인 성공 메시지 및 로그인 상태 반영 여부

2. **회원가입**
   - "가입하기" → "카카오로 회원가입" 클릭
   - 카카오 로그인/동의 후 `/signup?from=kakao` 로 이동하는지
   - 이름·연락처·이메일이 초록색으로 채워지는지
   - 비밀번호 칸이 없고, 회원 유형·주소 등만 입력하고 가입 가능한지
   - 가입 완료 후 홈으로 이동·로그인 상태인지

3. **미가입 계정으로 로그인 시**
   - "카카오로 로그인"으로 아직 가입 안 한 카카오 계정 사용
   - 우리 사이트로 돌아온 뒤 "가입되지 않은 카카오 계정입니다" 안내가 나오는지

## 5. 자주 나오는 문제

| 증상 | 확인할 것 |
|------|-----------|
| "invalid response" | Redirect URI가 콘솔에 등록된 값과 정확히 같은지, 로컬이면 사이트 도메인에 `http://127.0.0.1:포트` 포함 여부 |
| 콜백 후 흰 화면/토큰 안 먹음 | 백엔드 `FRONTEND_URL`이 실제 접속한 프론트 주소와 같은지 (로컬이면 `http://127.0.0.1:5173` 등) |
| "카카오 로그인이 설정되지 않았습니다" | 프론트 `.env`에 `VITE_KAKAO_JS_KEY` 있는지, 빌드/재시작 후 적용 여부 |
| server_config / no_token | 백엔드에 `KAKAO_REST_API_KEY` 설정되어 있는지 |
