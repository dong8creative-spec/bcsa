# 테스트 환경 조성

로컬에서 프론트엔드·API(입찰공고 등)를 실행하고 검증하기 위한 환경 설정 가이드입니다.

---

## 1. 사전 요구사항

| 항목 | 권장 |
|------|------|
| Node.js | 20.x (LTS) |
| npm | 10.x 이상 |
| Firebase CLI | `npm install -g firebase-tools` 후 `firebase --version` 확인 |

```bash
node -v   # v20.x
npm -v    # 10.x
firebase --version
```

---

## 2. 환경 변수

### 2.1 프론트엔드 (Vite)

프로젝트 루트의 **`.env.development`** 또는 **`.env.local`** 에서 API 주소를 지정합니다.

| 파일 | 용도 | 예시 |
|------|------|------|
| `.env.development` | 기본 개발/테스트 (배포 API 사용) | `VITE_API_URL=https://apibid-oytjv32jna-du.a.run.app` |
| `.env.local` | 로컬 Functions 에뮬레이터 사용 시 (우선 적용) | `VITE_API_URL=http://127.0.0.1:5001/bcsa-b190f/asia-northeast3/apiBid` |

- `.env.local` 이 있으면 Vite가 이를 우선 적용합니다.
- **배포 API로 테스트**: `.env.development` 만 두고 실행.
- **에뮬레이터로 테스트**: `.env.local` 에 에뮬레이터 URL 넣고, 에뮬레이터 실행 후 프론트 실행.

### 2.2 Functions (조달청 API 키)

**배포된 API**를 쓸 때도, **Firebase Functions 환경 변수**에 조달청 API 키가 있어야 검색이 됩니다.

- **배포 환경**: `functions/` 폴더에 **`.env`** 파일을 만들고 `G2B_API_KEY=발급받은키` 또는 `G2B_SERVICE_KEY=발급받은키` 를 넣은 뒤 **다시 배포** (`firebase deploy --only functions`).  
  (배포 시 .env 가 함께 전달됩니다. Firebase 콘솔에서 Functions 환경 변수로 설정해도 됩니다.)
- **에뮬레이터**: `functions/` 폴더의 **`.env`** 에 `G2B_API_KEY=발급받은키` 또는 `G2B_SERVICE_KEY=발급받은키` 를 넣습니다.

키가 없거나 잘못되면 **「조달청 API 호출 실패」** 가 나옵니다. 공공데이터포털에서 나라장터 입찰공고정보서비스 활용신청 후 인증키를 발급받아 설정하세요.

---

## 3. 테스트 환경 실행 방법

### 방법 A: 프론트만 (배포 API 사용) — 가장 간단

배포된 API를 쓰며, 별도 백엔드 실행 없이 프론트만 띄웁니다.

```bash
cd /Users/donghnc/Documents/bcsa
npm run dev
```

- 브라우저: **http://127.0.0.1:3000**
- API: `.env.development` 의 `VITE_API_URL` (배포 API)

### 방법 B: 프론트 + Functions 에뮬레이터 (로컬 API)

로컬에서 API까지 함께 테스트할 때 사용합니다.

**1) 로컬 API 주소 설정**

`.env.local` 파일을 만들고 에뮬레이터 주소를 넣습니다.

```bash
# 프로젝트 루트에 .env.local 생성
echo 'VITE_API_URL=http://127.0.0.1:5001/bcsa-b190f/asia-northeast3/apiBid' > .env.local
```

**2) 터미널 1 — Functions 에뮬레이터**

```bash
cd /Users/donghnc/Documents/bcsa
firebase emulators:start --only functions
```

- API: **http://127.0.0.1:5001** (에뮬레이터)
- `functions/.env` 에 `G2B_API_KEY` 등이 있어야 조달청 API 호출 가능.

**3) 터미널 2 — 프론트**

```bash
cd /Users/donghnc/Documents/bcsa
npm run dev
```

- 브라우저: **http://127.0.0.1:3000**
- 프론트는 `.env.local` 의 `VITE_API_URL` 로 로컬 API를 호출합니다.

### 방법 C: 한 번에 실행 (스크립트)

**프론트만** 띄울 때:

```bash
./start-test.sh
# 또는
./start-local.sh
# 또는 (안내 + 개발 서버)
npm run test:env
```

- 포트 3000 사용, 필요 시 5173 등으로 대체.

**프론트 + Functions 에뮬레이터를 한 번에** 띄울 때:

1. `.env.local` 에 `VITE_API_URL=http://127.0.0.1:5001/bcsa-b190f/asia-northeast3/apiBid` 설정
2. 실행:

```bash
npm run test:env:emulator
```

- 프론트와 에뮬레이터가 동시에 실행됩니다. 브라우저는 http://127.0.0.1:3000 으로 접속합니다.

---

## 4. npm 스크립트 정리

| 스크립트 | 설명 |
|----------|------|
| `npm run dev` | Vite 개발 서버 (기본 포트 3000) |
| `npm run test` | Vite 개발 서버 (포트 5173, 127.0.0.1) |
| `npm run test:env` | 테스트 환경 안내 후 개발 서버 실행 (배포 API) |
| `npm run test:env:emulator` | 프론트 + Functions 에뮬레이터 동시 실행 (`.env.local` 에 에뮬레이터 URL 필요) |
| `npm run emulators:functions` | Functions 에뮬레이터만 실행 |
| `npm run verify:bid-search` | 입찰공고 API 검증 스크립트 |
| `npm run verify:busan` | 키워드 "부산"으로 API 검증 |

---

## 5. 테스트 체크리스트 (요약)

1. **프론트 접속**  
   - http://127.0.0.1:3000 → 메뉴에서 「입찰공고」 이동
2. **검색**  
   - 공고명·날짜 범위 입력 후 검색 → 결과 또는 “검색 결과가 없습니다” 확인
3. **상세**  
   - 결과 행의 「상세 보기」 → 상세 모달(금액·일정·첨부파일 등) 확인
4. **공고번호 링크**  
   - 공고번호 클릭 → 나라장터 입찰공고 검색결과 페이지 열리는지 확인

자세한 시나리오는 **LOCAL_TEST.md**, **TESTING_GUIDE.md** 를 참고하세요.

---

## 6. 요약

| 목적 | 설정 | 실행 |
|------|------|------|
| 배포 API로 빠르게 테스트 | `.env.development` 만 사용 | `npm run dev` |
| 로컬 API까지 테스트 | `.env.local` 에 에뮬레이터 URL | 터미널 1: `firebase emulators:start --only functions`<br>터미널 2: `npm run dev` |

문제가 있으면 `VITE_API_URL` 이 올바른지, 에뮬레이터 사용 시에는 `functions/.env` 의 API 키와 에뮬레이터 실행 여부를 확인하세요.
