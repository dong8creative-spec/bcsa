# 모바일 결제 테스트 가이드

현재 상황에서 **모바일 결제가 원활하게 동작하는지** 검증하는 방법을 정리했습니다.

---

## 1. 사전 확인

- **모바일 결제 설정**이 완료되어 있어야 합니다.  
  → [모바일_결제_설정_가이드.md](./모바일_결제_설정_가이드.md) 참고  
  - PortOne 채널에 **모바일 결제 가능 PG** 연결  
  - `VITE_PORTONE_IMP_CODE`, `VITE_PORTONE_CHANNEL_KEY` 빌드 반영  
  - 웹훅 URL 설정

---

## 2. 테스트 방법 (둘 중 하나)

### A. 실제 모바일 기기

1. 스마트폰에서 **https://bcsa.co.kr** 접속
2. 로그인
3. **프로그램** 메뉴 → **유료 프로그램** 하나 선택
4. **결제하기** 버튼 클릭
5. 확인 사항:
   - 결제창(리다이렉트)이 정상적으로 뜨는지
   - 결제 완료 후 **`/payment/result`** 로 돌아오는지
   - "결제 및 신청이 완료되었습니다" 등 결과 메시지가 보이는지

### B. PC Chrome 개발자도구 (모바일 UA 시뮬레이션)

1. Chrome에서 **https://bcsa.co.kr** 접속
2. **F12** → **디바이스 툴바** 아이콘 클릭 (또는 `Ctrl+Shift+M` / `Cmd+Shift+M`)
3. 상단에서 **디바이스**를 모바일로 선택  
   (예: iPhone 12 Pro, Pixel 5 등 — **UA가 모바일로 바뀌어야** 리다이렉트 결제가 사용됨)
4. 새로고침 후 위 **A**와 동일하게:
   - **프로그램** → 유료 프로그램 선택 → **결제하기** 클릭
   - 결제창(리다이렉트) 표시 → 결제 완료 → **`/payment/result`** 복귀 확인

> **참고**: 뷰포트만 줄이고 UA를 바꾸지 않으면 PC 결제 플로우(표준 결제)가 동작합니다.  
> 모바일 결제(리다이렉트)를 테스트하려면 **반드시 디바이스 툴바에서 모바일 기기를 선택**해 주세요.

---

## 3. 체크리스트

| 항목 | 확인 |
|------|------|
| 모바일(또는 모바일 UA)에서 사이트 접속 | ☐ |
| 유료 프로그램 선택 후 **결제하기** 버튼 노출 | ☐ |
| 결제하기 클릭 시 결제창(리다이렉트) 정상 오픈 | ☐ |
| 결제 완료 후 **/payment/result** 로 복귀 | ☐ |
| 결과 화면에 완료 메시지 표시 | ☐ |
| 콘솔에 "등록된 PG 설정 정보가 없습니다" 없음 | ☐ (선택) |

---

## 4. 로컬에서 테스트할 때

- `npm run dev` 후 **http://127.0.0.1:3000** 접속
- `.env.development` 또는 `.env.local`에  
  `VITE_API_URL`, `VITE_PORTONE_IMP_CODE`, `VITE_PORTONE_CHANNEL_KEY` 설정 필요
- 위와 같이 Chrome 디바이스 툴바에서 **모바일 기기** 선택 후 동일 절차로 결제 플로우 확인

---

## 5. 문제가 있을 때

- **"결제가 설정되지 않았습니다"**  
  → 환경 변수(IMP_CODE, CHANNEL_KEY)가 빌드에 반영되지 않음. 배포 방식에 맞게 설정 확인.
- **"등록된 PG 설정 정보가 없습니다"**  
  → PortOne 콘솔 → 채널 관리에서 해당 채널에 **모바일 결제 가능 PG**가 연결되었는지 확인.
- 결제창이 안 뜨거나 **/payment/result** 로 안 돌아옴  
  → 같은 채널에서 **리다이렉트 결제(m_redirect_url)** 지원 여부 및 웹훅 URL 확인.

위 체크리스트까지 통과하면 현재 상황에서 모바일 결제가 원활히 동작하는 것으로 볼 수 있습니다.
