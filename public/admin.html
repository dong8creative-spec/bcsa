<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드 - 부산청년사업가</title>
    
    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 다음 우편번호 서비스 + 카카오 맵 SDK (장소 선택용) -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=f35b8c9735d77cced1235c5775c7c3b1&libraries=services" defer></script>

    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- Firebase Configuration (동기 로드) -->
    <script src="./assets/js/firebase-config.js"></script>
    
    <!-- Firebase Services (동기 로드) -->
    <script src="./assets/js/firebase-service.js"></script>
    <script src="./assets/js/auth-service.js"></script>
    
    <!-- Firebase 초기화 확인 스크립트 -->
    <script>
        // Firebase 초기화 확인 및 재시도 로직
        (function() {
            let attempts = 0;
            const maxAttempts = 50; // 최대 5초 대기
            
            const checkFirebaseInit = setInterval(() => {
                attempts++;
                
                if (window.firebaseServices && window.firebaseServices.db && window.firebaseServices.auth) {
                    clearInterval(checkFirebaseInit);
                    
                    // 초기화 완료 이벤트 발생
                    window.dispatchEvent(new CustomEvent('firebaseInitialized'));
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkFirebaseInit);
                    
                    // 초기화 실패 이벤트 발생
                    window.dispatchEvent(new CustomEvent('firebaseInitFailed', {
                        detail: {
                            firebaseSDK: typeof firebase !== 'undefined',
                            firebaseServices: !!window.firebaseServices,
                            firebaseService: !!window.firebaseService,
                            authService: !!window.authService
                        }
                    }));
                }
            }, 100);
        })();
    </script>

    <!-- 설정 파일 -->
    <script src="./assets/js/config.js"></script>
    
    <!-- 유틸리티 함수 -->
    <script src="./assets/js/utils.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif'],
                        pop: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        brand: '#0045a5', 
                        accent: '#3b82f6',
                        dark: '#0f172a',
                        gray: '#64748b',
                        soft: '#f8fafc',
                    },
                }
            }
        }
    </script>

    <style>
        body { background-color: #ffffff; color: #1e293b; font-family: 'Noto Sans KR', sans-serif; }
        .modal-scroll::-webkit-scrollbar { width: 6px; }
        .modal-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .modal-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .modal-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        
        // 즉시 실행 함수로 스코프 격리
        (function() {
        const { useState, useEffect, useRef } = React;
        
        // 카카오맵 Places API를 활용한 장소 검색 함수
        const openKakaoPlacesSearch = (onComplete) => {
            // Places 서비스 초기화 확인
            if (!window.kakao || !window.kakao.maps || !window.kakao.maps.services) {
                alert('카카오맵 API가 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                return;
            }
            
            // 검색 모달 생성
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/70';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-dark">장소 검색</h3>
                        <button type="button" class="p-2 hover:bg-gray-100 rounded-lg" onclick="this.closest('.fixed').remove()">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="mb-4">
                        <input 
                            type="text" 
                            id="place-search-input" 
                            placeholder="장소명, 주소, 건물명 등을 입력하세요" 
                            class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                        />
                    </div>
                    <div id="place-search-results" class="flex-1 overflow-y-auto space-y-2"></div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const searchInput = modal.querySelector('#place-search-input');
            const resultsContainer = modal.querySelector('#place-search-results');
            const placesService = new window.kakao.maps.services.Places();
            
            // 검색 실행 함수
            const performSearch = (keyword) => {
                if (!keyword.trim()) {
                    resultsContainer.innerHTML = '<p class="text-center text-gray-400 py-4">검색어를 입력해주세요.</p>';
                    return;
                }
                
                placesService.keywordSearch(keyword, (data, status) => {
                    resultsContainer.innerHTML = '';
                    
                    if (status === window.kakao.maps.services.Status.OK) {
                        if (data.length === 0) {
                            resultsContainer.innerHTML = '<p class="text-center text-gray-400 py-4">검색 결과가 없습니다.</p>';
                            return;
                        }
                        
                        data.forEach((place) => {
                            const item = document.createElement('div');
                            item.className = 'p-4 border border-gray-200 rounded-xl hover:bg-gray-50 cursor-pointer';
                            item.innerHTML = `
                                <div class="font-bold text-dark mb-1">${place.place_name}</div>
                                <div class="text-sm text-gray-600">${place.address_name || place.road_address_name || ''}</div>
                                ${place.phone ? `<div class="text-xs text-gray-500 mt-1">${place.phone}</div>` : ''}
                            `;
                            item.onclick = () => {
                                onComplete({
                                    name: place.place_name,
                                    address: place.road_address_name || place.address_name,
                                    lat: parseFloat(place.y),
                                    lng: parseFloat(place.x),
                                    phone: place.phone || '',
                                    placeUrl: place.place_url || ''
                                });
                                modal.remove();
                            };
                            resultsContainer.appendChild(item);
                        });
                    } else {
                        resultsContainer.innerHTML = '<p class="text-center text-gray-400 py-4">검색 중 오류가 발생했습니다.</p>';
                    }
                });
            };
            
            // 엔터 키 검색
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch(searchInput.value);
                }
            });
            
            // 모달 외부 클릭 시 닫기
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // 검색 입력 포커스
            searchInput.focus();
        };
        
        
        // ==========================================
        // 관리자 인증 설정
        // ==========================================
        // 관리자 접근 코드
        const ADMIN_CODE = '021900';

        // ==========================================
        // 아이콘 컴포넌트
        // ==========================================
        const Icons = {
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Clock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            ChevronLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            Restaurant: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"/><path d="M21 15v7"/></svg>,
            MessageSquare: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Lock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            ArrowLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Edit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Trash: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>,
            List: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            MapPin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
        };
        
        // ==========================================
        // 유틸리티 함수
        // ==========================================
        // localStorage 함수 제거됨 - Firebase를 사용하므로 불필요
        // formatDate는 utils.js에서 로드됨 (중복 선언 방지)
        
        // 카카오 지도 모달 컴포넌트
        const KakaoMapModal = ({ onClose, onSelectLocation, initialLocation }) => {
            const mapContainerRef = React.useRef(null);
            const mapRef = React.useRef(null);
            const markerRef = React.useRef(null);
            const geocoderRef = React.useRef(null);
            const placesServiceRef = React.useRef(null);
            const [selectedPlace, setSelectedPlace] = useState(null);
            const [searchKeyword, setSearchKeyword] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [mapLoaded, setMapLoaded] = useState(false);
            
            React.useEffect(() => {
                // 카카오 지도 SDK가 로드되었는지 확인
                if (typeof kakao === 'undefined' || !kakao.maps) {
                    
                    return;
                }
                
                // 지도 초기화
                const center = initialLocation 
                    ? new kakao.maps.LatLng(initialLocation.lat, initialLocation.lng)
                    : new kakao.maps.LatLng(35.1796, 129.0756); // 부산 중심
                
                const mapOption = {
                    center: center,
                    level: 3
                };
                
                mapRef.current = new kakao.maps.Map(mapContainerRef.current, mapOption);
                geocoderRef.current = new kakao.maps.services.Geocoder();
                
                // Places 서비스 초기화
                if (kakao.maps.services && kakao.maps.services.Places) {
                    placesServiceRef.current = new kakao.maps.services.Places();
                } else {
                    
                }
                
                // 지도 컨트롤 추가
                const zoomControl = new kakao.maps.ZoomControl();
                mapRef.current.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
                
                // 초기 위치에 마커 표시
                if (initialLocation) {
                    markerRef.current = new kakao.maps.Marker({
                        position: center,
                        map: mapRef.current
                    });
                    setSelectedPlace({
                        name: initialLocation.name || '',
                        address: initialLocation.address || '',
                        lat: initialLocation.lat,
                        lng: initialLocation.lng
                    });
                }
                
                // 지도 클릭 이벤트
                kakao.maps.event.addListener(mapRef.current, 'click', (mouseEvent) => {
                    const latlng = mouseEvent.latLng;
                    
                    // 기존 마커 제거
                    if (markerRef.current) {
                        markerRef.current.setMap(null);
                    }
                    
                    // 새 마커 추가
                    markerRef.current = new kakao.maps.Marker({
                        position: latlng,
                        map: mapRef.current
                    });
                    
                    // 역지오코딩으로 주소 가져오기
                    geocoderRef.current.coord2Address(latlng.getLng(), latlng.getLat(), (result, status) => {
                        if (status === kakao.maps.services.Status.OK) {
                            const roadAddr = result[0].road_address;
                            const jibunAddr = result[0].address;
                            
                            setSelectedPlace({
                                name: '',
                                address: roadAddr ? roadAddr.address_name : jibunAddr.address_name,
                                lat: latlng.getLat(),
                                lng: latlng.getLng()
                            });
                        } else {
                            setSelectedPlace({
                                name: '',
                                address: `위도: ${latlng.getLat().toFixed(6)}, 경도: ${latlng.getLng().toFixed(6)}`,
                                lat: latlng.getLat(),
                                lng: latlng.getLng()
                            });
                        }
                    });
                });
                
                setMapLoaded(true);
            }, []);
            
            // 장소 검색
            const handleSearch = () => {
                if (!searchKeyword.trim()) {
                    alert('검색어를 입력해주세요.');
                    return;
                }
                
                if (!mapLoaded) {
                    alert('지도가 아직 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                    return;
                }
                
                if (!placesServiceRef.current) {
                    
                    alert('검색 서비스를 사용할 수 없습니다. 페이지를 새로고침해주세요.');
                    return;
                }
                
                setSearchResults([]); // 검색 결과 초기화
                
                // 키워드 검색
                placesServiceRef.current.keywordSearch(searchKeyword, (data, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const results = data.map(place => ({
                            name: place.place_name,
                            address: place.road_address_name || place.address_name,
                            lat: parseFloat(place.y),
                            lng: parseFloat(place.x)
                        }));
                        setSearchResults(results);
                        
                        if (results.length === 0) {
                            alert('검색 결과가 없습니다.');
                        }
                    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                        // 키워드 검색 실패 시 주소 검색 시도
                        if (geocoderRef.current) {
                            geocoderRef.current.addressSearch(searchKeyword, (result, geocodeStatus) => {
                                if (geocodeStatus === kakao.maps.services.Status.OK) {
                                    const results = result.map(item => ({
                                        name: '',
                                        address: item.road_address ? item.road_address.address_name : item.address_name,
                                        lat: parseFloat(item.y),
                                        lng: parseFloat(item.x)
                                    }));
                                    setSearchResults(results);
                                } else {
                                    alert('검색 결과가 없습니다.');
                                    setSearchResults([]);
                                }
                            });
                        } else {
                            alert('검색 결과가 없습니다.');
                        }
                    } else {
                        
                        alert('검색 중 오류가 발생했습니다. 다시 시도해주세요.');
                    }
                });
            };
            
            // 검색 결과 선택
            const handleSelectResult = (result) => {
                const latlng = new kakao.maps.LatLng(result.lat, result.lng);
                
                mapRef.current.setCenter(latlng);
                mapRef.current.setLevel(3);
                
                // 기존 마커 제거
                if (markerRef.current) {
                    markerRef.current.setMap(null);
                }
                
                // 새 마커 추가
                markerRef.current = new kakao.maps.Marker({
                    position: latlng,
                    map: mapRef.current
                });
                
                setSelectedPlace({
                    name: result.name || '',
                    address: result.address,
                    lat: result.lat,
                    lng: result.lng
                });
                
                setSearchResults([]);
            };
            
            // 장소 확정
            const handleConfirm = () => {
                if (!selectedPlace) {
                    alert('지도에서 장소를 선택해주세요.');
                    return;
                }
                onSelectLocation(selectedPlace);
                onClose();
            };
            
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70" onClick={(e) => e.target === e.currentTarget && onClose()}>
                    <div className="bg-white rounded-3xl p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-xl font-bold text-dark">장소 선택 (카카오 맵)</h3>
                            <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                <Icons.X size={20} />
                            </button>
                        </div>
                        
                        {/* 검색 */}
                        <div className="flex gap-2 mb-4">
                            <input
                                type="text"
                                value={searchKeyword}
                                onChange={(e) => setSearchKeyword(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                placeholder="주소 또는 장소명 검색"
                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                            />
                            <button
                                onClick={handleSearch}
                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                            >
                                검색
                            </button>
                        </div>
                        
                        {/* 검색 결과 */}
                        {searchResults.length > 0 && (
                            <div className="mb-4 max-h-40 overflow-y-auto border border-gray-200 rounded-xl">
                                {searchResults.map((result, idx) => (
                                    <div
                                        key={idx}
                                        onClick={() => handleSelectResult(result)}
                                        className="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0"
                                    >
                                        {result.name && <p className="font-bold text-sm text-dark">{result.name}</p>}
                                        <p className="text-sm text-gray-600">{result.address}</p>
                                    </div>
                                ))}
                            </div>
                        )}
                        
                        {/* 지도 */}
                        <div 
                            ref={mapContainerRef} 
                            className="flex-1 min-h-[400px] rounded-xl border-2 border-gray-200 overflow-hidden"
                        />
                        
                        {/* 선택된 장소 정보 */}
                        {selectedPlace && (
                            <div className="mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded-xl">
                                <p className="text-sm font-bold text-yellow-700 mb-1">선택된 장소</p>
                                {selectedPlace.name && <p className="font-bold text-sm text-dark">{selectedPlace.name}</p>}
                                <p className="text-sm text-gray-700">{selectedPlace.address}</p>
                                <p className="text-xs text-gray-500 mt-1">
                                    좌표: {selectedPlace.lat?.toFixed(6)}, {selectedPlace.lng?.toFixed(6)}
                                </p>
                            </div>
                        )}
                        
                        {/* 버튼 */}
                        <div className="flex gap-3 mt-4">
                            <button
                                onClick={onClose}
                                className="flex-1 py-3 border-2 border-gray-200 rounded-xl font-bold text-gray-600 hover:bg-gray-50 transition-colors"
                            >
                                취소
                            </button>
                            <button
                                onClick={handleConfirm}
                                disabled={!selectedPlace}
                                className={`flex-1 py-3 rounded-xl font-bold transition-colors ${
                                    selectedPlace 
                                        ? 'bg-brand text-white hover:bg-blue-700' 
                                        : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                }`}
                            >
                                선택 완료
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // DateTimePicker 커스텀 컴포넌트
        const DateTimePicker = ({ value, onChange, placeholder }) => {
            const [showCalendar, setShowCalendar] = useState(false);
            const [currentMonth, setCurrentMonth] = useState(() => {
                if (value) {
                    const match = value.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (match) return new Date(parseInt(match[1]), parseInt(match[2]) - 1, 1);
                }
                return new Date();
            });
            const [selectedDate, setSelectedDate] = useState(() => {
                if (value) {
                    const match = value.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (match) return new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
                }
                return null;
            });
            const [selectedTime, setSelectedTime] = useState(() => {
                if (value) {
                    const timeMatch = value.match(/(\d{2}):(\d{2})/);
                    if (timeMatch) return `${timeMatch[1]}:${timeMatch[2]}`;
                }
                return '10:00';
            });
            const calendarRef = React.useRef(null);
            
            // 외부 클릭 시 달력 닫기
            React.useEffect(() => {
                const handleClickOutside = (event) => {
                    if (calendarRef.current && !calendarRef.current.contains(event.target)) {
                        setShowCalendar(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);
            
            // 월의 일수 계산
            const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
            
            // 월의 첫 번째 요일
            const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();
            
            // 달력 날짜 배열 생성
            const generateCalendarDays = () => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const days = [];
                
                // 빈 칸 (이전 달)
                for (let i = 0; i < firstDay; i++) {
                    days.push(null);
                }
                // 현재 달 날짜
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(new Date(year, month, day));
                }
                return days;
            };
            
            // 시간 옵션 생성 (30분 단위)
            const timeOptions = [];
            for (let h = 0; h < 24; h++) {
                for (let m = 0; m < 60; m += 30) {
                    const hour = h.toString().padStart(2, '0');
                    const minute = m.toString().padStart(2, '0');
                    timeOptions.push(`${hour}:${minute}`);
                }
            }
            
            // 날짜 선택
            const handleDateClick = (date) => {
                setSelectedDate(date);
            };
            
            // 선택 완료
            const handleConfirm = () => {
                if (selectedDate) {
                    const year = selectedDate.getFullYear();
                    const month = (selectedDate.getMonth() + 1).toString().padStart(2, '0');
                    const day = selectedDate.getDate().toString().padStart(2, '0');
                    const dateTimeStr = `${year}.${month}.${day} ${selectedTime}`;
                    onChange(dateTimeStr);
                    setShowCalendar(false);
                }
            };
            
            // 이전 달
            const prevMonth = () => {
                setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1));
            };
            
            // 다음 달
            const nextMonth = () => {
                setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1));
            };
            
            // 오늘 날짜 체크
            const isToday = (date) => {
                if (!date) return false;
                const today = new Date();
                return date.getDate() === today.getDate() && 
                       date.getMonth() === today.getMonth() && 
                       date.getFullYear() === today.getFullYear();
            };
            
            // 선택된 날짜 체크
            const isSelected = (date) => {
                if (!date || !selectedDate) return false;
                return date.getDate() === selectedDate.getDate() && 
                       date.getMonth() === selectedDate.getMonth() && 
                       date.getFullYear() === selectedDate.getFullYear();
            };
            
            const weekDays = ['일', '월', '화', '수', '목', '금', '토'];
            
            return (
                <div className="relative" ref={calendarRef}>
                    <div 
                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none cursor-pointer flex items-center justify-between bg-white"
                        onClick={() => setShowCalendar(!showCalendar)}
                    >
                        <span className={value ? 'text-gray-900' : 'text-gray-400'}>
                            {value || placeholder || '날짜와 시간을 선택하세요'}
                        </span>
                        <Icons.Calendar size={20} className="text-gray-400" />
                    </div>
                    
                    {showCalendar && (
                        <div className="absolute top-full left-0 mt-2 bg-white border-2 border-gray-200 rounded-2xl shadow-xl z-50 p-4 w-80">
                            {/* 월 네비게이션 */}
                            <div className="flex items-center justify-between mb-4">
                                <button type="button" onClick={prevMonth} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                    <Icons.ChevronLeft size={20} />
                                </button>
                                <span className="font-bold text-lg">
                                    {currentMonth.getFullYear()}년 {currentMonth.getMonth() + 1}월
                                </span>
                                <button type="button" onClick={nextMonth} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                    <Icons.ChevronRight size={20} />
                                </button>
                            </div>
                            
                            {/* 요일 헤더 */}
                            <div className="grid grid-cols-7 gap-1 mb-2">
                                {weekDays.map((day, idx) => (
                                    <div key={day} className={`text-center text-sm font-bold py-2 ${idx === 0 ? 'text-red-500' : idx === 6 ? 'text-blue-500' : 'text-gray-600'}`}>
                                        {day}
                                    </div>
                                ))}
                            </div>
                            
                            {/* 날짜 그리드 */}
                            <div className="grid grid-cols-7 gap-1 mb-4">
                                {generateCalendarDays().map((date, idx) => (
                                    <button
                                        key={idx}
                                        type="button"
                                        disabled={!date}
                                        onClick={() => date && handleDateClick(date)}
                                        className={`
                                            w-9 h-9 rounded-lg text-sm font-medium transition-all
                                            ${!date ? 'invisible' : ''}
                                            ${date && isSelected(date) ? 'bg-brand text-white' : ''}
                                            ${date && isToday(date) && !isSelected(date) ? 'border-2 border-brand text-brand' : ''}
                                            ${date && !isSelected(date) && !isToday(date) ? 'hover:bg-gray-100' : ''}
                                            ${date && idx % 7 === 0 ? 'text-red-500' : ''}
                                            ${date && idx % 7 === 6 ? 'text-blue-500' : ''}
                                        `}
                                    >
                                        {date ? date.getDate() : ''}
                                    </button>
                                ))}
                            </div>
                            
                            {/* 시간 선택 */}
                            <div className="flex items-center gap-3 mb-4 pb-4 border-b border-gray-200">
                                <Icons.Clock size={18} className="text-gray-400" />
                                <span className="text-sm font-bold text-gray-700">시간:</span>
                                <select 
                                    value={selectedTime}
                                    onChange={(e) => setSelectedTime(e.target.value)}
                                    className="flex-1 p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                >
                                    {timeOptions.map(time => (
                                        <option key={time} value={time}>{time}</option>
                                    ))}
                                </select>
                            </div>
                            
                            {/* 선택 완료 버튼 */}
                            <button
                                type="button"
                                onClick={handleConfirm}
                                disabled={!selectedDate}
                                className={`w-full py-3 rounded-xl font-bold transition-colors ${
                                    selectedDate 
                                        ? 'bg-brand text-white hover:bg-blue-700' 
                                        : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                }`}
                            >
                                선택 완료
                            </button>
                        </div>
                    )}
                </div>
            );
        };
        
        // 파일을 Base64로 변환
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };
        
        // 이미지 리사이징
        const resizeImage = (file, maxWidth, maxHeight, quality = 0.9) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth || height > maxHeight) {
                            const ratio = Math.min(maxWidth / width, maxHeight / height);
                            width = width * ratio;
                            height = height * ratio;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob((blob) => {
                            if (blob) {
                                const reader = new FileReader();
                                reader.onloadend = () => resolve(reader.result);
                                reader.onerror = reject;
                                reader.readAsDataURL(blob);
                            } else {
                                reject(new Error('이미지 리사이징 실패'));
                            }
                        }, file.type || 'image/png', quality);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };
        
        // ImgBB 이미지 업로드
        const uploadImageToImgBB = async (base64Image, fileName) => {
            try {
                const base64Data = base64Image.split(',')[1] || base64Image;
                const formData = new FormData();
                formData.append('key', IMGBB_API_KEY);
                formData.append('image', base64Data);
                formData.append('name', fileName || 'image');

                const response = await fetch('https://api.imgbb.com/1/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success && data.data && data.data.url) {
                    return {
                        success: true,
                        url: data.data.url,
                        deleteUrl: data.data.delete_url || null,
                        id: data.data.id
                    };
                } else {
                    throw new Error(data.error?.message || data.error || '이미지 업로드 실패');
                }
            } catch (error) {
                
                throw error;
            }
        };

        // 이미지 다운로드
        const downloadImage = async (imageUrl, fileName) => {
            try {
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName || 'image.jpg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                
                alert('이미지 다운로드에 실패했습니다.');
            }
        };
        
        // calculateStatus는 utils.js에서 로드됨 (중복 선언 방지)

        // ==========================================
        // 기본 데이터
        // ==========================================
        const defaultContent = {
            hero_title: "함께 성장하는\n청년 사업가 커뮤니티\n부산청년사업가들",
            hero_desc: "부산 지역 청년 사업가들이 모여 아이디어를 공유하고, 네트워킹하며 함께 성장해나가는 공간입니다.",
            // About 페이지 (소개 페이지)
            about_hero_title: "함께 성장하는 사업가 네트워크",
            about_hero_desc: "부산 지역 청년 사업가들의 성장과 연결을 돕는 비즈니스 커뮤니티, 부청사입니다.",
            about_mission_title: "Platform for Businessmen",
            about_mission_desc_1: "부산청년사업가들은 정기적인 네트워킹과 실무 중심의 세미나를 통해 실질적인 도움을 제공합니다.",
            about_mission_desc_2: "업종을 넘어선 협업과 정보 공유를 지원하며, 온·오프라인을 연계해 지속적인 비즈니스 확장을 돕습니다.",
            about_mission_desc_3: "부청사는 단순한 모임을 넘어, 함께 성장하는 플랫폼입니다.",
            about_why_title: "'부청사'가 필요한 이유",
            about_why_subtitle: "혼자 고민하지 마세요. 함께하면 답이 보입니다.",
            about_why_1_title: "고립감/압박감 해소",
            about_why_1_desc: "같은 길을 걷는 동료들과 고민을 나누는 심리적 안전망",
            about_why_2_title: "번아웃 방지",
            about_why_2_desc: "일과 삶의 균형을 찾고 리프레시할 수 있는 기회 제공",
            about_why_3_title: "성장의 한계 극복",
            about_why_3_desc: "다양한 경험 공유를 통해 새로운 인사이트와 협업 기회 획득",
            about_why_4_title: "네트워크 확장",
            about_why_4_desc: "투자자, 고객, 파트너를 만나 실질적인 비즈니스 기회 창출",
            about_history_title: "HISTORY",
            about_history_subtitle: "부산청년사업가들이 걸어온 길",
            about_history_2014_title: "지주회사 설립 기획",
            about_history_2014_desc: "부산청년사업가들 필요성 검토 및 기획",
            about_history_2017_title: "커뮤니티 구축",
            about_history_2017_desc: "회원간 소통 내부망 구축 및 카카오 오픈채팅방 개설",
            about_history_2018_title: "첫 오프라인 활동",
            about_history_2018_desc: "창업자들을 위한 첫 세미나 개최 및 네트워킹 모임 운영",
            about_history_2024_title: "정기 세미나 구축",
            about_history_2024_desc: "창업/세무/마케팅 교육 프로그램 및 정기 모임 활성화",
            about_history_2025_title: "비영리 법인 설립",
            about_history_2025_desc: "공식 단체 법인화 및 온라인 플랫폼(어플) 개발 추진",
            about_future_title: "향후 계획 및 목표",
            about_future_subtitle: "부청사는 멈추지 않고 계속 성장합니다.",
            about_future_1_title: "맞춤형 역량 교육",
            about_future_1_desc: "창업 단계별 실무 교육(세무, 마케팅 등)과 멘토링 강화",
            about_future_2_title: "공공사업 연계",
            about_future_2_desc: "정부·지자체 사업과 협력하여 실질적 혜택 제공",
            about_future_3_title: "온라인 플랫폼",
            about_future_3_desc: "회원들이 연결되고 협업할 수 있는 전용 앱/웹 구축",
            about_future_4_title: "사회공헌 활동",
            about_future_4_desc: "멘토링, 재능기부 등 지역사회와 상생하는 프로그램",
            about_future_5_title: "정책 제안",
            about_future_5_desc: "부산 청년 창업가 실태조사 기반 맞춤형 정책 제안",
            about_future_6_title: "자체 수익모델",
            about_future_6_desc: "교육 콘텐츠, 굿즈 등 지속가능한 운영 기반 마련",
            about_contact_phone: "010-5323-9310",
            about_contact_email: "pujar@naver.com",
        };

        const defaultMembersData = [];
        const defaultSeminarsData = [];
        const defaultCommunityPosts = [];

        // ==========================================
        // 관리자 인증 체크 함수 (로그인된 사용자 기반)
        // ==========================================
        const checkAdminAccess = async () => {
            try {
                // Firebase Auth에서 현재 로그인된 사용자 확인
                if (!window.firebaseServices || !window.firebaseServices.auth) {
                    return { isAdmin: false, reason: 'Firebase가 초기화되지 않았습니다.' };
                }
                
                const currentUser = window.firebaseServices.auth.currentUser;
                if (!currentUser) {
                    return { isAdmin: false, reason: '로그인이 필요합니다.' };
                }
                
                // Firestore에서 사용자 정보 가져오기
                const userDoc = await window.firebaseServices.db.collection('users')
                    .where('uid', '==', currentUser.uid)
                    .limit(1)
                    .get();
                
                if (userDoc.empty) {
                    return { isAdmin: false, reason: '사용자 정보를 찾을 수 없습니다.' };
                }
                
                const userData = { id: userDoc.docs[0].id, ...userDoc.docs[0].data() };
                
                // 관리자 권한 확인
                const isAdmin = userData.isAdmin === true || 
                               userData.name === '햇반' || 
                               userData.email === 'haetban@bcsa.co.kr';
                
                if (isAdmin) {
                    localStorage.setItem('admin_authenticated', 'true');
                    return { isAdmin: true, user: userData };
                }
                
                return { isAdmin: false, reason: '관리자 권한이 없습니다.' };
            } catch (error) {
                return { isAdmin: false, reason: '권한 확인 중 오류가 발생했습니다.' };
            }
        };
        
        // ==========================================
        // 대시보드 홈 컴포넌트
        // ==========================================
        const DashboardHome = ({ users, posts, seminars }) => {
            const [searchLogs, setSearchLogs] = useState([]);
            const [loadingLogs, setLoadingLogs] = useState(false);
            const refreshIntervalRef = useRef(null);

            // 검색 로그 로드 함수
            const loadSearchLogs = async () => {
                if (!window.firebaseService) return;
                setLoadingLogs(true);
                try {
                    const logs = await window.firebaseService.getSearchLogs(50);
                    setSearchLogs(logs || []);
                } catch (error) {
                    
                } finally {
                    setLoadingLogs(false);
                }
            };

            // 컴포넌트 마운트 시 로드 및 주기적 새로고침
            useEffect(() => {
                loadSearchLogs();
                // 5초마다 새로고침
                refreshIntervalRef.current = setInterval(() => {
                    loadSearchLogs();
                }, 5000);

                return () => {
                    if (refreshIntervalRef.current) {
                        clearInterval(refreshIntervalRef.current);
                    }
                };
            }, []);

            // 날짜 포맷 함수
            const formatDateTime = (date) => {
                if (!date) return '-';
                const d = date instanceof Date ? date : new Date(date);
                if (isNaN(d.getTime())) return '-';
                return d.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            };

            const totalUsers = users.length;
            const pendingUsers = users.filter(u => u.approvalStatus === 'pending').length;
            const totalPosts = posts.length;
            const totalPrograms = seminars.length;
            const recentUsers = [...users].sort((a, b) => {
                const aDate = a.createdAt?.toDate ? a.createdAt.toDate() : new Date(a.createdAt);
                const bDate = b.createdAt?.toDate ? b.createdAt.toDate() : new Date(b.createdAt);
                return bDate - aDate;
            }).slice(0, 5);
            const recentPosts = [...posts].slice(0, 5);

            return (
                <div className="space-y-6">
                    {/* 통계 카드 */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">전체 회원</p>
                                    <p className="text-3xl font-bold text-dark">{totalUsers}</p>
                                            </div>
                                <Icons.Users className="w-12 h-12 text-blue-500" />
                                            </div>
                                        </div>
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-yellow-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">승인 대기</p>
                                    <p className="text-3xl font-bold text-dark">{pendingUsers}</p>
                                    </div>
                                <Icons.Clock className="w-12 h-12 text-yellow-500" />
                                                        </div>
                                                        </div>
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-green-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">게시글</p>
                                    <p className="text-3xl font-bold text-dark">{totalPosts}</p>
                                                        </div>
                                <Icons.MessageSquare className="w-12 h-12 text-green-500" />
                                </div>
                        </div>
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-purple-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">프로그램</p>
                                    <p className="text-3xl font-bold text-dark">{totalPrograms}</p>
                                </div>
                                <Icons.Calendar className="w-12 h-12 text-purple-500" />
                            </div>
                                    </div>
                                                    </div>
                    
                    {/* 최근 데이터 */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* 최근 가입 회원 */}
                        <div className="bg-white rounded-2xl shadow-lg p-6">
                            <h3 className="text-lg font-bold text-dark mb-4">최근 가입 회원</h3>
                            {recentUsers.length === 0 ? (
                                <p className="text-gray-400 text-center py-8">가입한 회원이 없습니다.</p>
                            ) : (
                                <div className="space-y-3">
                                    {recentUsers.map(user => (
                                        <div key={user.id || user.uid} className="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                                            <div className="w-10 h-10 rounded-full bg-brand/10 flex items-center justify-center">
                                                <Icons.Users className="w-5 h-5 text-brand" />
                                                </div>
                                            <div className="flex-1">
                                                <p className="font-bold text-dark">{user.name || '이름 없음'}</p>
                                                <p className="text-sm text-gray-600">{user.email || '-'}</p>
                                                        </div>
                                            <span className={`text-xs px-2 py-1 rounded font-bold ${
                                                user.approvalStatus === 'approved' ? 'bg-green-100 text-green-700' :
                                                user.approvalStatus === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                                'bg-red-100 text-red-700'
                                            }`}>
                                                {user.approvalStatus === 'approved' ? '승인' :
                                                 user.approvalStatus === 'pending' ? '대기' : '거부'}
                                            </span>
                                    </div>
                                    ))}
                                            </div>
                    )}
                        </div>
                        
                        {/* 최근 게시글 */}
                        <div className="bg-white rounded-2xl shadow-lg p-6">
                            <h3 className="text-lg font-bold text-dark mb-4">최근 게시글</h3>
                            {recentPosts.length === 0 ? (
                                <p className="text-gray-400 text-center py-8">게시글이 없습니다.</p>
                            ) : (
                                <div className="space-y-3">
                                    {recentPosts.map(post => (
                                        <div key={post.id} className="p-3 bg-gray-50 rounded-xl">
                                            <p className="font-bold text-dark mb-1">{post.title || '제목 없음'}</p>
                                            <p className="text-sm text-gray-600">{post.author || '작성자 없음'}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* 실시간 검색 현황 */}
                    <div className="bg-white rounded-2xl shadow-lg p-6 mt-6">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-bold text-dark">실시간 검색 현황</h3>
                            <button
                                type="button"
                                onClick={loadSearchLogs}
                                disabled={loadingLogs}
                                className="px-4 py-2 bg-brand text-white rounded-lg font-bold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm flex items-center gap-2"
                            >
                                <Icons.Clock size={16} />
                                {loadingLogs ? '로딩 중...' : '새로고침'}
                            </button>
                        </div>
                        
                        {searchLogs.length === 0 ? (
                            <p className="text-gray-400 text-center py-8">검색 로그가 없습니다.</p>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">검색 시각</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">회원명</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">이메일</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">검색어</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">결과 건수</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {searchLogs.map((log) => (
                                            <tr key={log.id} className="hover:bg-gray-50 transition-colors">
                                                <td className="px-4 py-3 text-sm text-gray-600">{formatDateTime(log.searchedAt)}</td>
                                                <td className="px-4 py-3 text-sm font-medium text-dark">{log.userName || '-'}</td>
                                                <td className="px-4 py-3 text-sm text-gray-600">{log.userEmail || '-'}</td>
                                                <td className="px-4 py-3 text-sm">
                                                    <span className="px-2 py-1 bg-brand/10 text-brand rounded-lg font-bold">
                                                        {log.keyword || '-'}
                                                    </span>
                                                </td>
                                                <td className="px-4 py-3 text-sm text-gray-600">{log.resultCount || 0}건</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ==========================================
        // 메인 관리 컴포넌트
        // ==========================================
        const MainContentManagement = ({ settings, setSettings }) => {
            const [formData, setFormData] = useState(settings);
            const [saving, setSaving] = useState(false);
            const saveTimeoutRef = React.useRef(null);
            
            useEffect(() => {
                setFormData(settings);
            }, [settings]);
            
            // 실시간 저장 (debounce 적용)
            useEffect(() => {
                if (saveTimeoutRef.current) {
                    clearTimeout(saveTimeoutRef.current);
                }
                
                // 폼 데이터가 변경되면 1초 후 자동 저장
                saveTimeoutRef.current = setTimeout(async () => {
                    if (window.firebaseService) {
                        try {
                            await window.firebaseService.updateSettings(formData);
                            setSettings(formData);
                            setSaving(false);
                        } catch (error) {
                            
                            setSaving(false);
                        }
                    }
                }, 1000);
                
                return () => {
                    if (saveTimeoutRef.current) {
                        clearTimeout(saveTimeoutRef.current);
                    }
                };
            }, [formData]);
            
            const handleSave = async () => {
                if (saveTimeoutRef.current) {
                    clearTimeout(saveTimeoutRef.current);
                }
                setSaving(true);
                try {
                    await window.firebaseService.updateSettings(formData);
                    setSettings(formData);
                    alert('저장되었습니다.');
                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '저장 중 오류가 발생했습니다.';
                    alert(`저장에 실패했습니다.\n${errorMessage}`);
                } finally {
                    setSaving(false);
                }
            };
            
            const handleChange = (field, value) => {
                setSaving(true);
                setFormData({...formData, [field]: value});
            };
            
            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <h3 className="text-xl font-bold text-dark mb-6">메인 페이지 텍스트 관리</h3>
                    <div className="space-y-6">
                        {/* Hero 섹션 */}
                        <div className="border-b border-gray-200 pb-6">
                            <h4 className="font-bold text-dark mb-4">Hero 섹션</h4>
                            <div className="space-y-4">
                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                    <textarea
                                        value={formData.hero_title || ''}
                                        onChange={(e) => handleChange('hero_title', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="3"
                                        placeholder="함께 성장하는\n청년 사업가 커뮤니티\n부산청년사업가들"
                                    />
                                                                        </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                    <textarea
                                        value={formData.hero_desc || ''}
                                        onChange={(e) => handleChange('hero_desc', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="2"
                                        placeholder="부산 지역 청년 사업가들이 모여 아이디어를 공유하고, 네트워킹하며 함께 성장해나가는 공간입니다."
                                    />
                                                </div>
                                                                </div>
                                            </div>
                    
                        {/* 통계 섹션 */}
                        <div className="border-b border-gray-200 pb-6">
                            <h4 className="font-bold text-dark mb-4">통계 섹션</h4>
                            <div className="grid grid-cols-2 gap-4">
                                {[1, 2, 3, 4].map(num => (
                                    <div key={num} className="space-y-2">
                                        <label className="block text-sm font-bold text-gray-700">통계 {num}</label>
                                        <input
                                            type="text"
                                            value={formData[`stat_${num}_val`] || ''}
                                            onChange={(e) => handleChange(`stat_${num}_val`, e.target.value)}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none mb-2"
                                            placeholder="값 (예: 200+)"
                                        />
                                        <input
                                            type="text"
                                            value={formData[`stat_${num}_desc`] || ''}
                                            onChange={(e) => handleChange(`stat_${num}_desc`, e.target.value)}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="설명 (예: 활동중인 사업가)"
                                        />
                                    </div>
                                ))}
                            </div>
                                                        </div>
                                
                        {/* CTA 섹션 */}
                        <div className="border-b border-gray-200 pb-6">
                            <h4 className="font-bold text-dark mb-4">CTA 섹션</h4>
                                            <div className="space-y-4">
                                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                    <input
                                        type="text"
                                        value={formData.cta_title || ''}
                                        onChange={(e) => handleChange('cta_title', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        placeholder="사업의 꿈을 현실로!"
                                    />
                                                        </div>
                                                                    <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                    <textarea
                                        value={formData.cta_desc || ''}
                                        onChange={(e) => handleChange('cta_desc', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="2"
                                        placeholder="혼자 고민하지 마세요..."
                                    />
                                                                    </div>
                                                                    </div>
                                                                    </div>
                        
                        {/* Features 섹션 */}
                                                <div>
                            <h4 className="font-bold text-dark mb-4">Features 섹션</h4>
                                                <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                <input
                                    type="text"
                                    value={formData.features_title || ''}
                                    onChange={(e) => handleChange('features_title', e.target.value)}
                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                    placeholder="함께할 때 더 멀리 갈 수 있습니다"
                                />
                                                                    </div>
                                                                    </div>
                                
                        {/* 저장 버튼 및 상태 표시 */}
                        <div className="flex justify-between items-center pt-6">
                            <div className="text-sm text-gray-500">
                                {saving ? '저장 중...' : '변경사항이 자동으로 저장됩니다'}
                            </div>
                            <button
                                onClick={handleSave}
                                disabled={saving}
                                className="px-8 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors disabled:opacity-50"
                            >
                                {saving ? '저장 중...' : '즉시 저장'}
                            </button>
                        </div>
                                                                </div>
                                </div>
            );
        };
        
        // ==========================================
        // 회원 관리 컴포넌트
        // ==========================================
        const UserManagement = ({ users, setUsers }) => {
            const [selectedUser, setSelectedUser] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [editFormData, setEditFormData] = useState({});
            
            const handleEdit = (user) => {
                setSelectedUser(user);
                setEditFormData({
                    approvalStatus: user.approvalStatus || 'pending',
                    isAdmin: user.isAdmin || false,
                    memberGrade: user.memberGrade || '일반회원'
                });
                setShowEditModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!selectedUser) return;
                try {
                    await window.firebaseService.updateUser(selectedUser.id, editFormData);
                    const updatedUsers = users.map(u => 
                        u.id === selectedUser.id ? {...u, ...editFormData} : u
                    );
                    setUsers(updatedUsers);
                    setShowEditModal(false);
                    alert('수정되었습니다.');
                                                                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '수정 중 오류가 발생했습니다.';
                    alert(`수정에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            const handleDelete = async (user) => {
                if (!confirm(`정말 ${user.name || user.email} 회원을 삭제하시겠습니까?`)) return;
                try {
                    await window.firebaseService.deleteUser(user.id);
                    setUsers(users.filter(u => u.id !== user.id));
                    alert('삭제되었습니다.');
                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '삭제 중 오류가 발생했습니다.';
                    alert(`삭제에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <h3 className="text-xl font-bold text-dark mb-6">회원 관리</h3>
                    <div className="overflow-x-auto">
                            <table className="w-full">
                            <thead>
                                <tr className="border-b border-gray-200">
                                    <th className="text-left p-4 font-bold text-dark">이름</th>
                                    <th className="text-left p-4 font-bold text-dark">이메일</th>
                                    <th className="text-left p-4 font-bold text-dark">회원 유형</th>
                                    <th className="text-left p-4 font-bold text-dark">승인 상태</th>
                                    <th className="text-left p-4 font-bold text-dark">가입일</th>
                                    <th className="text-left p-4 font-bold text-dark">액션</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {users.length === 0 ? (
                                    <tr>
                                        <td colSpan="6" className="text-center py-8 text-gray-400">회원이 없습니다.</td>
                                    </tr>
                                ) : (
                                    users.map(user => {
                                        const isHaetban = user.name === '햇반' || 
                                                         user.email === 'haetban@bcsa-b190f.firebaseapp.com' || 
                                                         (user.isAdmin === true && user.name === '햇반');
                                        return (
                                        <tr key={user.id || user.uid} className="border-b border-gray-100 hover:bg-gray-50">
                                            <td className="p-4 font-bold text-dark">
                                                {user.name || '이름 없음'}
                                                {isHaetban && (
                                                    <span className="ml-2 text-xs px-2 py-1 bg-red-100 text-red-700 rounded font-bold">
                                                        관리자
                                                    </span>
                                                )}
                                            </td>
                                            <td className="p-4 text-gray-600">{user.email || '-'}</td>
                                            <td className="p-4 text-gray-600">{user.userType || '-'}</td>
                                                <td className="p-4">
                                                    <span className={`text-xs px-2 py-1 rounded font-bold ${
                                                    user.approvalStatus === 'approved' ? 'bg-green-100 text-green-700' :
                                                    user.approvalStatus === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                                    'bg-red-100 text-red-700'
                                                }`}>
                                                    {user.approvalStatus === 'approved' ? '승인' :
                                                     user.approvalStatus === 'pending' ? '대기' : '거부'}
                                                    </span>
                                                </td>
                                            <td className="p-4 text-gray-600">
                                                {user.createdAt?.toDate ? 
                                                    user.createdAt.toDate().toLocaleDateString('ko-KR') :
                                                    user.createdAt ? new Date(user.createdAt).toLocaleDateString('ko-KR') : '-'}
                                            </td>
                                            <td className="p-4">
                                                <div className="flex gap-2">
                                                                <button 
                                                        onClick={() => handleEdit(user)}
                                                        className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                                    >
                                                        <Icons.Edit size={16} />
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(user)}
                                                        className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                                    >
                                                        <Icons.Trash size={16} />
                                                    </button>
                                                </div>
                                            </td>
                                                    </tr>
                                        );
                                    })
                                )}
                                </tbody>
                            </table>
                                        </div>
                                        
                    {/* 수정 모달 */}
                    {showEditModal && selectedUser && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={() => setShowEditModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
                                <h4 className="text-xl font-bold text-dark mb-4">회원 수정</h4>
                                        <div className="space-y-4">
                                                <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">승인 상태</label>
                                        <select
                                            value={editFormData.approvalStatus}
                                            onChange={(e) => setEditFormData({...editFormData, approvalStatus: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        >
                                            <option value="pending">대기</option>
                                            <option value="approved">승인</option>
                                            <option value="rejected">거부</option>
                                                </select>
                                                </div>
                                                <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">회원 등급</label>
                                        <input
                                            type="text"
                                            value={editFormData.memberGrade}
                                            onChange={(e) => setEditFormData({...editFormData, memberGrade: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="일반회원"
                                            />
                                                </div>
                                    <div className="flex items-center gap-2">
                                        <input
                                            type="checkbox"
                                            checked={editFormData.isAdmin}
                                            onChange={(e) => setEditFormData({...editFormData, isAdmin: e.target.checked})}
                                        />
                                        <label className="text-sm font-bold text-gray-700">관리자 권한</label>
                                                    </div>
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => setShowEditModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                                        >
                                        취소
                                    </button>
                                        <button
                                            onClick={handleSaveEdit}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            저장
                                                                </button>
                                    </div>
                                                            </div>
                                                                </div>
                                                            </div>
                                    )}
                                                    </div>
            );
        };

        // ==========================================
        // 게시글 관리 컴포넌트
        // ==========================================
        const PostManagement = ({ posts, setPosts }) => {
            const [selectedPost, setSelectedPost] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [editFormData, setEditFormData] = useState({});
            
            const handleEdit = (post) => {
                setSelectedPost(post);
                setEditFormData({
                    title: post.title || '',
                    content: post.content || '',
                    category: post.category || ''
                });
                setShowEditModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!selectedPost) return;
                try {
                    await window.firebaseService.updatePost(selectedPost.id, editFormData);
                    const updatedPosts = posts.map(p => 
                        p.id === selectedPost.id ? {...p, ...editFormData} : p
                    );
                    setPosts(updatedPosts);
                    setShowEditModal(false);
                    alert('수정되었습니다.');
                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '수정 중 오류가 발생했습니다.';
                    alert(`수정에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            const handleDelete = async (post) => {
                if (!confirm(`정말 "${post.title}" 게시글을 삭제하시겠습니까?`)) return;
                try {
                    await window.firebaseService.deletePost(post.id);
                    setPosts(posts.filter(p => p.id !== post.id));
                    alert('삭제되었습니다.');
                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '삭제 중 오류가 발생했습니다.';
                    alert(`삭제에 실패했습니다.\n${errorMessage}`);
                }
            };
                            
                            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <h3 className="text-xl font-bold text-dark mb-6">게시글 관리</h3>
                    <div className="space-y-4">
                        {posts.length === 0 ? (
                            <p className="text-center py-8 text-gray-400">게시글이 없습니다.</p>
                        ) : (
                            posts.map(post => (
                                <div key={post.id} className="border border-gray-200 rounded-xl p-4 hover:bg-gray-50">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                            <h4 className="font-bold text-dark mb-2">{post.title || '제목 없음'}</h4>
                                            <p className="text-sm text-gray-600 mb-2">{post.author || '작성자 없음'}</p>
                                            <p className="text-sm text-gray-500">{post.category || '카테고리 없음'}</p>
                                    </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => handleEdit(post)}
                                                className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                            >
                                                <Icons.Edit size={16} />
                                            </button>
                                            <button
                                                onClick={() => handleDelete(post)}
                                                className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                            >
                                                <Icons.Trash size={16} />
                                            </button>
                                    </div>
                                                    </div>
                                                    </div>
                            ))
                        )}
                    </div>
                    
                    {/* 수정 모달 */}
                    {showEditModal && selectedPost && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={() => setShowEditModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <h4 className="text-xl font-bold text-dark mb-4">게시글 수정</h4>
                                <div className="space-y-4">
                                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                        <input
                                            type="text"
                                            value={editFormData.title}
                                            onChange={(e) => setEditFormData({...editFormData, title: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        />
                                                    </div>
                                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">내용</label>
                                        <textarea
                                            value={editFormData.content}
                                            onChange={(e) => setEditFormData({...editFormData, content: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            rows="10"
                                        />
                                                    </div>
                                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">카테고리</label>
                                        <input
                                            type="text"
                                            value={editFormData.category}
                                            onChange={(e) => setEditFormData({...editFormData, category: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        />
                                                    </div>
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => setShowEditModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                                        >
                                            취소
                                        </button>
                                        <button
                                            onClick={handleSaveEdit}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            저장
                                        </button>
                                                    </div>
                                                    </div>
                            </div>
                                                    </div>
                                                )}
                                                    </div>
            );
        };
        
        // ==========================================
        // 프로그램 관리 컴포넌트
        // ==========================================
        const ProgramManagement = ({ seminars, setSeminars }) => {
            const [selectedSeminar, setSelectedSeminar] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [showAddModal, setShowAddModal] = useState(false);
            const [showMapModal, setShowMapModal] = useState(false);
            const [editFormData, setEditFormData] = useState({});
            
            const handleEdit = (seminar) => {
                setSelectedSeminar(seminar);
                setEditFormData({
                    title: seminar.title || '',
                    description: seminar.description || '',
                    date: seminar.date || '',
                    location: seminar.location || ''
                });
                setShowEditModal(true);
            };
            
            const handleAdd = () => {
                setSelectedSeminar(null);
                setEditFormData({
                    title: '',
                    description: '',
                    date: '',
                    location: ''
                });
                setShowAddModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!selectedSeminar) return;
                try {
                    await window.firebaseService.updateSeminar(selectedSeminar.id, editFormData);
                    const updatedSeminars = seminars.map(s => 
                        s.id === selectedSeminar.id ? {...s, ...editFormData} : s
                    );
                    setSeminars(updatedSeminars);
                    setShowEditModal(false);
                    alert('수정되었습니다.');
                                                            } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '수정 중 오류가 발생했습니다.';
                    alert(`수정에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            const handleSaveAdd = async () => {
                try {
                    await window.firebaseService.createSeminar(editFormData);
                    const newSeminars = await window.firebaseService.getSeminars();
                    setSeminars(newSeminars);
                    setShowAddModal(false);
                    alert('추가되었습니다.');
                                                            } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '추가 중 오류가 발생했습니다.';
                    alert(`추가에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            const handleDelete = async (seminar) => {
                if (!confirm(`정말 "${seminar.title}" 프로그램을 삭제하시겠습니까?`)) return;
                try {
                    await window.firebaseService.deleteSeminar(seminar.id);
                    setSeminars(seminars.filter(s => s.id !== seminar.id));
                    alert('삭제되었습니다.');
                                                            } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '삭제 중 오류가 발생했습니다.';
                    alert(`삭제에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-bold text-dark">프로그램 관리</h3>
                        <button
                            onClick={handleAdd}
                            className="px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors flex items-center gap-2"
                        >
                            <Icons.Plus size={20} />
                            추가
                                </button>
                    </div>
                    <div className="space-y-4">
                        {seminars.length === 0 ? (
                            <p className="text-center py-8 text-gray-400">프로그램이 없습니다.</p>
                        ) : (
                            seminars.map(seminar => (
                                <div key={seminar.id} className="border border-gray-200 rounded-xl p-4 hover:bg-gray-50">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                            <h4 className="font-bold text-dark mb-2">{seminar.title || '제목 없음'}</h4>
                                            <p className="text-sm text-gray-600 mb-2">{seminar.description || '설명 없음'}</p>
                                            <p className="text-sm text-gray-500">{seminar.date || '날짜 없음'} | {seminar.location || '장소 없음'}</p>
                                        </div>
                                        <div className="flex gap-2">
                                <button
                                                onClick={() => handleEdit(seminar)}
                                                className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                            >
                                                <Icons.Edit size={16} />
                                </button>
                                <button
                                                onClick={() => handleDelete(seminar)}
                                                className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                            >
                                                <Icons.Trash size={16} />
                                </button>
                            </div>
                        </div>
                                </div>
                            ))
                        )}
                                    </div>
                    
                    {/* 수정 모달 */}
                    {showEditModal && selectedSeminar && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={() => setShowEditModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <h4 className="text-xl font-bold text-dark mb-4">프로그램 수정</h4>
                                <div className="space-y-4">
                        <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                        <input
                                            type="text"
                                            value={editFormData.title}
                                            onChange={(e) => setEditFormData({...editFormData, title: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                />
                            </div>
                        <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                            <textarea 
                                            value={editFormData.description}
                                            onChange={(e) => setEditFormData({...editFormData, description: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            rows="5"
                            />
                            </div>
                                <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">날짜</label>
                                            <input 
                                            type="text"
                                            value={editFormData.date}
                                            onChange={(e) => setEditFormData({...editFormData, date: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        />
                                </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">장소</label>
                                        <div className="flex gap-2">
                                            <input 
                                                type="text"
                                                value={editFormData.location}
                                                onChange={(e) => setEditFormData({...editFormData, location: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                placeholder="장소를 검색하거나 직접 입력하세요"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => openKakaoPlacesSearch((place) => {
                                                    setEditFormData({
                                                        ...editFormData,
                                                        location: `${place.name} (${place.address})`
                                                    });
                                                })}
                                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors whitespace-nowrap"
                                            >
                                                장소 검색
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => setShowMapModal(true)}
                                                className="px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors whitespace-nowrap"
                                            >
                                                지도 선택
                                            </button>
                                        </div>
                </div>
                        <div className="flex gap-4">
                                    <button
                                            onClick={() => setShowEditModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                            >
                                            취소
                                    </button>
                                    <button
                                            onClick={handleSaveEdit}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                            >
                                저장
                                    </button>
                                </div>
                            </div>
                                </div>
                        </div>
                    )}
                    
                    {/* 추가 모달 */}
                    {showAddModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={() => setShowAddModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <h4 className="text-xl font-bold text-dark mb-4">프로그램 추가</h4>
                    <div className="space-y-4">
                            <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                    <input
                                type="text"
                                            value={editFormData.title}
                                            onChange={(e) => setEditFormData({...editFormData, title: e.target.value})}
                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                            />
                                </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                        <textarea
                                            value={editFormData.description}
                                            onChange={(e) => setEditFormData({...editFormData, description: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            rows="5"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">날짜</label>
                                        <input
                                            type="text"
                                            value={editFormData.date}
                                            onChange={(e) => setEditFormData({...editFormData, date: e.target.value})}
                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        />
                                    </div>
                        <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">장소</label>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={editFormData.location}
                                                onChange={(e) => setEditFormData({...editFormData, location: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                placeholder="장소를 검색하거나 직접 입력하세요"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => openKakaoPlacesSearch((place) => {
                                                    setEditFormData({
                                                        ...editFormData,
                                                        location: `${place.name} (${place.address})`
                                                    });
                                                })}
                                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors whitespace-nowrap"
                                            >
                                                장소 검색
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => setShowMapModal(true)}
                                                className="px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors whitespace-nowrap"
                                            >
                                                지도 선택
                                            </button>
                                        </div>
                            </div>
                                    <div className="flex gap-4">
                                <button
                                            onClick={() => setShowAddModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                        >
                                            취소
                                </button>
                                        <button
                                            onClick={handleSaveAdd}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            추가
                                        </button>
                            </div>
                        </div>
                                </div>
                            </div>
                    )}
                    
                    {/* 지도 선택 모달 */}
                    {showMapModal && (
                        <KakaoMapModal
                            onClose={() => setShowMapModal(false)}
                            onSelectLocation={(location) => {
                                setEditFormData({
                                    ...editFormData,
                                    location: location.address || `${location.name || ''} (${location.address || ''})`.trim()
                                });
                                setShowMapModal(false);
                            }}
                            initialLocation={editFormData.location ? null : null}
                        />
                    )}
                </div>
            );
        };

        // ==========================================
        // 관리자 대시보드 컴포넌트
        // ==========================================
        const AdminDashboard = () => {
            // 인증 상태
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isChecking, setIsChecking] = useState(false);
            const [loginEmail, setLoginEmail] = useState('haetban@bcsa.co.kr');
            const [loginPassword, setLoginPassword] = useState('0219');
            const [authError, setAuthError] = useState(null);
            const [currentAdmin, setCurrentAdmin] = useState(null);
            
            // 활성 메뉴 (사이드바)
            const [activeMenu, setActiveMenu] = useState('dashboard');
            
            // Firebase 초기화 상태
            const [firebaseReady, setFirebaseReady] = useState(false);
            
            // Firebase 데이터 상태
            const [users, setUsers] = useState([]);
            const [seminars, setSeminars] = useState([]);
            const [posts, setPosts] = useState([]);
            const [settings, setSettings] = useState({});
            const [loading, setLoading] = useState(false);
            
            // 기존 데이터 상태 (호환성 유지 - Firebase에서 로드됨)
            const [members, setMembers] = useState([]);
            const [content, setContent] = useState({});
            const [menuEnabled, setMenuEnabled] = useState({
                '홈': true,
                '소개': true,
                '프로그램': true,
                '부청사 회원': true,
                '커뮤니티': true,
                '입찰공고': true,
                '후원': true,
            });
            const [menuNames, setMenuNames] = useState({
                '홈': '홈',
                '소개': '소개',
                '프로그램': '프로그램',
                '부청사 회원': '부청사 회원',
                '커뮤니티': '커뮤니티',
                '입찰공고': '입찰공고',
                '후원': '후원',
            });
            
            // 관리자 계정 자동 생성 (햇반 계정)
            useEffect(() => {
                if (!firebaseReady) {
                    return;
                }
                
                const createAdminAccount = async () => {
                    if (!window.firebaseServices || !window.firebaseService || !window.authService) {
                        return;
                    }
                    
                    try {
                        const adminEmail = 'haetban@bcsa.co.kr';
                        const adminPassword = '0219';
                        
                        // 기존 계정 확인
                        try {
                            await window.firebaseServices.auth.signInWithEmailAndPassword(adminEmail, adminPassword);
                            // 로그인 성공 = 계정 존재
                        } catch (signInError) {
                            // 계정이 없거나 비밀번호가 틀린 경우
                            if (signInError.code === 'auth/user-not-found' || signInError.code === 'auth/wrong-password') {
                                // 새 계정 생성
                                try {
                                    const userCredential = await window.firebaseServices.auth.createUserWithEmailAndPassword(adminEmail, adminPassword);
                                    const user = userCredential.user;
                                    
                                    // Firestore에 사용자 데이터 생성
                                    await window.firebaseService.createUser({
                                        uid: user.uid,
                                        email: adminEmail,
                                        name: '햇반',
                                        isAdmin: true,
                                        approvalStatus: 'approved',
                                        role: 'admin',
                                        createdAt: new Date().toISOString(),
                                        updatedAt: new Date().toISOString()
                                    });
                                    
                                } catch (createError) {
                                }
                            }
                        }
                    } catch (error) {
                    }
                };
                
                // 페이지 로드 후 관리자 계정 생성 시도
                createAdminAccount();
            }, [firebaseReady]);
            
            // 관리자 인증 체크 (초기 로드 시 - 로그인된 사용자 확인)
            useEffect(() => {
                if (!firebaseReady) return;
                
                const checkAuth = async () => {
                    // Firebase 서비스 확인
                    if (!window.firebaseServices || !window.firebaseServices.auth) {
                        return;
                    }
                    
                    // 현재 로그인된 사용자 확인
                    const currentUser = window.firebaseServices.auth.currentUser;
                    if (currentUser) {
                        const result = await checkAdminAccess();
                        if (result.isAdmin) {
                            setIsAuthenticated(true);
                        }
                    }
                };
                
                // Firebase Auth 상태 변경 리스너
                if (window.firebaseServices && window.firebaseServices.auth) {
                    const unsubscribe = window.firebaseServices.auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            const result = await checkAdminAccess();
                            if (result.isAdmin) {
                                setIsAuthenticated(true);
                            } else {
                                setIsAuthenticated(false);
                            }
                        } else {
                            setIsAuthenticated(false);
                        }
                    });
                    
                    return () => unsubscribe();
                }
            }, [firebaseReady]);
            
            // Firebase 초기화 대기 함수
            const waitForFirebase = () => {
                return new Promise((resolve) => {
                    let attempts = 0;
                    const maxAttempts = 100; // 최대 10초 대기 (100ms * 100)
                    
                    const checkInterval = setInterval(() => {
                        attempts++;
                        if (window.firebaseServices && window.firebaseService && window.firebaseServices.db) {
                            clearInterval(checkInterval);
                            resolve(true);
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            resolve(false);
                        }
                    }, 100);
                });
            };
            
            // Firebase 데이터 로드
            useEffect(() => {
                if (!isAuthenticated || !firebaseReady) return;
                
                const loadFirebaseData = async () => {
                    setLoading(true);
                    
                    // Firebase 서비스 확인 (이미 firebaseReady가 true이므로 추가 확인만)
                    if (!window.firebaseServices || !window.firebaseService || !window.firebaseServices.db) {
                        alert('Firebase 서비스가 초기화되지 않았습니다. 페이지를 새로고침해주세요.');
                        setLoading(false);
                        return;
                    }
                    
                    let retryCount = 0;
                    const maxRetries = 3;
                    
                    const attemptLoad = async () => {
                        try {
                            if (window.firebaseService && window.firebaseService.getUsers) {
                                const usersData = await window.firebaseService.getUsers();
                                setUsers(usersData || []);
                                setMembers(usersData || []);
                            }
                            
                            if (window.firebaseService && window.firebaseService.getSeminars) {
                                const seminarsData = await window.firebaseService.getSeminars();
                                setSeminars(seminarsData || []);
                            }
                            
                            if (window.firebaseService && window.firebaseService.getPosts) {
                                const postsData = await window.firebaseService.getPosts();
                                setPosts(postsData || []);
                            }
                            
                            if (window.firebaseService && window.firebaseService.getSettings) {
                                const settingsData = await window.firebaseService.getSettings();
                                setSettings(settingsData || {});
                            }
                        } catch (error) {
                            retryCount++;
                            
                            if (retryCount < maxRetries) {
                                setTimeout(attemptLoad, 1000 * retryCount); // 지수 백오프
                            } else {
                                alert('데이터를 불러오는 중 오류가 발생했습니다: ' + (error.message || error) + '\n\n브라우저 콘솔을 확인해주세요.');
                                setLoading(false);
                            }
                            return;
                        }
                        
                        setLoading(false);
                    };
                    
                    attemptLoad();
                };
                
                loadFirebaseData();
            }, [isAuthenticated, firebaseReady]);
            
            // 실시간 업데이트 구독
            useEffect(() => {
                if (!isAuthenticated || !firebaseReady) return;
                
                const setupSubscriptions = async () => {
                    // Firebase 초기화 대기
                    const isInitialized = await waitForFirebase();
                    if (!isInitialized) {
                        return;
                    }
                    
                    let unsubscribeUsers = null;
                    let unsubscribeSeminars = null;
                    let unsubscribePosts = null;
                    
                    try {
                        if (window.firebaseService && window.firebaseService.subscribeUsers) {
                            unsubscribeUsers = window.firebaseService.subscribeUsers((users) => {
                                setUsers(users || []);
                                setMembers(users || []);
                            });
                        }
                        
                        if (window.firebaseService && window.firebaseService.subscribeSeminars) {
                            unsubscribeSeminars = window.firebaseService.subscribeSeminars((seminars) => {
                                setSeminars(seminars || []);
                            });
                        }
                        
                        if (window.firebaseService && window.firebaseService.subscribePosts) {
                            unsubscribePosts = window.firebaseService.subscribePosts((posts) => {
                                setPosts(posts || []);
                            });
                        }
                    } catch (error) {
                    }
                    
                    return () => {
                        if (unsubscribeUsers) unsubscribeUsers();
                        if (unsubscribeSeminars) unsubscribeSeminars();
                        if (unsubscribePosts) unsubscribePosts();
                    };
                };
                
                const cleanup = setupSubscriptions();
                
                return () => {
                    if (cleanup && typeof cleanup.then === 'function') {
                        cleanup.then(cleanupFn => {
                            if (cleanupFn) cleanupFn();
                        });
                    } else if (cleanup) {
                        cleanup();
                    }
                };
            }, [isAuthenticated]);
            
            // ==========================================
            // CSV 자동 백업 함수
            // ==========================================
            
            /**
             * 데이터를 CSV 형식으로 변환하여 Google Sheets에 백업
             * @param {Array} data - 백업할 데이터 배열
             * @param {string} type - 데이터 타입 ('members', 'seminars', 'posts')
             */
            const backupToCSV = async (data, type) => {
                try {
                    if (!data || !Array.isArray(data) || data.length === 0) {
                        return;
                    }
                
                    // CSV 변환
                    const csvContent = convertToCSV(data);
                    
                    if (!csvContent) {
                        
                        addLog('ERROR', type, `CSV 변환 실패: ${type}`, currentUser?.name);
                        return;
                    }
                    
                    // Google Apps Script API를 통한 백업 시도
                    if (typeof CONFIG !== 'undefined' && CONFIG.GOOGLE_APPS_SCRIPT?.WEB_APP_URL) {
                        try {
                            // Google Apps Script 웹앱에 CSV 데이터 전송
                            const response = await fetch(CONFIG.GOOGLE_APPS_SCRIPT.WEB_APP_URL, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    action: 'backupCSV',
                                    type: type,
                                    csvContent: csvContent,
                                    data: data
                                })
                            });
                            
                            if (response.ok) {
                                const result = await response.json();
                                if (result.success) {
                                    addLog('BACKUP', type, `${type} 데이터 CSV 백업 완료 (${data.length}개)`, currentUser?.name);
                                } else {
                                    throw new Error(result.error || '백업 실패');
                                }
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        } catch (error) {
                            
                            addLog('ERROR', type, `CSV 백업 실패: ${error.message}`, currentUser?.name);
                            // Google Apps Script 실패 시 CSV 다운로드 링크 생성 (수동 백업)
                            // downloadCSVFile(csvContent, type); // 주석 처리: 자동 다운로드는 사용자 경험을 해칠 수 있음
                        }
                    } else {
                        // Google Apps Script URL이 없으면 로그만 기록
                        addLog('INFO', type, `CSV 백업 준비 완료 (Google Apps Script URL 미설정)`, currentUser?.name);
                    }
                } catch (error) {
                    
                    addLog('ERROR', type, `CSV 백업 중 오류 발생: ${error.message}`, currentUser?.name);
                }
            };
            
            /**
             * CSV 파일 다운로드 (수동 백업용)
             * @param {string} csvContent - CSV 문자열
             * @param {string} type - 파일 타입
             */
            const downloadCSVFile = (csvContent, type) => {
                try {
                    const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' }); // BOM 추가 (한글 깨짐 방지)
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `backup_${type}_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                } catch (error) {
                    
                }
            };
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            // CSV 백업은 필요시에만 사용 (현재는 사용하지 않음)
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            // 테스트 데이터 필터링은 필요시에만 사용 (현재는 사용하지 않음)
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            
            // 로그 추가 함수
            const addLog = (action, targetType, details, adminName, itemInfo) => {
                const newLog = {
                    timestamp: new Date().toLocaleString('ko-KR'),
                    action,
                    targetType,
                    details,
                    adminName: adminName || currentUser?.name || '시스템',
                    itemInfo: itemInfo || '',
                };
                setLogs(prev => [...prev, newLog]);
            };
            
            const createAdminAccount = async () => {
                try {
                    const adminEmail = 'haetban@bcsa-b190f.firebaseapp.com';
                    const adminPassword = '021900';
                    
                    // Firebase Auth에 계정 생성 시도
                    let authUser = null;
                    try {
                        // 이미 존재하는 계정인지 확인
                        const existingUser = await window.firebaseServices.auth.signInWithEmailAndPassword(adminEmail, adminPassword).catch(() => null);
                        if (existingUser) {
                            authUser = existingUser.user;
                        }
                    } catch (error) {
                        // 계정이 없으면 생성
                        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                            try {
                                const userCredential = await window.firebaseServices.auth.createUserWithEmailAndPassword(adminEmail, adminPassword);
                                authUser = userCredential.user;
                            } catch (createError) {
                                
                                throw createError;
                            }
                } else {
                            throw error;
                        }
                    }
                    
                    if (!authUser) {
                        throw new Error('관리자 계정을 생성하거나 찾을 수 없습니다.');
                    }
                    
                    // Firestore에 관리자 정보 저장
                    const existingUserDoc = await window.firebaseService.getUser(authUser.uid);
                    if (!existingUserDoc) {
                        await window.firebaseService.createUser({
                            uid: authUser.uid,
                            email: adminEmail,
                            name: '햇반',
                            isAdmin: true,
                            approvalStatus: 'approved',
                            memberGrade: '관리자',
                            userType: '사업자'
                        });
                        
                                                            } else {
                        // 기존 사용자 정보 업데이트
                        await window.firebaseService.updateUser(authUser.uid, {
                            isAdmin: true,
                            approvalStatus: 'approved',
                            memberGrade: '관리자',
                            name: '햇반'
                        });
                        
                    }
                    
                    return authUser;
                                                                } catch (error) {
                    
                    throw error;
                }
            };
            
            // 데이터 초기화 함수
            const handleResetAllData = async () => {
                // 확인 다이얼로그
                const confirmMessage = '⚠️ 경고: 모든 데이터가 삭제됩니다.\n\n' +
                    '다음 데이터가 삭제됩니다:\n' +
                    '- 모든 사용자 (햇반 계정 제외)\n' +
                    '- 모든 프로그램\n' +
                    '- 모든 게시글\n' +
                    '- 모든 신청\n' +
                    '- 모든 설정 (기본값으로 초기화)\n\n' +
                    '이 작업은 되돌릴 수 없습니다. 정말 진행하시겠습니까?';
                
                if (!confirm(confirmMessage)) {
                    return;
                }
                
                // 최종 확인
                if (!confirm('정말로 모든 데이터를 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다!')) {
                                                                    return;
                                                                }
                
                setLoading(true);
                try {
                    const adminEmail = 'haetban@bcsa-b190f.firebaseapp.com';
                    
                    // 1. 사용자 삭제 (햇반 계정 제외)
                    const deletedUsers = await window.firebaseService.deleteAllUsers(adminEmail);
                    
                    // 2. 프로그램 삭제
                    const deletedSeminars = await window.firebaseService.deleteAllSeminars();
                    
                    // 3. 게시글 삭제
                    const deletedPosts = await window.firebaseService.deleteAllPosts();
                    
                    // 4. 신청 삭제
                    const deletedApplications = await window.firebaseService.deleteAllApplications();
                    
                    // 5. Settings 초기화
                    await window.firebaseService.resetSettings(defaultContent);
                    
                    // 6. '햇반' 관리자 계정 생성/확인
                    await createAdminAccount();
                    
                    // 상태 업데이트
                    setUsers([]);
                    setSeminars([]);
                    setPosts([]);
                    setSettings(defaultContent);
                    
                    alert(`✅ 데이터 초기화가 완료되었습니다.\n\n` +
                        `삭제된 데이터:\n` +
                        `- 사용자: ${deletedUsers}명\n` +
                        `- 프로그램: ${deletedSeminars}개\n` +
                        `- 게시글: ${deletedPosts}개\n` +
                        `- 신청: ${deletedApplications}개\n` +
                        `- 설정: 초기화됨\n\n` +
                        `햇반 관리자 계정이 생성/확인되었습니다.`);
                    
                    // 페이지 새로고침
                    window.location.reload();
                                                            } catch (error) {
                    
                    alert(`데이터 초기화 중 오류가 발생했습니다.\n${error.message}`);
                                                            } finally {
                    setLoading(false);
                }
            };
            
            // 로그인 핸들러
            const handleLogin = async (email, password) => {
                try {
                    setIsChecking(true);
                    setAuthError(null);
                    
                    // Firebase 서비스 확인
                    if (!window.firebaseServices || !window.firebaseServices.auth) {
                        throw new Error('Firebase가 초기화되지 않았습니다. 페이지를 새로고침해주세요.');
                    }
                    
                    if (!window.authService) {
                        throw new Error('인증 서비스가 로드되지 않았습니다. 페이지를 새로고침해주세요.');
                    }
                    
                    
                    // Firebase Auth 로그인 시도
                    await window.authService.signIn(email, password);
                    
                    // 관리자 권한 확인
                    const result = await checkAdminAccess();
                    
                    if (result.isAdmin) {
                        setIsAuthenticated(true);
                        setCurrentAdmin(result.user);
                        setAuthError(null);
                    } else {
                        setIsAuthenticated(false);
                        setCurrentAdmin(null);
                        setAuthError('관리자 권한이 없습니다.');
                        // 로그아웃
                        await window.firebaseServices.auth.signOut();
                    }
                } catch (error) {
                    
                    setIsAuthenticated(false);
                    setCurrentAdmin(null);
                    
                    // Firebase 오류 메시지를 한국어로 변환
                    let errorMessage = '로그인에 실패했습니다.';
                    const errorMsg = error.message || '';
                    const isInvalidCredentials = errorMsg.includes('INVALID_LOGIN_CREDENTIALS') || 
                                                 errorMsg.includes('INVALID_LOGIN');
                    
                    if (error.code === 'auth/user-not-found' || 
                        (error.code === 'auth/internal-error' && isInvalidCredentials)) {
                        errorMessage = '등록되지 않은 계정입니다. 계정을 생성합니다.';
                    } else if (error.code === 'auth/wrong-password' || 
                               error.code === 'auth/invalid-credential' ||
                               (error.code === 'auth/internal-error' && isInvalidCredentials)) {
                        errorMessage = '비밀번호가 올바르지 않습니다. Firebase Console에서 비밀번호를 재설정해주세요.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = '올바른 형식이 아닙니다.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = '너무 많은 시도가 있었습니다. 잠시 후 다시 시도해주세요.';
                    } else if (error.code === 'auth/email-already-in-use') {
                        errorMessage = '이미 사용 중인 이메일입니다. 로그인을 시도합니다.';
                    } else if (error.code === 'auth/network-request-failed') {
                        errorMessage = '네트워크 오류가 발생했습니다. 인터넷 연결을 확인해주세요.';
                    } else if (error.code === 'auth/internal-error') {
                        errorMessage = 'Firebase 인증 오류가 발생했습니다. 페이지를 새로고침하거나 잠시 후 다시 시도해주세요.';
                    } else if (error.message) {
                        errorMessage = error.message;
                    }
                    
                    setAuthError(errorMessage);
                } finally {
                    setIsChecking(false);
                }
            };
            
            const handleLogout = async () => {
                try {
                    if (window.firebaseServices && window.firebaseServices.auth) {
                        await window.firebaseServices.auth.signOut();
                    }
                } catch (error) {
                }
                localStorage.removeItem('admin_authenticated');
                setIsAuthenticated(false);
                setLoginEmail('haetban@bcsa.co.kr');
                setLoginPassword('0219');
                setAuthError(null);
                setCurrentAdmin(null);
            };
            
            // 로그인 폼 제출 핸들러
            const handleLoginSubmit = async (e) => {
                e.preventDefault();
                await handleLogin(loginEmail, loginPassword);
            };
            
            // 인증 실패 - 로그인 화면
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-soft flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-lg p-8 max-w-md w-full">
                            <div className="text-center mb-6">
                                <Icons.Lock className="w-16 h-16 text-brand mx-auto mb-4" />
                                <h2 className="text-2xl font-bold text-dark mb-2">관리자 로그인</h2>
                                <p className="text-gray-600">관리자 계정으로 로그인해주세요</p>
                            </div>
                            
                            <form onSubmit={handleLoginSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">이메일</label>
                                    <input
                                        type="email"
                                        value={loginEmail}
                                        onChange={(e) => {
                                            setLoginEmail(e.target.value);
                                            setAuthError(null);
                                        }}
                                        placeholder="이메일을 입력하세요"
                                        className="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        required
                                        autoFocus
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">비밀번호</label>
                                    <input
                                        type="password"
                                        value={loginPassword}
                                        onChange={(e) => {
                                            setLoginPassword(e.target.value);
                                            setAuthError(null);
                                        }}
                                        placeholder="비밀번호를 입력하세요"
                                        className="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        required
                                    />
                                </div>
                                
                                {authError && (
                                    <p className="text-sm text-red-600 text-center">{authError}</p>
                                )}
                                
                                <button
                                    type="submit"
                                    disabled={isChecking}
                                    className={`w-full py-3 rounded-xl font-bold transition-colors ${
                                        isChecking
                                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                            : 'bg-brand text-white hover:bg-blue-700'
                                    }`}
                                >
                                    {isChecking ? '로그인 중...' : '로그인'}
                                </button>
                            </form>
                            
                            <button
                                onClick={() => window.location.href = 'index.html'}
                                className="w-full mt-4 py-3 border-2 border-gray-200 text-gray-600 rounded-xl font-bold hover:bg-gray-50 transition-colors"
                            >
                                메인 페이지로 이동
                            </button>
                        </div>
                    </div>
                );
            }
            
            // 메뉴 항목 정의
            const menuItems = [
                { id: 'dashboard', label: '대시보드 홈', icon: Icons.List },
                { id: 'main', label: '메인 관리', icon: Icons.Settings },
                { id: 'users', label: '회원 관리', icon: Icons.Users },
                { id: 'posts', label: '게시글 관리', icon: Icons.MessageSquare },
                { id: 'programs', label: '프로그램 관리', icon: Icons.Calendar },
            ];

            return (
                <div className="min-h-screen bg-soft flex">
                    {/* 사이드바 */}
                    <div className="w-64 bg-white border-r border-gray-200 fixed h-screen overflow-y-auto">
                        <div className="p-6 border-b border-gray-200">
                            <h1 className="text-xl font-bold text-dark mb-1">관리자 대시보드</h1>
                            <p className="text-xs text-gray-500">부산청년사업가</p>
                                                    </div>
                        <nav className="p-4">
                            {menuItems.map(item => (
                                                            <button
                                    key={item.id}
                                    onClick={() => setActiveMenu(item.id)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-colors mb-2 ${
                                        activeMenu === item.id
                                            ? 'bg-brand text-white'
                                            : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    {React.createElement(item.icon, { size: 20 })}
                                    {item.label}
                                </button>
                            ))}
                        </nav>
                                            </div>
                        
                    {/* 메인 콘텐츠 영역 */}
                    <div className="flex-1 ml-64">
                        {/* 헤더 */}
                        <div className="bg-white border-b border-gray-200 sticky top-0 z-50">
                            <div className="px-6 py-4 flex items-center justify-between">
                                <h2 className="text-xl font-bold text-dark">
                                    {menuItems.find(m => m.id === activeMenu)?.label || '대시보드'}
                                </h2>
                                <div className="flex items-center gap-4">
                                    <button 
                                        onClick={handleResetAllData}
                                        className="px-4 py-2 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 transition-colors"
                                        title="모든 데이터 초기화"
                            >
                                        데이터 초기화
                                    </button>
                                    <button
                                        onClick={handleLogout}
                                        className="px-4 py-2 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition-colors"
                            >
                                        로그아웃
                                    </button>
                                <button
                                        onClick={() => window.location.href = 'index.html'}
                                        className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-bold text-gray-700 transition-colors"
                        >
                                        메인으로
                                                </button>
                                            </div>
                                    </div>
                                </div>
                    
                    {/* 콘텐츠 영역 */}
                        <div className="p-6">
                            {loading && (
                                <div className="text-center py-12">
                                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-brand mx-auto mb-4"></div>
                                    <p className="text-gray-600">데이터를 불러오는 중...</p>
                            </div>
                        )}
                            {!loading && activeMenu === 'dashboard' && (
                                <DashboardHome users={users} posts={posts} seminars={seminars} />
                            )}
                            {!loading && activeMenu === 'main' && (
                                <MainContentManagement settings={settings} setSettings={setSettings} />
                            )}
                            {!loading && activeMenu === 'users' && (
                                <UserManagement users={users} setUsers={setUsers} />
                            )}
                            {!loading && activeMenu === 'posts' && (
                                <PostManagement posts={posts} setPosts={setPosts} />
                            )}
                            {!loading && activeMenu === 'programs' && (
                                <ProgramManagement seminars={seminars} setSeminars={setSeminars} />
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 기존 탭 컴포넌트들 (호환성 유지)
        const MembersTab = ({ members, setMembers, addLog, currentUser }) => {
            return <UserManagement users={members} setUsers={setMembers} />;
        };
        
        const SeminarsTab = ({ seminars, setSeminars, addLog, currentUser }) => {
            return <ProgramManagement seminars={seminars} setSeminars={setSeminars} />;
        };
        
        const CommunityTab = ({ posts, setPosts, addLog, currentUser }) => {
            return <PostManagement posts={posts} setPosts={setPosts} />;
        };
        
        // 기존 코드 유지 (호환성)
        const MasterTab = ({ addLog, currentUser }) => {
            return (
                                        <div>
                    <p>마스터 탭 (기존 코드 유지)</p>
                </div>
            );
        };

        const InquiriesTab = ({ addLog, currentUser }) => {
            return (
                <div>
                    <p>문의하기 탭 (기존 코드 유지)</p>
                </div>
            );
        };
        
        // 기존 코드의 불완전한 부분 제거됨 (새로운 레이아웃으로 대체)
        // 마스터 로그인 모달은 새로운 레이아웃에서 사용하지 않으므로 제거됨

        // ==========================================
        // App 컴포넌트
        // ==========================================
        const App = () => {
            return <AdminDashboard />;
        };

        // 렌더링
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        })(); // IIFE 종료 - 스코프 격리
    </script>
</body>
</html>
