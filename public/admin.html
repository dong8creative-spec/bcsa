<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드 - 부산청년사업가</title>
    
    <!-- checkFirebaseConfig 함수를 가장 먼저 정의 (다른 스크립트 로드 전) -->
    <script>
        // 즉시 함수 정의 보장
        window.checkFirebaseConfig = window.checkFirebaseConfig || function() {
            try {
                return {
                    initialized: typeof firebase !== 'undefined',
                    config: typeof window.firebaseConfig !== 'undefined' ? window.firebaseConfig : {},
                    services: {
                        firebaseServices: !!window.firebaseServices,
                        firebaseService: !!window.firebaseService,
                        authService: !!window.authService
                    },
                    app: typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0 ? firebase.apps[0].name : 'NOT_INITIALIZED'
                };
            } catch (error) {
                return {
                    initialized: false,
                    error: error.message || 'Unknown error'
                };
            }
        };
    </script>
    
    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 다음 우편번호 서비스 + 카카오 맵 SDK (장소 선택용) -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=f35b8c9735d77cced1235c5775c7c3b1&libraries=services" defer></script>

    <!-- Firebase SDK v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- Firebase Configuration (동기 로드) -->
    <!-- checkFirebaseConfig 함수는 이미 head 섹션에서 정의됨 -->
    <script src="./assets/js/firebase-config.js"></script>
    
    <!-- Firebase Services (동기 로드) -->
    <script src="./assets/js/firebase-service.js"></script>
    <script src="./assets/js/auth-service.js"></script>
    
    <!-- Firebase 초기화 확인 스크립트 -->
    <script>
        // Firebase 초기화 확인 및 재시도 로직
        (function() {
            let attempts = 0;
            const maxAttempts = 50; // 최대 5초 대기
            
            const checkFirebaseInit = setInterval(() => {
                attempts++;
                
                if (window.firebaseServices && window.firebaseServices.db) {
                    clearInterval(checkFirebaseInit);
                    
                    // 초기화 완료 이벤트 발생
                    window.dispatchEvent(new CustomEvent('firebaseInitialized'));
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkFirebaseInit);
                    
                    // 초기화 실패 이벤트 발생
                    window.dispatchEvent(new CustomEvent('firebaseInitFailed', {
                        detail: {
                            firebaseSDK: typeof firebase !== 'undefined',
                            firebaseServices: !!window.firebaseServices,
                            firebaseService: !!window.firebaseService,
                            authService: !!window.authService
                        }
                    }));
                }
            }, 100);
        })();
    </script>

    <!-- 설정 파일 -->
    <script src="./assets/js/config.js"></script>
    
    <!-- 유틸리티 함수 -->
    <script src="./assets/js/utils.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif'],
                        pop: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        brand: '#0045a5', 
                        accent: '#3b82f6',
                        dark: '#0f172a',
                        gray: '#64748b',
                        soft: '#f8fafc',
                    },
                }
            }
        }
    </script>

    <style>
        body { background-color: #ffffff; color: #1e293b; font-family: 'Noto Sans KR', sans-serif; }
        .modal-scroll::-webkit-scrollbar { width: 6px; }
        .modal-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        .modal-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .modal-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        
        // 즉시 실행 함수로 스코프 격리
        (function() {
        const { useState, useEffect, useRef } = React;
        
        // 카카오맵 SDK 로드 완료를 기다리는 헬퍼 함수
        const waitForKakaoMap = () => {
            return new Promise((resolve, reject) => {
                // 이미 로드된 경우
                if (window.kakao && window.kakao.maps) {
                    resolve(window.kakao);
                    return;
                }
                
                // 스크립트가 로드 중인지 확인
                const existingScript = document.querySelector('script[src*="dapi.kakao.com"]');
                
                // 스크립트가 있으면 onload 이벤트를 기다림
                if (existingScript) {
                    // 이미 로드되었는지 확인
                    if (window.kakao && window.kakao.maps) {
                        resolve(window.kakao);
                        return;
                    }
                    
                    // onload 이벤트 리스너 추가
                    const onScriptLoad = () => {
                        if (window.kakao && window.kakao.maps) {
                            resolve(window.kakao);
                        } else {
                            // 추가 대기 (스크립트 로드 후 kakao 객체 초기화까지 시간 필요)
                            let attempts = 0;
                            const maxAttempts = 50; // 5초 대기
                            const checkInterval = setInterval(() => {
                                attempts++;
                                if (window.kakao && window.kakao.maps) {
                                    clearInterval(checkInterval);
                                    resolve(window.kakao);
                                } else if (attempts >= maxAttempts) {
                                    clearInterval(checkInterval);
                                    reject(new Error('카카오맵 SDK가 로드되었지만 초기화에 실패했습니다.'));
                                }
                            }, 100);
                        }
                    };
                    
                    const onScriptError = () => {
                        reject(new Error('카카오맵 SDK 스크립트 로드에 실패했습니다.'));
                    };
                    
                    existingScript.addEventListener('load', onScriptLoad, { once: true });
                    existingScript.addEventListener('error', onScriptError, { once: true });
                    
                    // 스크립트가 이미 로드되었을 수도 있으므로 즉시 확인
                    if (existingScript.readyState && (existingScript.readyState === 'complete' || existingScript.readyState === 'loaded')) {
                        setTimeout(() => {
                            if (window.kakao && window.kakao.maps) {
                                resolve(window.kakao);
                            } else {
                                onScriptLoad();
                            }
                        }, 100);
                    } else {
                        // readyState가 없거나 아직 로드 중인 경우 짧은 대기 후 확인
                        setTimeout(() => {
                            if (window.kakao && window.kakao.maps) {
                                resolve(window.kakao);
                            }
                            // 그렇지 않으면 onload 이벤트를 기다림
                        }, 200);
                    }
                    
                    return;
                }
                
                // 스크립트가 없으면 동적으로 로드
                loadKakaoMapScript()
                    .then(() => {
                        // 로드 후 kakao 객체 초기화까지 대기
                        let attempts = 0;
                        const maxAttempts = 50; // 5초 대기
                        const checkInterval = setInterval(() => {
                            attempts++;
                            if (window.kakao && window.kakao.maps) {
                                clearInterval(checkInterval);
                                resolve(window.kakao);
                            } else if (attempts >= maxAttempts) {
                                clearInterval(checkInterval);
                                reject(new Error('카카오맵 SDK를 로드할 수 없습니다.'));
                            }
                        }, 100);
                    })
                    .catch(reject);
            });
        };
        
        // 카카오맵 SDK 동적 로드 함수
        const loadKakaoMapScript = () => {
            return new Promise((resolve, reject) => {
                // 이미 로드 중이거나 로드된 경우
                if (window.kakao && window.kakao.maps) {
                    resolve();
                    return;
                }
                
                const existingScript = document.querySelector('script[src*="dapi.kakao.com"]');
                if (existingScript) {
                    // 이미 스크립트가 있으면 로드 완료를 기다림
                    existingScript.addEventListener('load', resolve);
                    existingScript.addEventListener('error', reject);
                    return;
                }
                
                // 스크립트 동적 생성 및 로드
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=f35b8c9735d77cced1235c5775c7c3b1&libraries=services';
                script.async = true;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        };
        
        // 카카오맵 Places API를 활용한 장소 검색 함수
        const openKakaoPlacesSearch = async (onComplete) => {
            try {
                // 카카오맵 SDK 로드 완료 대기
                await waitForKakaoMap();
                
            // Places 서비스 초기화 확인
            if (!window.kakao || !window.kakao.maps || !window.kakao.maps.services) {
                alert('카카오맵 API가 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                    return;
                }
            } catch (error) {
                alert('카카오맵 API를 로드할 수 없습니다. 페이지를 새로고침해주세요.');
                console.error('카카오맵 SDK 로드 오류:', error);
                return;
            }
            
            // 검색 모달 생성
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/70';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-dark">장소 검색</h3>
                        <button type="button" class="p-2 hover:bg-gray-100 rounded-lg" onclick="this.closest('.fixed').remove()">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="mb-4">
                        <input 
                            type="text" 
                            id="place-search-input" 
                            placeholder="장소명, 주소, 건물명 등을 입력하세요" 
                            class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                        />
                    </div>
                    <div id="place-search-results" class="flex-1 overflow-y-auto space-y-2"></div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const searchInput = modal.querySelector('#place-search-input');
            const resultsContainer = modal.querySelector('#place-search-results');
            const placesService = new window.kakao.maps.services.Places();
            
            // 검색 실행 함수
            const performSearch = (keyword) => {
                if (!keyword.trim()) {
                    resultsContainer.innerHTML = '<p class="text-center text-gray-400 py-4">검색어를 입력해주세요.</p>';
                    return;
                }
                
                placesService.keywordSearch(keyword, (data, status) => {
                    resultsContainer.innerHTML = '';
                    
                    if (status === window.kakao.maps.services.Status.OK) {
                        if (data.length === 0) {
                            resultsContainer.innerHTML = '<p class="text-center text-gray-400 py-4">검색 결과가 없습니다.</p>';
                            return;
                        }
                        
                        data.forEach((place) => {
                            const item = document.createElement('div');
                            item.className = 'p-4 border border-gray-200 rounded-xl hover:bg-gray-50 cursor-pointer';
                            item.innerHTML = `
                                <div class="font-bold text-dark mb-1">${place.place_name}</div>
                                <div class="text-sm text-gray-600">${place.address_name || place.road_address_name || ''}</div>
                                ${place.phone ? `<div class="text-xs text-gray-500 mt-1">${place.phone}</div>` : ''}
                            `;
                            item.onclick = () => {
                                onComplete({
                                    name: place.place_name,
                                    address: place.road_address_name || place.address_name,
                                    lat: parseFloat(place.y),
                                    lng: parseFloat(place.x),
                                    phone: place.phone || '',
                                    placeUrl: place.place_url || ''
                                });
                                modal.remove();
                            };
                            resultsContainer.appendChild(item);
                        });
                    } else {
                        resultsContainer.innerHTML = '<p class="text-center text-gray-400 py-4">검색 중 오류가 발생했습니다.</p>';
                    }
                });
            };
            
            // 엔터 키 검색
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch(searchInput.value);
                }
            });
            
            // 모달 외부 클릭 시 닫기
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // 검색 입력 포커스
            searchInput.focus();
        };
        
        
        // ==========================================
        // 관리자 인증 설정
        // ==========================================
        // 관리자 접근 코드
        const ADMIN_CODE = '021900';

        // ==========================================
        // 아이콘 컴포넌트
        // ==========================================
        const Icons = {
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Clock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            ChevronLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            Restaurant: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"/><path d="M21 15v7"/></svg>,
            MessageSquare: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Lock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            ArrowLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Edit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Trash: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>,
            List: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            MapPin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
            CheckCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            Camera: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
        };
        
        // ==========================================
        // 유틸리티 함수
        // ==========================================
        // localStorage 함수 제거됨 - Firebase를 사용하므로 불필요
        // formatDate는 utils.js에서 로드됨 (중복 선언 방지)
        
        // 카카오 지도 모달 컴포넌트
        const KakaoMapModal = ({ onClose, onSelectLocation, initialLocation }) => {
            const mapContainerRef = React.useRef(null);
            const mapRef = React.useRef(null);
            const markerRef = React.useRef(null);
            const geocoderRef = React.useRef(null);
            const placesServiceRef = React.useRef(null);
            const [selectedPlace, setSelectedPlace] = useState(null);
            const [searchKeyword, setSearchKeyword] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [mapLoaded, setMapLoaded] = useState(false);
            
            React.useEffect(() => {
                // 카카오맵 SDK 로드 완료 대기
                let isMounted = true;
                
                waitForKakaoMap().then(() => {
                    if (!isMounted) return;
                    
                    // 카카오 지도 SDK가 로드되었는지 확인
                    if (typeof window.kakao === 'undefined' || !window.kakao.maps) {
                        console.error('카카오맵 SDK가 로드되지 않았습니다.');
                    return;
                }
                    
                    const kakao = window.kakao;
                
                // 지도 초기화
                const center = initialLocation 
                    ? new kakao.maps.LatLng(initialLocation.lat, initialLocation.lng)
                    : new kakao.maps.LatLng(35.1796, 129.0756); // 부산 중심
                
                const mapOption = {
                    center: center,
                    level: 3
                };
                
                mapRef.current = new kakao.maps.Map(mapContainerRef.current, mapOption);
                geocoderRef.current = new kakao.maps.services.Geocoder();
                
                // Places 서비스 초기화
                if (kakao.maps.services && kakao.maps.services.Places) {
                    placesServiceRef.current = new kakao.maps.services.Places();
                } else {
                        console.warn('카카오맵 Places 서비스를 사용할 수 없습니다.');
                }
                
                // 지도 컨트롤 추가
                const zoomControl = new kakao.maps.ZoomControl();
                mapRef.current.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
                
                // 초기 위치에 마커 표시
                if (initialLocation) {
                    markerRef.current = new kakao.maps.Marker({
                        position: center,
                        map: mapRef.current
                    });
                    setSelectedPlace({
                        name: initialLocation.name || '',
                        address: initialLocation.address || '',
                        lat: initialLocation.lat,
                        lng: initialLocation.lng
                    });
                }
                
                // 지도 클릭 이벤트
                kakao.maps.event.addListener(mapRef.current, 'click', (mouseEvent) => {
                    const latlng = mouseEvent.latLng;
                    
                    // 기존 마커 제거
                    if (markerRef.current) {
                        markerRef.current.setMap(null);
                    }
                    
                    // 새 마커 추가
                    markerRef.current = new kakao.maps.Marker({
                        position: latlng,
                        map: mapRef.current
                    });
                    
                    // 역지오코딩으로 주소 가져오기
                    geocoderRef.current.coord2Address(latlng.getLng(), latlng.getLat(), (result, status) => {
                        if (status === kakao.maps.services.Status.OK) {
                            const roadAddr = result[0].road_address;
                            const jibunAddr = result[0].address;
                            
                            setSelectedPlace({
                                name: '',
                                address: roadAddr ? roadAddr.address_name : jibunAddr.address_name,
                                lat: latlng.getLat(),
                                lng: latlng.getLng()
                            });
                        } else {
                            setSelectedPlace({
                                name: '',
                                address: `위도: ${latlng.getLat().toFixed(6)}, 경도: ${latlng.getLng().toFixed(6)}`,
                                lat: latlng.getLat(),
                                lng: latlng.getLng()
                            });
                        }
                    });
                });
                
                setMapLoaded(true);
                }).catch((error) => {
                    console.error('카카오맵 SDK 로드 오류:', error);
                    alert('카카오맵을 로드할 수 없습니다. 페이지를 새로고침해주세요.');
                });
                
                return () => {
                    isMounted = false;
                };
            }, [initialLocation]);
            
            // 장소 검색
            const handleSearch = () => {
                if (!searchKeyword.trim()) {
                    alert('검색어를 입력해주세요.');
                    return;
                }
                
                if (!mapLoaded) {
                    alert('지도가 아직 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                    return;
                }
                
                if (!placesServiceRef.current) {
                    
                    alert('검색 서비스를 사용할 수 없습니다. 페이지를 새로고침해주세요.');
                    return;
                }
                
                setSearchResults([]); // 검색 결과 초기화
                
                // 키워드 검색
                placesServiceRef.current.keywordSearch(searchKeyword, (data, status) => {
                    if (status === kakao.maps.services.Status.OK) {
                        const results = data.map(place => ({
                            name: place.place_name,
                            address: place.road_address_name || place.address_name,
                            lat: parseFloat(place.y),
                            lng: parseFloat(place.x)
                        }));
                        setSearchResults(results);
                        
                        if (results.length === 0) {
                            alert('검색 결과가 없습니다.');
                        }
                    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                        // 키워드 검색 실패 시 주소 검색 시도
                        if (geocoderRef.current) {
                            geocoderRef.current.addressSearch(searchKeyword, (result, geocodeStatus) => {
                                if (geocodeStatus === kakao.maps.services.Status.OK) {
                                    const results = result.map(item => ({
                                        name: '',
                                        address: item.road_address ? item.road_address.address_name : item.address_name,
                                        lat: parseFloat(item.y),
                                        lng: parseFloat(item.x)
                                    }));
                                    setSearchResults(results);
                                } else {
                                    alert('검색 결과가 없습니다.');
                                    setSearchResults([]);
                                }
                            });
                        } else {
                            alert('검색 결과가 없습니다.');
                        }
                    } else {
                        
                        alert('검색 중 오류가 발생했습니다. 다시 시도해주세요.');
                    }
                });
            };
            
            // 검색 결과 선택
            const handleSelectResult = (result) => {
                const latlng = new kakao.maps.LatLng(result.lat, result.lng);
                
                mapRef.current.setCenter(latlng);
                mapRef.current.setLevel(3);
                
                // 기존 마커 제거
                if (markerRef.current) {
                    markerRef.current.setMap(null);
                }
                
                // 새 마커 추가
                markerRef.current = new kakao.maps.Marker({
                    position: latlng,
                    map: mapRef.current
                });
                
                setSelectedPlace({
                    name: result.name || '',
                    address: result.address,
                    lat: result.lat,
                    lng: result.lng
                });
                
                setSearchResults([]);
            };
            
            // 장소 확정
            const handleConfirm = () => {
                if (!selectedPlace) {
                    alert('지도에서 장소를 선택해주세요.');
                    return;
                }
                onSelectLocation(selectedPlace);
                onClose();
            };
            
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70" onClick={(e) => e.target === e.currentTarget && onClose()}>
                    <div className="bg-white rounded-3xl p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-xl font-bold text-dark">장소 선택 (카카오 맵)</h3>
                            <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                <Icons.X size={20} />
                            </button>
                        </div>
                        
                        {/* 검색 */}
                        <div className="flex gap-2 mb-4">
                            <input
                                type="text"
                                value={searchKeyword}
                                onChange={(e) => setSearchKeyword(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                placeholder="주소 또는 장소명 검색"
                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                            />
                            <button
                                onClick={handleSearch}
                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                            >
                                검색
                            </button>
                        </div>
                        
                        {/* 검색 결과 */}
                        {searchResults.length > 0 ? (
                            <div className="mb-4 max-h-40 overflow-y-auto border border-gray-200 rounded-xl">
                                {searchResults.map((result, idx) => (
                                    <div
                                        key={idx}
                                        onClick={() => handleSelectResult(result)}
                                        className="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0"
                                    >
                                        {result.name ? <p className="font-bold text-sm text-dark">{result.name}</p> : null}
                                        <p className="text-sm text-gray-600">{result.address}</p>
                                    </div>
                                ))}
                            </div>
                        ) : null}
                        
                        {/* 지도 */}
                        <div 
                            ref={mapContainerRef} 
                            className="flex-1 min-h-[400px] rounded-xl border-2 border-gray-200 overflow-hidden"
                        />
                        
                        {/* 선택된 장소 정보 */}
                        {selectedPlace && (
                            <div className="mt-4 p-4 bg-yellow-50 border border-yellow-300 rounded-xl">
                                <p className="text-sm font-bold text-yellow-700 mb-1">선택된 장소</p>
                                {selectedPlace.name && <p className="font-bold text-sm text-dark">{selectedPlace.name}</p>}
                                <p className="text-sm text-gray-700">{selectedPlace.address}</p>
                                <p className="text-xs text-gray-500 mt-1">
                                    좌표: {selectedPlace.lat?.toFixed(6)}, {selectedPlace.lng?.toFixed(6)}
                                </p>
                            </div>
                        )}
                        
                        {/* 버튼 */}
                        <div className="flex gap-3 mt-4">
                            <button
                                onClick={onClose}
                                className="flex-1 py-3 border-2 border-gray-200 rounded-xl font-bold text-gray-600 hover:bg-gray-50 transition-colors"
                            >
                                취소
                            </button>
                            <button
                                onClick={handleConfirm}
                                disabled={!selectedPlace}
                                className={`flex-1 py-3 rounded-xl font-bold transition-colors ${
                                    selectedPlace 
                                        ? 'bg-brand text-white hover:bg-blue-700' 
                                        : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                }`}
                            >
                                선택 완료
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // DateTimePicker 커스텀 컴포넌트
        const DateTimePicker = ({ value, onChange, placeholder }) => {
            const [showCalendar, setShowCalendar] = useState(false);
            const [currentMonth, setCurrentMonth] = useState(() => {
                if (value) {
                    const match = value.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (match) return new Date(parseInt(match[1]), parseInt(match[2]) - 1, 1);
                }
                return new Date();
            });
            const [selectedDate, setSelectedDate] = useState(() => {
                if (value) {
                    const match = value.match(/(\d{4})\.(\d{2})\.(\d{2})/);
                    if (match) return new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
                }
                return null;
            });
            const [selectedTime, setSelectedTime] = useState(() => {
                if (value) {
                    const timeMatch = value.match(/(\d{2}):(\d{2})/);
                    if (timeMatch) return `${timeMatch[1]}:${timeMatch[2]}`;
                }
                return '10:00';
            });
            const calendarRef = React.useRef(null);
            
            // 외부 클릭 시 달력 닫기
            React.useEffect(() => {
                const handleClickOutside = (event) => {
                    if (calendarRef.current && !calendarRef.current.contains(event.target)) {
                        setShowCalendar(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);
            
            // 월의 일수 계산
            const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
            
            // 월의 첫 번째 요일
            const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();
            
            // 달력 날짜 배열 생성
            const generateCalendarDays = () => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const daysInMonth = getDaysInMonth(year, month);
                const firstDay = getFirstDayOfMonth(year, month);
                const days = [];
                
                // 빈 칸 (이전 달)
                for (let i = 0; i < firstDay; i++) {
                    days.push(null);
                }
                // 현재 달 날짜
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(new Date(year, month, day));
                }
                return days;
            };
            
            // 시간 옵션 생성 (30분 단위)
            const timeOptions = [];
            for (let h = 0; h < 24; h++) {
                for (let m = 0; m < 60; m += 30) {
                    const hour = h.toString().padStart(2, '0');
                    const minute = m.toString().padStart(2, '0');
                    timeOptions.push(`${hour}:${minute}`);
                }
            }
            
            // 날짜 선택
            const handleDateClick = (date) => {
                setSelectedDate(date);
            };
            
            // 선택 완료
            const handleConfirm = () => {
                if (selectedDate) {
                    const year = selectedDate.getFullYear();
                    const month = (selectedDate.getMonth() + 1).toString().padStart(2, '0');
                    const day = selectedDate.getDate().toString().padStart(2, '0');
                    const dateTimeStr = `${year}.${month}.${day} ${selectedTime}`;
                    onChange(dateTimeStr);
                    setShowCalendar(false);
                }
            };
            
            // 이전 달
            const prevMonth = () => {
                setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1));
            };
            
            // 다음 달
            const nextMonth = () => {
                setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1));
            };
            
            // 오늘 날짜 체크
            const isToday = (date) => {
                if (!date) return false;
                const today = new Date();
                return date.getDate() === today.getDate() && 
                       date.getMonth() === today.getMonth() && 
                       date.getFullYear() === today.getFullYear();
            };
            
            // 선택된 날짜 체크
            const isSelected = (date) => {
                if (!date || !selectedDate) return false;
                return date.getDate() === selectedDate.getDate() && 
                       date.getMonth() === selectedDate.getMonth() && 
                       date.getFullYear() === selectedDate.getFullYear();
            };
            
            const weekDays = ['일', '월', '화', '수', '목', '금', '토'];
            
            return (
                <div className="relative" ref={calendarRef}>
                    <div 
                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none cursor-pointer flex items-center justify-between bg-white"
                        onClick={() => setShowCalendar(!showCalendar)}
                    >
                        <span className={value ? 'text-gray-900' : 'text-gray-400'}>
                            {value || placeholder || '날짜와 시간을 선택하세요'}
                        </span>
                        <Icons.Calendar size={20} className="text-gray-400" />
                    </div>
                    
                    {showCalendar && (
                        <div className="absolute top-full left-0 mt-2 bg-white border-2 border-gray-200 rounded-2xl shadow-xl z-50 p-4 w-80">
                            {/* 월 네비게이션 */}
                            <div className="flex items-center justify-between mb-4">
                                <button type="button" onClick={prevMonth} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                    <Icons.ChevronLeft size={20} />
                                </button>
                                <span className="font-bold text-lg">
                                    {currentMonth.getFullYear()}년 {currentMonth.getMonth() + 1}월
                                </span>
                                <button type="button" onClick={nextMonth} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                                    <Icons.ChevronRight size={20} />
                                </button>
                            </div>
                            
                            {/* 요일 헤더 */}
                            <div className="grid grid-cols-7 gap-1 mb-2">
                                {weekDays.map((day, idx) => (
                                    <div key={day} className={`text-center text-sm font-bold py-2 ${idx === 0 ? 'text-red-500' : idx === 6 ? 'text-blue-500' : 'text-gray-600'}`}>
                                        {day}
                                    </div>
                                ))}
                            </div>
                            
                            {/* 날짜 그리드 */}
                            <div className="grid grid-cols-7 gap-1 mb-4">
                                {generateCalendarDays().map((date, idx) => (
                                    <button
                                        key={idx}
                                        type="button"
                                        disabled={!date}
                                        onClick={() => date && handleDateClick(date)}
                                        className={`
                                            w-9 h-9 rounded-lg text-sm font-medium transition-all
                                            ${!date ? 'invisible' : ''}
                                            ${date && isSelected(date) ? 'bg-brand text-white' : ''}
                                            ${date && isToday(date) && !isSelected(date) ? 'border-2 border-brand text-brand' : ''}
                                            ${date && !isSelected(date) && !isToday(date) ? 'hover:bg-gray-100' : ''}
                                            ${date && idx % 7 === 0 ? 'text-red-500' : ''}
                                            ${date && idx % 7 === 6 ? 'text-blue-500' : ''}
                                        `}
                                    >
                                        {date ? date.getDate() : ''}
                                    </button>
                                ))}
                            </div>
                            
                            {/* 시간 선택 */}
                            <div className="flex items-center gap-3 mb-4 pb-4 border-b border-gray-200">
                                <Icons.Clock size={18} className="text-gray-400" />
                                <span className="text-sm font-bold text-gray-700">시간:</span>
                                <select 
                                    value={selectedTime}
                                    onChange={(e) => setSelectedTime(e.target.value)}
                                    className="flex-1 p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                >
                                    {timeOptions.map(time => (
                                        <option key={time} value={time}>{time}</option>
                                    ))}
                                </select>
                            </div>
                            
                            {/* 선택 완료 버튼 */}
                            <button
                                type="button"
                                onClick={handleConfirm}
                                disabled={!selectedDate}
                                className={`w-full py-3 rounded-xl font-bold transition-colors ${
                                    selectedDate 
                                        ? 'bg-brand text-white hover:bg-blue-700' 
                                        : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                }`}
                            >
                                선택 완료
                            </button>
                        </div>
                    )}
                </div>
            );
        };
        
        // 파일을 Base64로 변환
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };
        
        // 이미지 리사이징
        const resizeImage = (file, maxWidth, maxHeight, quality = 0.9) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth || height > maxHeight) {
                            const ratio = Math.min(maxWidth / width, maxHeight / height);
                            width = width * ratio;
                            height = height * ratio;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob((blob) => {
                            if (blob) {
                                const reader = new FileReader();
                                reader.onloadend = () => resolve(reader.result);
                                reader.onerror = reject;
                                reader.readAsDataURL(blob);
                            } else {
                                reject(new Error('이미지 리사이징 실패'));
                            }
                        }, file.type || 'image/png', quality);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };
        
        // ImgBB 이미지 업로드
        const uploadImageToImgBB = async (base64Image, fileName) => {
            try {
                const IMGBB_API_KEY = window.CONFIG?.IMGBB?.API_KEY || '4c975214037cdf1889d5d02a01a7831d';
                // base64 데이터 추출
                const base64Data = base64Image.includes(',') ? base64Image.split(',')[1] : base64Image;
                
                // Blob으로 변환하여 FormData에 추가
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'image/jpeg' });
                
                const formData = new FormData();
                formData.append('key', IMGBB_API_KEY);
                formData.append('image', blob, fileName || 'image.jpg');

                const response = await fetch('https://api.imgbb.com/1/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success && data.data && data.data.url) {
                    return {
                        success: true,
                        url: data.data.url,
                        deleteUrl: data.data.delete_url || null,
                        id: data.data.id
                    };
                } else {
                    throw new Error(data.error?.message || data.error || '이미지 업로드 실패');
                }
            } catch (error) {
                console.error('이미지 업로드 오류:', error);
                throw error;
            }
        };

        // 이미지 URL에 타임스탬프 추가 (캐시 무효화)
        const getImageUrlWithTimestamp = (url) => {
            if (!url) return '';
            const separator = url.includes('?') ? '&' : '?';
            return `${url}${separator}t=${Date.now()}`;
        };

        // 이미지 다운로드
        const downloadImage = async (imageUrl, fileName) => {
            try {
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName || 'image.jpg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                
                alert('이미지 다운로드에 실패했습니다.');
            }
        };
        
        // 해상도 추천 함수
        const getRecommendedResolution = (imageType) => {
            const recommendations = {
                'program': { width: 1200, height: 800, ratio: '16:9', description: '프로그램 이미지' },
                'program-square': { width: 1200, height: 1200, ratio: '1:1', description: '프로그램 이미지 (정사각형)' },
                'hero': { width: 1920, height: 1080, ratio: '16:9', description: 'Hero 이미지' },
                'feature': { width: 1200, height: 800, ratio: '3:2', description: 'Feature 이미지' },
                'activity': { width: 1200, height: 800, ratio: '3:2', description: 'Activity 이미지' },
                'restaurant': { width: 1200, height: 800, ratio: '3:2', description: '맛집 이미지' },
                'donation': { width: 1920, height: 1080, ratio: '16:9', description: 'Donation 이미지' },
                'cta': { width: 1920, height: 1080, ratio: '16:9', description: 'CTA 이미지' }
            };
            return recommendations[imageType] || { width: 1200, height: 800, ratio: '16:9', description: '일반 이미지' };
        };
        
        // 이미지 크롭 함수
        const cropImage = (imageFile, cropArea, outputWidth = null, outputHeight = null) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // 출력 크기 설정 (없으면 크롭 영역 크기 사용) - 정수화
                        const outputW = Math.round(outputWidth || cropArea.width);
                        const outputH = Math.round(outputHeight || cropArea.height);
                        
                        canvas.width = outputW;
                        canvas.height = outputH;
                        
                        // Canvas 렌더링 품질 설정
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        
                        // 크롭 영역 좌표 정수화
                        const sourceX = Math.round(cropArea.x);
                        const sourceY = Math.round(cropArea.y);
                        const sourceWidth = Math.round(cropArea.width);
                        const sourceHeight = Math.round(cropArea.height);
                        
                        // 이미지 크롭 및 리사이즈
                        ctx.drawImage(
                            img,
                            sourceX, sourceY, sourceWidth, sourceHeight,
                            0, 0, outputW, outputH
                        );
                        
                        // base64로 변환 (품질 향상)
                        canvas.toBlob((blob) => {
                            if (blob) {
                                const reader = new FileReader();
                                reader.onloadend = () => resolve(reader.result);
                                reader.onerror = reject;
                                reader.readAsDataURL(blob);
                            } else {
                                reject(new Error('이미지 크롭 실패'));
                            }
                        }, imageFile.type || 'image/jpeg', 0.95);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(imageFile);
            });
        };
        
        // calculateStatus는 utils.js에서 로드됨 (중복 선언 방지)

        // ==========================================
        // 기본 데이터
        // ==========================================
        const defaultContent = {
            hero_title: "함께 성장하는\n청년 사업가 커뮤니티\n부산청년사업가들",
            hero_desc: "부산 지역 청년 사업가들이 모여 아이디어를 공유하고, 네트워킹하며 함께 성장해나가는 공간입니다.",
            // About 페이지 (소개 페이지)
            about_hero_title: "함께 성장하는 사업가 네트워크",
            about_hero_desc: "부산 지역 청년 사업가들의 성장과 연결을 돕는 비즈니스 커뮤니티, 부청사입니다.",
            about_mission_title: "Platform for Businessmen",
            about_mission_desc_1: "부산청년사업가들은 정기적인 네트워킹과 실무 중심의 세미나를 통해 실질적인 도움을 제공합니다.",
            about_mission_desc_2: "업종을 넘어선 협업과 정보 공유를 지원하며, 온·오프라인을 연계해 지속적인 비즈니스 확장을 돕습니다.",
            about_mission_desc_3: "부청사는 단순한 모임을 넘어, 함께 성장하는 플랫폼입니다.",
            about_why_title: "'부청사'가 필요한 이유",
            about_why_subtitle: "혼자 고민하지 마세요. 함께하면 답이 보입니다.",
            about_why_1_title: "고립감/압박감 해소",
            about_why_1_desc: "같은 길을 걷는 동료들과 고민을 나누는 심리적 안전망",
            about_why_2_title: "번아웃 방지",
            about_why_2_desc: "일과 삶의 균형을 찾고 리프레시할 수 있는 기회 제공",
            about_why_3_title: "성장의 한계 극복",
            about_why_3_desc: "다양한 경험 공유를 통해 새로운 인사이트와 협업 기회 획득",
            about_why_4_title: "네트워크 확장",
            about_why_4_desc: "투자자, 고객, 파트너를 만나 실질적인 비즈니스 기회 창출",
            about_history_title: "HISTORY",
            about_history_subtitle: "부산청년사업가들이 걸어온 길",
            about_history_2014_title: "지주회사 설립 기획",
            about_history_2014_desc: "부산청년사업가들 필요성 검토 및 기획",
            about_history_2017_title: "커뮤니티 구축",
            about_history_2017_desc: "회원간 소통 내부망 구축 및 카카오 오픈채팅방 개설",
            about_history_2018_title: "첫 오프라인 활동",
            about_history_2018_desc: "창업자들을 위한 첫 세미나 개최 및 네트워킹 모임 운영",
            about_history_2024_title: "정기 세미나 구축",
            about_history_2024_desc: "창업/세무/마케팅 교육 프로그램 및 정기 모임 활성화",
            about_history_2025_title: "비영리 법인 설립",
            about_history_2025_desc: "공식 단체 법인화 및 온라인 플랫폼(어플) 개발 추진",
            about_future_title: "향후 계획 및 목표",
            about_future_subtitle: "부청사는 멈추지 않고 계속 성장합니다.",
            about_future_1_title: "맞춤형 역량 교육",
            about_future_1_desc: "창업 단계별 실무 교육(세무, 마케팅 등)과 멘토링 강화",
            about_future_2_title: "공공사업 연계",
            about_future_2_desc: "정부·지자체 사업과 협력하여 실질적 혜택 제공",
            about_future_3_title: "온라인 플랫폼",
            about_future_3_desc: "회원들이 연결되고 협업할 수 있는 전용 앱/웹 구축",
            about_future_4_title: "사회공헌 활동",
            about_future_4_desc: "멘토링, 재능기부 등 지역사회와 상생하는 프로그램",
            about_future_5_title: "정책 제안",
            about_future_5_desc: "부산 청년 창업가 실태조사 기반 맞춤형 정책 제안",
            about_future_6_title: "자체 수익모델",
            about_future_6_desc: "교육 콘텐츠, 굿즈 등 지속가능한 운영 기반 마련",
            about_contact_phone: "010-5323-9310",
            about_contact_email: "pujar@naver.com",
            // 페이지 제목 설정
            pageTitles: {
                home: { text: "함께 성장하는\n청년 사업가 커뮤니티\n부산청년사업가들", fontSize: "text-4xl", fontWeight: "font-black" },
                about: { text: "함께 성장하는 사업가 네트워크", fontSize: "text-3xl", fontWeight: "font-bold" },
                programs: { text: "프로그램", fontSize: "text-3xl", fontWeight: "font-bold" },
                members: { text: "부청사 회원", fontSize: "text-3xl", fontWeight: "font-bold" },
                community: { text: "커뮤니티", fontSize: "text-3xl", fontWeight: "font-bold" },
                restaurants: { text: "부산맛집", fontSize: "text-3xl", fontWeight: "font-bold" },
                donation: { text: "후원", fontSize: "text-3xl", fontWeight: "font-bold" },
                bidSearch: { text: "조달청 입찰공고 검색", fontSize: "text-3xl", fontWeight: "font-bold" },
                myPage: { text: "마이페이지", fontSize: "text-3xl", fontWeight: "font-bold" }
            },
            // 이미지 URL 필드
            hero_image: "",
            features_image_1: "",
            features_image_2: "",
            activity_seminar_image: "",
            activity_investment_image: "",
            activity_networking_image: "",
            donation_image: "",
            cta_image: "",
        };

        const defaultMembersData = [];
        const defaultSeminarsData = [];
        const defaultCommunityPosts = [];

        // ==========================================
        // 관리자 인증 체크 함수 (PIN 기반)
        // ==========================================
        const checkAdminAccess = () => {
            // sessionStorage에서 인증 상태 확인
            const isAuth = sessionStorage.getItem('admin_authenticated') === 'true';
            return { isAdmin: isAuth };
        };
        
        // ==========================================
        // 대시보드 홈 컴포넌트
        // ==========================================
        const DashboardHome = ({ users = [], posts = [], seminars = [], menuEnabled, setMenuEnabled, menuNames, setMenuNames, settings = {} }) => {
            const [searchLogs, setSearchLogs] = useState([]);
            const [loadingLogs, setLoadingLogs] = useState(false);
            const refreshIntervalRef = useRef(null);
            const [draggedIndex, setDraggedIndex] = useState(null);
            const [dragOverIndex, setDragOverIndex] = useState(null);

            // 검색 로그 로드 함수
            const loadSearchLogs = async () => {
                if (!window.firebaseService) return;
                setLoadingLogs(true);
                try {
                    const logs = await window.firebaseService.getSearchLogs(50);
                    setSearchLogs(logs || []);
                } catch (error) {
                    
                } finally {
                    setLoadingLogs(false);
                }
            };

            // 컴포넌트 마운트 시 로드 및 주기적 새로고침
            useEffect(() => {
                loadSearchLogs();
                // 5초마다 새로고침
                refreshIntervalRef.current = setInterval(() => {
                    loadSearchLogs();
                }, 5000);

                return () => {
                    if (refreshIntervalRef.current) {
                        clearInterval(refreshIntervalRef.current);
                    }
                };
            }, []);

            // 날짜 포맷 함수
            const formatDateTime = (date) => {
                if (!date) return '-';
                const d = date instanceof Date ? date : new Date(date);
                if (isNaN(d.getTime())) return '-';
                return d.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            };

            const totalUsers = users.length;
            const pendingUsers = users.filter(u => u.approvalStatus === 'pending').length;
            const totalPosts = posts.length;
            const totalPrograms = seminars.length;
            const recentUsers = [...users].sort((a, b) => {
                const aDate = a.createdAt?.toDate ? a.createdAt.toDate() : new Date(a.createdAt);
                const bDate = b.createdAt?.toDate ? b.createdAt.toDate() : new Date(b.createdAt);
                return bDate - aDate;
            }).slice(0, 5);
            const recentPosts = [...posts].slice(0, 5);

            // 메뉴 순서 관리
            const menuKeys = menuEnabled ? Object.keys(menuEnabled) : [];
            const [orderedMenuKeys, setOrderedMenuKeys] = useState(() => {
                try {
                    const savedOrder = localStorage.getItem('busan_ycc_menu_order');
                    if (savedOrder) {
                        const parsedOrder = JSON.parse(savedOrder);
                        const ordered = parsedOrder.filter(key => menuKeys.includes(key));
                        const remaining = menuKeys.filter(key => !parsedOrder.includes(key));
                        return [...ordered, ...remaining];
                    }
                } catch (error) {
                    console.error('메뉴 순서 로드 실패:', error);
                }
                return menuKeys;
            });

            useEffect(() => {
                const savedOrder = localStorage.getItem('busan_ycc_menu_order');
                if (savedOrder) {
                    try {
                        const parsedOrder = JSON.parse(savedOrder);
                        const ordered = parsedOrder.filter(key => menuKeys.includes(key));
                        const remaining = menuKeys.filter(key => !parsedOrder.includes(key));
                        setOrderedMenuKeys([...ordered, ...remaining]);
                    } catch (error) {
                        setOrderedMenuKeys(menuKeys);
                    }
                } else {
                    setOrderedMenuKeys(menuKeys);
                }
            }, [menuKeys.join(',')]);

            const handleDragStart = (e, index) => {
                setDraggedIndex(index);
                e.dataTransfer.effectAllowed = 'move';
                e.target.style.opacity = '0.5';
            };

            const handleDragOver = (e, index) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                setDragOverIndex(index);
            };

            const handleDragLeave = () => {
                setDragOverIndex(null);
            };

            const handleDrop = (e, dropIndex) => {
                e.preventDefault();
                if (draggedIndex === null || draggedIndex === dropIndex) {
                    setDraggedIndex(null);
                    setDragOverIndex(null);
                    return;
                }

                const newMenuKeys = [...orderedMenuKeys];
                const draggedKey = newMenuKeys[draggedIndex];
                newMenuKeys.splice(draggedIndex, 1);
                newMenuKeys.splice(dropIndex, 0, draggedKey);

                // 새로운 순서로 menuEnabled와 menuNames 재구성
                const newMenuEnabled = {};
                const newMenuNames = {};
                newMenuKeys.forEach(key => {
                    newMenuEnabled[key] = menuEnabled[key];
                    newMenuNames[key] = menuNames[key];
                });

                setMenuEnabled(newMenuEnabled);
                setMenuNames(newMenuNames);
                setOrderedMenuKeys(newMenuKeys);
                
                try {
                    // localStorage 저장 (폴백용)
                    localStorage.setItem('busan_ycc_menu_enabled', JSON.stringify(newMenuEnabled));
                    localStorage.setItem('busan_ycc_menu_names', JSON.stringify(newMenuNames));
                    localStorage.setItem('busan_ycc_menu_order', JSON.stringify(newMenuKeys));
                    
                    // Firebase Settings에도 저장
                    if (window.firebaseService && window.firebaseService.updateSettings && settings) {
                        window.firebaseService.updateSettings({
                            ...settings,
                            menuEnabled: newMenuEnabled,
                            menuNames: newMenuNames
                        }).catch(error => {
                            console.error('Firebase 메뉴 순서 저장 실패:', error);
                        });
                    }
                } catch (error) {
                    console.error('메뉴 순서 저장 실패:', error);
                }

                setDraggedIndex(null);
                setDragOverIndex(null);
            };

            const handleDragEnd = (e) => {
                e.target.style.opacity = '1';
                setDraggedIndex(null);
                setDragOverIndex(null);
            };

            return (
                <div className="space-y-6">
                    {/* 통계 카드 */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">전체 회원</p>
                                    <p className="text-3xl font-bold text-dark">{totalUsers}</p>
                                            </div>
                                <Icons.Users className="w-12 h-12 text-blue-500" />
                                            </div>
                                        </div>
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-yellow-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">승인 대기</p>
                                    <p className="text-3xl font-bold text-dark">{pendingUsers}</p>
                                    </div>
                                <Icons.Clock className="w-12 h-12 text-yellow-500" />
                                                        </div>
                                                        </div>
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-green-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">게시글</p>
                                    <p className="text-3xl font-bold text-dark">{totalPosts}</p>
                                                        </div>
                                <Icons.MessageSquare className="w-12 h-12 text-green-500" />
                                </div>
                        </div>
                        <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-purple-500">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600 mb-1">프로그램</p>
                                    <p className="text-3xl font-bold text-dark">{totalPrograms}</p>
                                </div>
                                <Icons.Calendar className="w-12 h-12 text-purple-500" />
                            </div>
                                    </div>
                                                    </div>
                    
                    {/* 최근 데이터 */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* 최근 가입 회원 */}
                        <div className="bg-white rounded-2xl shadow-lg p-6">
                            <h3 className="text-lg font-bold text-dark mb-4">최근 가입 회원</h3>
                            {recentUsers.length === 0 ? (
                                <p className="text-gray-400 text-center py-8">가입한 회원이 없습니다.</p>
                            ) : (
                                <div className="space-y-3">
                                    {recentUsers.map(user => (
                                        <div key={user.id || user.uid} className="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
                                            <div className="w-10 h-10 rounded-full bg-brand/10 flex items-center justify-center">
                                                <Icons.Users className="w-5 h-5 text-brand" />
                                                </div>
                                            <div className="flex-1">
                                                <p className="font-bold text-dark">{user.name || '이름 없음'}</p>
                                                <p className="text-sm text-gray-600">{user.email || '-'}</p>
                                                        </div>
                                            <span className={`text-xs px-2 py-1 rounded font-bold ${
                                                user.approvalStatus === 'approved' ? 'bg-green-100 text-green-700' :
                                                user.approvalStatus === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                                'bg-red-100 text-red-700'
                                            }`}>
                                                {user.approvalStatus === 'approved' ? '승인' :
                                                 user.approvalStatus === 'pending' ? '대기' : '거부'}
                                            </span>
                                    </div>
                                    ))}
                                            </div>
                    )}
                        </div>
                        
                        {/* 최근 게시글 */}
                        <div className="bg-white rounded-2xl shadow-lg p-6">
                            <h3 className="text-lg font-bold text-dark mb-4">최근 게시글</h3>
                            {recentPosts.length === 0 ? (
                                <p className="text-gray-400 text-center py-8">게시글이 없습니다.</p>
                            ) : (
                                <div className="space-y-3">
                                    {recentPosts.map(post => (
                                        <div key={post.id} className="p-3 bg-gray-50 rounded-xl">
                                            <p className="font-bold text-dark mb-1">{post.title || '제목 없음'}</p>
                                            <p className="text-sm text-gray-600">{post.author || '작성자 없음'}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* 실시간 검색 현황 */}
                    <div className="bg-white rounded-2xl shadow-lg p-6 mt-6">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-bold text-dark">실시간 검색 현황</h3>
                            <button
                                type="button"
                                onClick={loadSearchLogs}
                                disabled={loadingLogs}
                                className="px-4 py-2 bg-brand text-white rounded-lg font-bold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm flex items-center gap-2"
                            >
                                <Icons.Clock size={16} />
                                {loadingLogs ? '로딩 중...' : '새로고침'}
                            </button>
                        </div>
                        
                        {searchLogs.length === 0 ? (
                            <p className="text-gray-400 text-center py-8">검색 로그가 없습니다.</p>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">검색 시각</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">회원명</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">이메일</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">검색어</th>
                                            <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">결과 건수</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {searchLogs.map((log) => (
                                            <tr key={log.id} className="hover:bg-gray-50 transition-colors">
                                                <td className="px-4 py-3 text-sm text-gray-600">{formatDateTime(log.searchedAt)}</td>
                                                <td className="px-4 py-3 text-sm font-medium text-dark">{log.userName || '-'}</td>
                                                <td className="px-4 py-3 text-sm text-gray-600">{log.userEmail || '-'}</td>
                                                <td className="px-4 py-3 text-sm">
                                                    <span className="px-2 py-1 bg-brand/10 text-brand rounded-lg font-bold">
                                                        {log.keyword || '-'}
                                                    </span>
                                                </td>
                                                <td className="px-4 py-3 text-sm text-gray-600">{log.resultCount || 0}건</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>

                    {/* 상단 메뉴 관리 */}
                    {menuEnabled && setMenuEnabled && menuNames && setMenuNames && orderedMenuKeys && (
                        <div className="bg-white rounded-2xl shadow-lg p-6 mt-6">
                            <h3 className="text-lg font-bold text-dark mb-4">상단 메뉴 관리</h3>
                            <p className="text-sm text-gray-600 mb-6">드래그하여 순서를 변경하고, 스위치와 메뉴명을 수정할 수 있습니다.</p>
                            <div className="grid grid-cols-2 gap-4">
                                {orderedMenuKeys.map((menuKey, index) => (
                                    <div
                                        key={menuKey}
                                        draggable
                                        onDragStart={(e) => handleDragStart(e, index)}
                                        onDragOver={(e) => handleDragOver(e, index)}
                                        onDragLeave={handleDragLeave}
                                        onDrop={(e) => handleDrop(e, index)}
                                        onDragEnd={handleDragEnd}
                                        className={`flex items-center gap-3 p-4 bg-gray-50 rounded-xl border-2 transition-all cursor-move ${
                                            dragOverIndex === index ? 'border-brand bg-brand/5' : 'border-transparent'
                                        } ${draggedIndex === index ? 'opacity-50' : ''}`}
                                    >
                                        {/* 드래그 핸들 */}
                                        <div className="flex flex-col gap-1 cursor-grab active:cursor-grabbing">
                                            <div className="w-1 h-1 bg-gray-400 rounded-full"></div>
                                            <div className="w-1 h-1 bg-gray-400 rounded-full"></div>
                                            <div className="w-1 h-1 bg-gray-400 rounded-full"></div>
                                        </div>
                                        {/* 스위치 */}
                                        <div className="flex items-center">
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={menuEnabled[menuKey] || false}
                                                    onChange={async () => {
                                                        const newMenuEnabled = { ...menuEnabled, [menuKey]: !menuEnabled[menuKey] };
                                                        setMenuEnabled(newMenuEnabled);
                                                        try {
                                                            // localStorage 저장 (폴백용)
                                                            localStorage.setItem('busan_ycc_menu_enabled', JSON.stringify(newMenuEnabled));
                                                            
                                                            // Firebase Settings에도 저장
                                                            if (window.firebaseService && window.firebaseService.updateSettings) {
                                                                try {
                                                                    const currentSettings = settings || {};
                                                                    await window.firebaseService.updateSettings({
                                                                        ...currentSettings,
                                                                        menuEnabled: newMenuEnabled
                                                                    });
                                                                } catch (firebaseError) {
                                                                    console.error('Firebase 메뉴 설정 저장 실패:', firebaseError);
                                                                }
                                                            }
                                                        } catch (error) {
                                                            console.error('메뉴 설정 저장 실패:', error);
                                                        }
                                                    }}
                                                    className="sr-only peer"
                                                />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-brand/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand"></div>
                                            </label>
                                        </div>
                                        {/* 메뉴 키 (고정) */}
                                        <div className="w-20 text-xs font-bold text-gray-600 truncate">
                                            {menuKey}
                                        </div>
                                        {/* 메뉴명 입력 */}
                                        <div className="flex-1">
                                            <input
                                                type="text"
                                                value={menuNames[menuKey] || menuKey}
                                                onChange={async (e) => {
                                                    const newMenuNames = { ...menuNames, [menuKey]: e.target.value };
                                                    setMenuNames(newMenuNames);
                                                    try {
                                                        // localStorage 저장 (폴백용)
                                                        localStorage.setItem('busan_ycc_menu_names', JSON.stringify(newMenuNames));
                                                        // 같은 탭에서의 변경을 감지하기 위한 커스텀 이벤트 발생
                                                        window.dispatchEvent(new Event('menuNamesUpdated'));
                                                        
                                                        // Firebase Settings에도 저장
                                                        if (window.firebaseService && window.firebaseService.updateSettings) {
                                                            try {
                                                                const currentSettings = settings || {};
                                                                await window.firebaseService.updateSettings({
                                                                    ...currentSettings,
                                                                    menuNames: newMenuNames
                                                                });
                                                            } catch (firebaseError) {
                                                                console.error('Firebase 메뉴명 저장 실패:', firebaseError);
                                                            }
                                                        }
                                                    } catch (error) {
                                                        console.error('메뉴명 저장 실패:', error);
                                                    }
                                                }}
                                                className="w-full px-3 py-2 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none text-sm font-medium"
                                                placeholder={menuKey}
                                                onClick={(e) => e.stopPropagation()}
                                            />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ==========================================
        // 이미지 크롭 모달 컴포넌트
        // ==========================================
        const ImageCropModal = ({ imageFile, onCropComplete, onCancel, recommendedWidth, recommendedHeight, aspectRatio = null }) => {
            const [imageSrc, setImageSrc] = useState(null);
            const [cropArea, setCropArea] = useState({ x: 0, y: 0, width: 0, height: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            const [zoom, setZoom] = useState(1);
            const [selectedAspectRatio, setSelectedAspectRatio] = useState(null); // 항상 자유로 시작
            const [imageSize, setImageSize] = useState({ width: 0, height: 0 });
            const canvasRef = React.useRef(null);
            const containerRef = React.useRef(null);
            const imageRef = React.useRef(null);
            
            const aspectRatios = [
                { label: '자유', value: null },
                { label: '16:9', value: 16/9 },
                { label: '4:3', value: 4/3 },
                { label: '1:1', value: 1 }
            ];
            
            // 이미지 로드
            useEffect(() => {
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setImageSrc(e.target.result);
                        const img = new Image();
                        img.onload = () => {
                            setImageSize({ width: img.naturalWidth, height: img.naturalHeight });
                            // 초기 크롭 영역 설정 (이미지 중앙, 이미지 원본 비율 사용)
                            const containerWidth = 600;
                            const containerHeight = 400;
                            
                            // 이미지 원본 비율 사용 (사용자가 자유롭게 선택할 수 있도록)
                            const targetAspect = img.naturalWidth / img.naturalHeight;
                            
                            let initWidth, initHeight;
                            
                            // 컨테이너에 맞게 크롭 영역 크기 계산
                            if (containerWidth / containerHeight > targetAspect) {
                                // 컨테이너가 더 넓음 - 높이 기준
                                initHeight = containerHeight * 0.8;
                                initWidth = initHeight * targetAspect;
                            } else {
                                // 컨테이너가 더 높음 - 너비 기준
                                initWidth = containerWidth * 0.8;
                                initHeight = initWidth / targetAspect;
                            }
                            
                            // 최소 크기 보장
                            initWidth = Math.max(100, Math.min(initWidth, containerWidth));
                            initHeight = Math.max(100, Math.min(initHeight, containerHeight));
                            
                            setCropArea({
                                x: (containerWidth - initWidth) / 2,
                                y: (containerHeight - initHeight) / 2,
                                width: initWidth,
                                height: initHeight
                            });
                            
                            imageRef.current = img;
                        };
                        img.onerror = () => {
                            console.error('이미지 로드 실패');
                            alert('이미지를 불러올 수 없습니다.');
                        };
                        img.src = e.target.result;
                    };
                    reader.onerror = () => {
                        console.error('파일 읽기 실패');
                        alert('파일을 읽을 수 없습니다.');
                    };
                    reader.readAsDataURL(imageFile);
                }
            }, [imageFile, aspectRatio]);
            
            // 비율 변경 시 크롭 영역 조정
            useEffect(() => {
                if (selectedAspectRatio !== null && cropArea.width > 0 && cropArea.height > 0) {
                    const currentAspect = cropArea.width / cropArea.height;
                    if (Math.abs(currentAspect - selectedAspectRatio) > 0.01) {
                        let newWidth = cropArea.width;
                        let newHeight = cropArea.height;
                        
                        if (currentAspect > selectedAspectRatio) {
                            newWidth = cropArea.height * selectedAspectRatio;
                        } else {
                            newHeight = cropArea.width / selectedAspectRatio;
                        }
                        
                        setCropArea({
                            ...cropArea,
                            width: newWidth,
                            height: newHeight
                        });
                    }
                }
            }, [selectedAspectRatio]);
            
            const [resizeHandle, setResizeHandle] = useState(null);
            const [startCropArea, setStartCropArea] = useState(null);
            const [startMousePos, setStartMousePos] = useState(null);
            
            // 마우스 이벤트 핸들러
            const handleMouseDown = (e) => {
                if (!imageSrc || !containerRef.current) return;
                const rect = containerRef.current.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // 리사이즈 핸들 확인 (8개 핸들)
                const handleSize = 12;
                const handles = [
                    { x: cropArea.x, y: cropArea.y, type: 'nw' },
                    { x: cropArea.x + cropArea.width / 2, y: cropArea.y, type: 'n' },
                    { x: cropArea.x + cropArea.width, y: cropArea.y, type: 'ne' },
                    { x: cropArea.x + cropArea.width, y: cropArea.y + cropArea.height / 2, type: 'e' },
                    { x: cropArea.x + cropArea.width, y: cropArea.y + cropArea.height, type: 'se' },
                    { x: cropArea.x + cropArea.width / 2, y: cropArea.y + cropArea.height, type: 's' },
                    { x: cropArea.x, y: cropArea.y + cropArea.height, type: 'sw' },
                    { x: cropArea.x, y: cropArea.y + cropArea.height / 2, type: 'w' }
                ];
                
                for (const handle of handles) {
                    if (Math.abs(x - handle.x) < handleSize && Math.abs(y - handle.y) < handleSize) {
                        setResizeHandle(handle.type);
                        setStartCropArea({ ...cropArea });
                        setStartMousePos({ x, y });
                        e.preventDefault();
                        return;
                    }
                }
                
                // 크롭 영역 내부인지 확인 (드래그)
                if (x >= cropArea.x && x <= cropArea.x + cropArea.width &&
                    y >= cropArea.y && y <= cropArea.y + cropArea.height) {
                    setIsDragging(true);
                    setDragStart({ x: x - cropArea.x, y: y - cropArea.y });
                }
            };
            
            const handleMouseMove = (e) => {
                if (!imageSrc || !containerRef.current) return;
                const rect = containerRef.current.getBoundingClientRect();
                const currentX = e.clientX - rect.left;
                const currentY = e.clientY - rect.top;
                
                if (resizeHandle && startCropArea && startMousePos) {
                    // 리사이즈 모드
                    const deltaX = currentX - startMousePos.x;
                    const deltaY = currentY - startMousePos.y;
                    let newCrop = { ...startCropArea };
                    
                    switch (resizeHandle) {
                        case 'nw':
                            newCrop.x = startCropArea.x + deltaX;
                            newCrop.y = startCropArea.y + deltaY;
                            newCrop.width = Math.max(50, startCropArea.width - deltaX);
                            newCrop.height = Math.max(50, startCropArea.height - deltaY);
                            break;
                        case 'n':
                            newCrop.y = startCropArea.y + deltaY;
                            newCrop.height = Math.max(50, startCropArea.height - deltaY);
                            break;
                        case 'ne':
                            newCrop.y = startCropArea.y + deltaY;
                            newCrop.width = Math.max(50, startCropArea.width + deltaX);
                            newCrop.height = Math.max(50, startCropArea.height - deltaY);
                            break;
                        case 'e':
                            newCrop.width = Math.max(50, startCropArea.width + deltaX);
                            break;
                        case 'se':
                            newCrop.width = Math.max(50, startCropArea.width + deltaX);
                            newCrop.height = Math.max(50, startCropArea.height + deltaY);
                            break;
                        case 's':
                            newCrop.height = Math.max(50, startCropArea.height + deltaY);
                            break;
                        case 'sw':
                            newCrop.x = startCropArea.x + deltaX;
                            newCrop.width = Math.max(50, startCropArea.width - deltaX);
                            newCrop.height = Math.max(50, startCropArea.height + deltaY);
                            break;
                        case 'w':
                            newCrop.x = startCropArea.x + deltaX;
                            newCrop.width = Math.max(50, startCropArea.width - deltaX);
                            break;
                    }
                    
                    // 비율 유지
                    if (selectedAspectRatio !== null && selectedAspectRatio > 0) {
                        const currentAspect = newCrop.width / newCrop.height;
                        if (Math.abs(currentAspect - selectedAspectRatio) > 0.01) {
                            if (currentAspect > selectedAspectRatio) {
                                newCrop.width = newCrop.height * selectedAspectRatio;
                            } else {
                                newCrop.height = newCrop.width / selectedAspectRatio;
                            }
                        }
                    }
                    
                    setCropArea(newCrop);
                } else if (isDragging) {
                    // 드래그 모드 - 영역 제한 없음
                    const x = currentX - dragStart.x;
                    const y = currentY - dragStart.y;
                    
                    setCropArea({
                        ...cropArea,
                        x: x,
                        y: y
                    });
                }
            };
            
            const handleMouseUp = () => {
                setIsDragging(false);
                setResizeHandle(null);
                setStartCropArea(null);
                setStartMousePos(null);
            };
            
            // 크롭 완료
            const handleCrop = async () => {
                if (!imageFile || !imageSrc || !imageRef.current || !containerRef.current) {
                    console.error('크롭에 필요한 요소가 없습니다:', {
                        imageFile: !!imageFile,
                        imageSrc: !!imageSrc,
                        imageRef: !!imageRef.current,
                        containerRef: !!containerRef.current
                    });
                    return;
                }
                
                try {
                    const img = imageRef.current;
                    const containerRect = containerRef.current.getBoundingClientRect();
                    const containerWidth = containerRect.width || 600;
                    const containerHeight = containerRect.height || 400;
                    
                    // 이미지가 object-contain으로 표시된 실제 크기 계산
                    const imgAspect = img.naturalWidth / img.naturalHeight;
                    const containerAspect = containerWidth / containerHeight;
                    
                    let displayedWidth, displayedHeight, offsetX, offsetY;
                    
                    if (imgAspect > containerAspect) {
                        // 이미지가 컨테이너보다 넓음
                        displayedWidth = containerWidth;
                        displayedHeight = containerWidth / imgAspect;
                        offsetX = 0;
                        offsetY = (containerHeight - displayedHeight) / 2;
                    } else {
                        // 이미지가 컨테이너보다 높음
                        displayedHeight = containerHeight;
                        displayedWidth = containerHeight * imgAspect;
                        offsetX = (containerWidth - displayedWidth) / 2;
                        offsetY = 0;
                    }
                    
                    // 줌 적용 시 이미지 중심 기준으로 확대
                    const zoomedWidth = displayedWidth * zoom;
                    const zoomedHeight = displayedHeight * zoom;
                    const zoomOffsetX = offsetX - (zoomedWidth - displayedWidth) / 2;
                    const zoomOffsetY = offsetY - (zoomedHeight - displayedHeight) / 2;
                    
                    // 크롭 영역을 이미지 상대 좌표로 변환
                    let cropRelativeX = cropArea.x - zoomOffsetX;
                    let cropRelativeY = cropArea.y - zoomOffsetY;
                    
                    // 이미지 영역 밖으로 나간 부분 제거
                    cropRelativeX = Math.max(0, Math.min(cropRelativeX, zoomedWidth));
                    cropRelativeY = Math.max(0, Math.min(cropRelativeY, zoomedHeight));
                    const cropRelativeWidth = Math.min(cropArea.width, zoomedWidth - cropRelativeX);
                    const cropRelativeHeight = Math.min(cropArea.height, zoomedHeight - cropRelativeY);
                    
                    // 실제 이미지 좌표로 변환
                    const scaleX = img.naturalWidth / zoomedWidth;
                    const scaleY = img.naturalHeight / zoomedHeight;
                    
                    const actualCropArea = {
                        x: cropRelativeX * scaleX,
                        y: cropRelativeY * scaleY,
                        width: cropRelativeWidth * scaleX,
                        height: cropRelativeHeight * scaleY
                    };
                    
                    // 좌표 정수화 및 검증
                    actualCropArea.x = Math.round(Math.max(0, Math.min(actualCropArea.x, img.naturalWidth - 1)));
                    actualCropArea.y = Math.round(Math.max(0, Math.min(actualCropArea.y, img.naturalHeight - 1)));
                    actualCropArea.width = Math.round(Math.max(1, Math.min(actualCropArea.width, img.naturalWidth - actualCropArea.x)));
                    actualCropArea.height = Math.round(Math.max(1, Math.min(actualCropArea.height, img.naturalHeight - actualCropArea.y)));
                    
                    console.log('크롭 영역:', {
                        cropArea,
                        actualCropArea,
                        imageSize: { width: img.naturalWidth, height: img.naturalHeight },
                        displayedSize: { width: displayedWidth, height: displayedHeight },
                        zoom
                    });
                    
                    const croppedImage = await cropImage(imageFile, actualCropArea, recommendedWidth, recommendedHeight);
                    
                    if (!croppedImage) {
                        throw new Error('크롭된 이미지가 생성되지 않았습니다.');
                    }
                    
                    await onCropComplete(croppedImage);
                } catch (error) {
                    console.error('이미지 크롭 오류:', error);
                    alert('이미지 크롭에 실패했습니다: ' + (error.message || '알 수 없는 오류'));
                }
            };
            
            if (!imageSrc) return null;
            
            return React.createElement('div', {
                className: 'fixed inset-0 z-50 flex items-center justify-center bg-black/70',
                onClick: onCancel
            }, React.createElement('div', {
                className: 'bg-white rounded-2xl p-6 max-w-4xl w-full mx-4',
                onClick: (e) => e.stopPropagation()
            }, [
                React.createElement('div', { key: 'header', className: 'flex items-center justify-between mb-4' },
                    React.createElement('h3', { className: 'text-xl font-bold text-dark' }, '이미지 크롭'),
                    React.createElement('button', {
                        onClick: onCancel,
                        className: 'p-2 hover:bg-gray-100 rounded-lg'
                    }, React.createElement(Icons.X, { size: 24 }))
                ),
                React.createElement('div', { key: 'info', className: 'mb-4 p-3 bg-blue-50 rounded-lg' },
                    React.createElement('p', { className: 'text-sm text-gray-700' },
                        `추천 해상도: ${recommendedWidth}x${recommendedHeight}px` + 
                        (aspectRatio ? ` (비율: ${aspectRatio === 16/9 ? '16:9' : aspectRatio === 3/2 ? '3:2' : aspectRatio === 4/3 ? '4:3' : aspectRatio === 1 ? '1:1' : aspectRatio.toFixed(2)})` : '') +
                        ' - 원하는 비율을 선택할 수 있습니다'
                    )
                ),
                React.createElement('div', {
                    key: 'container',
                    ref: containerRef,
                    className: 'relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden mb-4',
                    style: { cursor: isDragging ? 'grabbing' : 'grab' },
                    onMouseDown: handleMouseDown,
                    onMouseMove: handleMouseMove,
                    onMouseUp: handleMouseUp,
                    onMouseLeave: handleMouseUp
                }, [
                    React.createElement('img', {
                        key: 'image',
                        ref: imageRef,
                        src: imageSrc,
                        alt: '크롭할 이미지',
                        className: 'absolute inset-0 w-full h-full object-contain',
                        style: { 
                            transform: `scale(${zoom})`,
                            transformOrigin: 'center center',
                            imageRendering: 'high-quality'
                        }
                    }),
                    React.createElement('div', {
                        key: 'overlay',
                        className: 'absolute inset-0 bg-black/50 pointer-events-none'
                    }),
                    React.createElement('div', {
                        key: 'crop-area',
                        className: 'absolute border-2 border-white shadow-lg z-10',
                        style: {
                            left: `${cropArea.x}px`,
                            top: `${cropArea.y}px`,
                            width: `${cropArea.width}px`,
                            height: `${cropArea.height}px`,
                            boxShadow: '0 0 0 9999px rgba(0,0,0,0.5)',
                            pointerEvents: 'auto'
                        }
                    }, [
                        React.createElement('div', {
                            key: 'handles',
                            className: 'absolute inset-0'
                        }, [
                            { top: '-6px', left: '-6px', cursor: 'nw-resize', type: 'nw' },
                            { top: '-6px', left: '50%', marginLeft: '-6px', cursor: 'n-resize', type: 'n' },
                            { top: '-6px', right: '-6px', cursor: 'ne-resize', type: 'ne' },
                            { top: '50%', right: '-6px', marginTop: '-6px', cursor: 'e-resize', type: 'e' },
                            { bottom: '-6px', right: '-6px', cursor: 'se-resize', type: 'se' },
                            { bottom: '-6px', left: '50%', marginLeft: '-6px', cursor: 's-resize', type: 's' },
                            { bottom: '-6px', left: '-6px', cursor: 'sw-resize', type: 'sw' },
                            { top: '50%', left: '-6px', marginTop: '-6px', cursor: 'w-resize', type: 'w' }
                        ].map((handle, i) => React.createElement('div', {
                            key: i,
                            className: 'absolute w-3 h-3 bg-white border-2 border-brand rounded-full z-10',
                            style: {
                                ...handle,
                                cursor: handle.cursor
                            }
                        })))
                    ])
                ]),
                React.createElement('div', { key: 'controls', className: 'space-y-4' },
                    React.createElement('div', { className: 'flex items-center gap-4' },
                        React.createElement('label', { className: 'text-sm font-bold text-gray-700' }, '비율:'),
                        React.createElement('div', { className: 'flex gap-2' },
                            aspectRatios.map(ratio => React.createElement('button', {
                                key: ratio.label,
                                onClick: () => setSelectedAspectRatio(ratio.value),
                                className: `px-3 py-1 rounded-lg text-sm font-bold transition-colors ${
                                    selectedAspectRatio === ratio.value
                                        ? 'bg-brand text-white'
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`
                            }, ratio.label))
                        )
                    ),
                    React.createElement('div', { className: 'flex items-center gap-4' },
                        React.createElement('label', { className: 'text-sm font-bold text-gray-700' }, '줌:'),
                        React.createElement('input', {
                            type: 'range',
                            min: '0.5',
                            max: '2',
                            step: '0.1',
                            value: zoom,
                            onChange: (e) => setZoom(parseFloat(e.target.value)),
                            className: 'flex-1'
                        }),
                        React.createElement('span', { className: 'text-sm text-gray-600 w-12 text-right' }, `${Math.round(zoom * 100)}%`)
                    )
                ),
                React.createElement('div', { key: 'actions', className: 'flex gap-4 mt-6' },
                    React.createElement('button', {
                        onClick: onCancel,
                        className: 'flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors'
                    }, '취소'),
                    React.createElement('button', {
                        onClick: handleCrop,
                        className: 'flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors'
                    }, '크롭 완료')
                )
            ]));
        };
        
        // ==========================================
        // 비율 계산 헬퍼 함수
        // ==========================================
        const calculateAspectRatio = (width, height) => {
            if (!width || !height) return null;
            const ratio = width / height;
            // 일반적인 비율과 비교하여 정확히 일치하는 경우만 반환
            if (Math.abs(ratio - 16/9) < 0.01) return 16/9;
            if (Math.abs(ratio - 3/2) < 0.01) return 3/2;
            if (Math.abs(ratio - 4/3) < 0.01) return 4/3;
            if (Math.abs(ratio - 1) < 0.01) return 1;
            return null; // 정확히 일치하지 않으면 null
        };

        // ==========================================
        // 메인 관리 컴포넌트
        // ==========================================
        const MainContentManagement = ({ settings = {}, setSettings, menuEnabled, setMenuEnabled, menuNames, setMenuNames }) => {
            const [formData, setFormData] = useState(settings);
            const [saving, setSaving] = useState(false);
            const saveTimeoutRef = React.useRef(null);
            const [showCropModal, setShowCropModal] = useState(false);
            const [cropImageFile, setCropImageFile] = useState(null);
            const [cropImageField, setCropImageField] = useState(null); // 어떤 필드의 이미지인지
            const [cropRecommendedSize, setCropRecommendedSize] = useState({ width: 1200, height: 800 });
            
            useEffect(() => {
                setFormData(settings);
            }, [settings]);
            
            // 실시간 저장 (debounce 적용)
            useEffect(() => {
                if (saveTimeoutRef.current) {
                    clearTimeout(saveTimeoutRef.current);
                }
                
                // 폼 데이터가 변경되면 1초 후 자동 저장
                saveTimeoutRef.current = setTimeout(async () => {
                    if (window.firebaseService) {
                        try {
                            await window.firebaseService.updateSettings(formData);
                            setSettings(formData);
                            setSaving(false);
                        } catch (error) {
                            console.error('설정 자동 저장 오류:', error);
                            const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '자동 저장 중 오류가 발생했습니다.';
                            console.error('에러 상세:', {
                                code: error.code,
                                message: error.message,
                                stack: error.stack
                            });
                            setSaving(false);
                        }
                    }
                }, 1000);
                
                return () => {
                    if (saveTimeoutRef.current) {
                        clearTimeout(saveTimeoutRef.current);
                    }
                };
            }, [formData]);
            
            const handleSave = async () => {
                if (saveTimeoutRef.current) {
                    clearTimeout(saveTimeoutRef.current);
                }
                setSaving(true);
                try {
                    await window.firebaseService.updateSettings(formData);
                    setSettings(formData);
                    alert('저장되었습니다.');
                } catch (error) {
                    console.error('설정 수동 저장 오류:', error);
                    console.error('에러 상세:', {
                        code: error.code,
                        message: error.message,
                        stack: error.stack,
                        formData: formData
                    });
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '저장 중 오류가 발생했습니다.';
                    alert(`저장에 실패했습니다.\n${errorMessage}`);
                } finally {
                    setSaving(false);
                }
            };
            
            const handleChange = (field, value) => {
                setSaving(true);
                setFormData(prevData => {
                    const newData = {...prevData, [field]: value};
                    return newData;
                });
            };
            
            // 크롭 완료 핸들러 (설정 페이지용)
            const handleCropCompleteSettings = async (croppedImageBase64) => {
                if (!cropImageFile || !cropImageField) {
                    console.error('크롭 정보가 없습니다:', { cropImageFile, cropImageField });
                    return;
                }

                if (!croppedImageBase64) {
                    console.error('크롭된 이미지가 없습니다');
                    alert('크롭된 이미지를 받지 못했습니다.');
                    return;
                }

                try {
                    // 로딩 상태 시작
                    setSaving(true);
                    
                    console.log('이미지 업로드 시작:', cropImageField);
                    const uploaded = await uploadImageToImgBB(croppedImageBase64, cropImageFile.name);

                    if (!uploaded || !uploaded.url) {
                        throw new Error('이미지 업로드 응답에 URL이 없습니다.');
                    }

                    console.log('이미지 업로드 완료:', uploaded.url);

                    // 함수형 업데이트로 즉시 반영
                    setFormData(prevData => {
                        const newData = {...prevData, [cropImageField]: uploaded.url};
                        console.log('formData 업데이트:', cropImageField, uploaded.url);
                        return newData;
                    });

                    // settings도 업데이트 (실시간 저장을 위해)
                    setSettings(prevSettings => {
                        const newSettings = {...prevSettings, [cropImageField]: uploaded.url};
                        return newSettings;
                    });

                    // 렌더링 시간 확보 후 모달 닫기
                    setTimeout(() => {
                        setShowCropModal(false);
                        setCropImageFile(null);
                        setCropImageField(null);
                    }, 100);
                } catch (error) {
                    console.error('❌ 이미지 업로드 오류:', error);
                    alert(`이미지 업로드에 실패했습니다.\n${error.message || '알 수 없는 오류'}`);
                } finally {
                    setSaving(false);
                }
            };
            
            return (
                <>
                    <div className="bg-white rounded-2xl shadow-lg p-6">
                        <h3 className="text-xl font-bold text-dark mb-6">메인 페이지 콘텐츠 관리</h3>
                        <div className="space-y-8">
                        {/* Hero 섹션 */}
                        <div className="border-b border-gray-200 pb-8">
                            <h4 className="font-bold text-dark mb-6 text-lg">Hero 섹션</h4>
                            <div className="space-y-6">
                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                    <textarea
                                        value={formData.hero_title || ''}
                                        onChange={(e) => handleChange('hero_title', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="3"
                                        placeholder="함께 성장하는\n청년 사업가 커뮤니티\n부산청년사업가들"
                                    />
                                                                        </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                    <textarea
                                        value={formData.hero_desc || ''}
                                        onChange={(e) => handleChange('hero_desc', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="2"
                                        placeholder="부산 지역 청년 사업가들이 모여 아이디어를 공유하고, 네트워킹하며 함께 성장해나가는 공간입니다."
                                    />
                                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        배경 이미지
                                        <span className="text-xs text-gray-500 font-normal ml-2">
                                            추천 해상도: 1920x1080px (16:9)
                                        </span>
                                    </label>
                                    <div className="flex gap-4 items-start">
                                        {formData.hero_image && (
                                            <div className="relative w-40 h-24 rounded-xl overflow-hidden border-2 border-gray-200 shadow-sm flex-shrink-0">
                                                <img src={getImageUrlWithTimestamp(formData.hero_image)} alt="Hero" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                <button
                                                    type="button"
                                                    onClick={() => handleChange('hero_image', '')}
                                                    className="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                    title="이미지 삭제"
                                                >
                                                    {React.createElement(Icons.X, { size: 14 })}
                                                </button>
                                            </div>
                                        )}
                                        <div className="flex-1">
                                            <input
                                                type="text"
                                                value={formData.hero_image || ''}
                                                onChange={(e) => handleChange('hero_image', e.target.value)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none mb-2"
                                                placeholder="이미지 URL을 입력하거나 업로드하세요"
                                            />
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        if (file.size > 10 * 1024 * 1024) {
                                                            alert('이미지 크기는 10MB 이하여야 합니다.');
                                                            e.target.value = '';
                                                            return;
                                                        }
                                                        setCropImageFile(file);
                                                        setCropImageField('hero_image');
                                                        setCropRecommendedSize({ width: 1920, height: 1080 });
                                                        setShowCropModal(true);
                                                        e.target.value = '';
                                                    }
                                                }}
                                                className="hidden"
                                                id="hero-image-upload"
                                            />
                                            <label
                                                htmlFor="hero-image-upload"
                                                className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                            >
                                                {React.createElement(Icons.Camera, { size: 18 })}
                                                <span>{formData.hero_image ? '이미지 교체' : '이미지 업로드'}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                                                </div>
                                            </div>
                    
                        {/* 통계 섹션 */}
                        <div className="border-b border-gray-200 pb-6">
                            <h4 className="font-bold text-dark mb-4">통계 섹션</h4>
                            <div className="grid grid-cols-2 gap-4">
                                {[1, 2, 3, 4].map(num => (
                                    <div key={num} className="space-y-2">
                                        <label className="block text-sm font-bold text-gray-700">통계 {num}</label>
                                        <input
                                            type="text"
                                            value={formData[`stat_${num}_val`] || ''}
                                            onChange={(e) => handleChange(`stat_${num}_val`, e.target.value)}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none mb-2"
                                            placeholder="값 (예: 200+)"
                                        />
                                        <input
                                            type="text"
                                            value={formData[`stat_${num}_desc`] || ''}
                                            onChange={(e) => handleChange(`stat_${num}_desc`, e.target.value)}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="설명 (예: 활동중인 사업가)"
                                        />
                                    </div>
                                ))}
                            </div>
                                                        </div>
                                
                        {/* CTA 섹션 */}
                        <div className="border-b border-gray-200 pb-6">
                            <h4 className="font-bold text-dark mb-4">CTA 섹션</h4>
                                            <div className="space-y-4">
                                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                    <input
                                        type="text"
                                        value={formData.cta_title || ''}
                                        onChange={(e) => handleChange('cta_title', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        placeholder="사업의 꿈을 현실로!"
                                    />
                                                        </div>
                                                                    <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                    <textarea
                                        value={formData.cta_desc || ''}
                                        onChange={(e) => handleChange('cta_desc', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="2"
                                        placeholder="혼자 고민하지 마세요..."
                                    />
                                                                    </div>
                                                                    </div>
                                                                    </div>
                        
                        {/* Features 섹션 */}
                        <div className="border-b border-gray-200 pb-8">
                            <h4 className="font-bold text-dark mb-6 text-lg">Features 섹션</h4>
                            <div className="space-y-6">
                                                <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                <input
                                    type="text"
                                    value={formData.features_title || ''}
                                    onChange={(e) => handleChange('features_title', e.target.value)}
                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                    placeholder="함께할 때 더 멀리 갈 수 있습니다"
                                />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">이미지</label>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs text-gray-600 mb-2">
                                                이미지 1
                                                <span className="text-xs text-gray-500 font-normal ml-2">
                                                    추천: 1200x800px (3:2)
                                                </span>
                                            </label>
                                            <div className="flex gap-3 items-start">
                                                {formData.features_image_1 && (
                                                    <div className="relative w-32 h-20 rounded-lg overflow-hidden border-2 border-gray-200 shadow-sm flex-shrink-0">
                                                        <img src={getImageUrlWithTimestamp(formData.features_image_1)} alt="Features 1" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                        <button
                                                            type="button"
                                                            onClick={() => handleChange('features_image_1', '')}
                                                            className="absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                            title="이미지 삭제"
                                                        >
                                                            {React.createElement(Icons.X, { size: 12 })}
                                                        </button>
                                                    </div>
                                                )}
                                                <div className="flex-1">
                                                    <input
                                                        type="text"
                                                        value={formData.features_image_1 || ''}
                                                        onChange={(e) => handleChange('features_image_1', e.target.value)}
                                                        className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none mb-2 text-sm"
                                                        placeholder="이미지 URL"
                                                    />
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        onChange={(e) => {
                                                            const file = e.target.files[0];
                                                            if (file) {
                                                                if (file.size > 10 * 1024 * 1024) {
                                                                    alert('이미지 크기는 10MB 이하여야 합니다.');
                                                                    e.target.value = '';
                                                                    return;
                                                                }
                                                                setCropImageFile(file);
                                                                setCropImageField('features_image_1');
                                                                setCropRecommendedSize({ width: 1200, height: 800 });
                                                                setShowCropModal(true);
                                                                e.target.value = '';
                                                            }
                                                        }}
                                                        className="hidden"
                                                        id="features-image-1-upload"
                                                    />
                                                    <label
                                                        htmlFor="features-image-1-upload"
                                                        className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                                    >
                                                        {React.createElement(Icons.Camera, { size: 18 })}
                                                        <span>{formData.features_image_1 ? '이미지 교체' : '이미지 업로드'}</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs text-gray-600 mb-2">
                                                이미지 2
                                                <span className="text-xs text-gray-500 font-normal ml-2">
                                                    추천: 1200x800px (3:2)
                                                </span>
                                            </label>
                                            <div className="flex gap-3 items-start">
                                                {formData.features_image_2 && (
                                                    <div className="relative w-32 h-20 rounded-lg overflow-hidden border-2 border-gray-200 shadow-sm">
                                                        <img src={getImageUrlWithTimestamp(formData.features_image_2)} alt="Features 2" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; }} />
                                                        <button
                                                            type="button"
                                                            onClick={() => handleChange('features_image_2', '')}
                                                            className="absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                            title="이미지 삭제"
                                                        >
                                                            {React.createElement(Icons.X, { size: 12 })}
                                                        </button>
                                                    </div>
                                                )}
                                                <div className="flex-1">
                                                    <input
                                                        type="text"
                                                        value={formData.features_image_2 || ''}
                                                        onChange={(e) => handleChange('features_image_2', e.target.value)}
                                                        className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none mb-2 text-sm"
                                                        placeholder="이미지 URL"
                                                    />
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        onChange={(e) => {
                                                            const file = e.target.files[0];
                                                            if (file) {
                                                                if (file.size > 10 * 1024 * 1024) {
                                                                    alert('이미지 크기는 10MB 이하여야 합니다.');
                                                                    e.target.value = '';
                                                                    return;
                                                                }
                                                                setCropImageFile(file);
                                                                setCropImageField('features_image_2');
                                                                setCropRecommendedSize({ width: 1200, height: 800 });
                                                                setShowCropModal(true);
                                                                e.target.value = '';
                                                            }
                                                        }}
                                                        className="hidden"
                                                        id="features-image-2-upload"
                                                    />
                                                    <label
                                                        htmlFor="features-image-2-upload"
                                                        className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                                    >
                                                        {React.createElement(Icons.Camera, { size: 18 })}
                                                        <span>{formData.features_image_2 ? '이미지 교체' : '이미지 업로드'}</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Activities 섹션 */}
                        <div className="border-b border-gray-200 pb-8">
                            <h4 className="font-bold text-dark mb-6 text-lg">Activities 섹션</h4>
                            <div className="space-y-6">
                                {/* 세미나 카드 */}
                                <div className="bg-gray-50 p-4 rounded-xl">
                                    <h5 className="font-bold text-gray-700 mb-4">세미나 카드</h5>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">제목</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_seminar_title || ''}
                                                    onChange={(e) => handleChange('activity_seminar_title', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="비즈니스 세미나"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">설명</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_seminar_desc || ''}
                                                    onChange={(e) => handleChange('activity_seminar_desc', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="매월 진행되는 창업 트렌드 및 마케팅 실무 세미나"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">일정</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_seminar_schedule || ''}
                                                    onChange={(e) => handleChange('activity_seminar_schedule', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="매월 2째주 목요일"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-600 mb-2">
                                                이미지
                                                <span className="text-xs text-gray-500 font-normal ml-2">
                                                    추천: 1200x800px (3:2)
                                                </span>
                                            </label>
                                            {formData.activity_seminar_image && (
                                                <div className="relative w-full h-32 rounded-lg overflow-hidden border-2 border-gray-200 mb-2 shadow-sm flex-shrink-0">
                                                    <img src={getImageUrlWithTimestamp(formData.activity_seminar_image)} alt="Seminar" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                    <button
                                                        type="button"
                                                        onClick={() => handleChange('activity_seminar_image', '')}
                                                        className="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                        title="이미지 삭제"
                                                    >
                                                        {React.createElement(Icons.X, { size: 14 })}
                                                    </button>
                                                </div>
                                            )}
                                            <input
                                                type="text"
                                                value={formData.activity_seminar_image || ''}
                                                onChange={(e) => handleChange('activity_seminar_image', e.target.value)}
                                                className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none mb-2 text-sm"
                                                placeholder="이미지 URL"
                                            />
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        if (file.size > 10 * 1024 * 1024) {
                                                            alert('이미지 크기는 10MB 이하여야 합니다.');
                                                            e.target.value = '';
                                                            return;
                                                        }
                                                        setCropImageFile(file);
                                                        setCropImageField('activity_seminar_image');
                                                        setCropRecommendedSize({ width: 1200, height: 800 });
                                                        setShowCropModal(true);
                                                        e.target.value = '';
                                                    }
                                                }}
                                                className="hidden"
                                                id="activity-seminar-upload"
                                            />
                                            <label
                                                htmlFor="activity-seminar-upload"
                                                className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                            >
                                                {React.createElement(Icons.Camera, { size: 18 })}
                                                <span>{formData.activity_seminar_image ? '이미지 교체' : '이미지 업로드'}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* 투자 카드 */}
                                <div className="bg-gray-50 p-4 rounded-xl">
                                    <h5 className="font-bold text-gray-700 mb-4">투자 카드</h5>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">제목</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_investment_title || ''}
                                                    onChange={(e) => handleChange('activity_investment_title', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="투자 & 지원사업"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">설명</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_investment_desc || ''}
                                                    onChange={(e) => handleChange('activity_investment_desc', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="최신 정부 지원사업 큐레이션 및 IR 피칭 기회"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">일정</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_investment_schedule || ''}
                                                    onChange={(e) => handleChange('activity_investment_schedule', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="수시 모집"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-600 mb-2">
                                                이미지
                                                <span className="text-xs text-gray-500 font-normal ml-2">
                                                    추천: 1200x800px (3:2)
                                                </span>
                                            </label>
                                            {formData.activity_investment_image && (
                                                <div className="relative w-full h-32 rounded-lg overflow-hidden border-2 border-gray-200 mb-2 shadow-sm flex-shrink-0">
                                                    <img src={getImageUrlWithTimestamp(formData.activity_investment_image)} alt="Investment" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                    <button
                                                        type="button"
                                                        onClick={() => handleChange('activity_investment_image', '')}
                                                        className="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                        title="이미지 삭제"
                                                    >
                                                        {React.createElement(Icons.X, { size: 14 })}
                                                    </button>
                                                </div>
                                            )}
                                            <input
                                                type="text"
                                                value={formData.activity_investment_image || ''}
                                                onChange={(e) => handleChange('activity_investment_image', e.target.value)}
                                                className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none mb-2 text-sm"
                                                placeholder="이미지 URL"
                                            />
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        if (file.size > 10 * 1024 * 1024) {
                                                            alert('이미지 크기는 10MB 이하여야 합니다.');
                                                            e.target.value = '';
                                                            return;
                                                        }
                                                        setCropImageFile(file);
                                                        setCropImageField('activity_investment_image');
                                                        setCropRecommendedSize({ width: 1200, height: 800 });
                                                        setShowCropModal(true);
                                                        e.target.value = '';
                                                    }
                                                }}
                                                className="hidden"
                                                id="activity-investment-upload"
                                            />
                                            <label
                                                htmlFor="activity-investment-upload"
                                                className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                            >
                                                {React.createElement(Icons.Camera, { size: 18 })}
                                                <span>{formData.activity_investment_image ? '이미지 교체' : '이미지 업로드'}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* 네트워킹 카드 */}
                                <div className="bg-gray-50 p-4 rounded-xl">
                                    <h5 className="font-bold text-gray-700 mb-4">네트워킹 카드</h5>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">제목</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_networking_title || ''}
                                                    onChange={(e) => handleChange('activity_networking_title', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="사업가 네트워킹"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">설명</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_networking_desc || ''}
                                                    onChange={(e) => handleChange('activity_networking_desc', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="다양한 업종의 대표님들과 교류하며 비즈니스 기회"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold text-gray-600 mb-1">일정</label>
                                                <input
                                                    type="text"
                                                    value={formData.activity_networking_schedule || ''}
                                                    onChange={(e) => handleChange('activity_networking_schedule', e.target.value)}
                                                    className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm"
                                                    placeholder="매주 금요일"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-600 mb-2">
                                                이미지
                                                <span className="text-xs text-gray-500 font-normal ml-2">
                                                    추천: 1200x800px (3:2)
                                                </span>
                                            </label>
                                            {formData.activity_networking_image && (
                                                <div className="relative w-full h-32 rounded-lg overflow-hidden border-2 border-gray-200 mb-2 shadow-sm flex-shrink-0">
                                                    <img src={getImageUrlWithTimestamp(formData.activity_networking_image)} alt="Networking" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                    <button
                                                        type="button"
                                                        onClick={() => handleChange('activity_networking_image', '')}
                                                        className="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                        title="이미지 삭제"
                                                    >
                                                        {React.createElement(Icons.X, { size: 14 })}
                                                    </button>
                                                </div>
                                            )}
                                            <input
                                                type="text"
                                                value={formData.activity_networking_image || ''}
                                                onChange={(e) => handleChange('activity_networking_image', e.target.value)}
                                                className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none mb-2 text-sm"
                                                placeholder="이미지 URL"
                                            />
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        if (file.size > 10 * 1024 * 1024) {
                                                            alert('이미지 크기는 10MB 이하여야 합니다.');
                                                            e.target.value = '';
                                                            return;
                                                        }
                                                        setCropImageFile(file);
                                                        setCropImageField('activity_networking_image');
                                                        setCropRecommendedSize({ width: 1200, height: 800 });
                                                        setShowCropModal(true);
                                                        e.target.value = '';
                                                    }
                                                }}
                                                className="hidden"
                                                id="activity-networking-upload"
                                            />
                                            <label
                                                htmlFor="activity-networking-upload"
                                                className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                            >
                                                {React.createElement(Icons.Camera, { size: 18 })}
                                                <span>{formData.activity_networking_image ? '이미지 교체' : '이미지 업로드'}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* 후원 섹션 */}
                        <div className="border-b border-gray-200 pb-8">
                            <h4 className="font-bold text-dark mb-6 text-lg">후원 섹션</h4>
                            <div className="space-y-6">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                    <input
                                        type="text"
                                        value={formData.donation_title || ''}
                                        onChange={(e) => handleChange('donation_title', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        placeholder="부청사와 함께 성장하세요"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                    <textarea
                                        value={formData.donation_desc || ''}
                                        onChange={(e) => handleChange('donation_desc', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="2"
                                        placeholder="후원을 통해 더 많은 청년 사업가들이 꿈을 이룰 수 있도록 도와주세요"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">버튼 텍스트</label>
                                    <input
                                        type="text"
                                        value={formData.donation_button || ''}
                                        onChange={(e) => handleChange('donation_button', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        placeholder="후원하기"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        배경 이미지
                                        <span className="text-xs text-gray-500 font-normal ml-2">
                                            추천 해상도: 1920x1080px (16:9)
                                        </span>
                                    </label>
                                    <div className="flex gap-4 items-start">
                                        {formData.donation_image && (
                                            <div className="relative w-40 h-24 rounded-xl overflow-hidden border-2 border-gray-200 shadow-sm flex-shrink-0">
                                                <img src={getImageUrlWithTimestamp(formData.donation_image)} alt="Donation" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                <button
                                                    type="button"
                                                    onClick={() => handleChange('donation_image', '')}
                                                    className="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                    title="이미지 삭제"
                                                >
                                                    {React.createElement(Icons.X, { size: 14 })}
                                                </button>
                                            </div>
                                        )}
                                        <div className="flex-1">
                                            <input
                                                type="text"
                                                value={formData.donation_image || ''}
                                                onChange={(e) => handleChange('donation_image', e.target.value)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none mb-2"
                                                placeholder="이미지 URL을 입력하거나 업로드하세요"
                                            />
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        if (file.size > 10 * 1024 * 1024) {
                                                            alert('이미지 크기는 10MB 이하여야 합니다.');
                                                            e.target.value = '';
                                                            return;
                                                        }
                                                        setCropImageFile(file);
                                                        setCropImageField('donation_image');
                                                        setCropRecommendedSize({ width: 1920, height: 1080 });
                                                        setShowCropModal(true);
                                                        e.target.value = '';
                                                    }
                                                }}
                                                className="hidden"
                                                id="donation-image-upload"
                                            />
                                            <label
                                                htmlFor="donation-image-upload"
                                                className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                            >
                                                {React.createElement(Icons.Camera, { size: 18 })}
                                                <span>{formData.donation_image ? '이미지 교체' : '이미지 업로드'}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* CTA 섹션 */}
                        <div className="border-b border-gray-200 pb-8">
                            <h4 className="font-bold text-dark mb-6 text-lg">CTA 섹션</h4>
                            <div className="space-y-6">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                    <input
                                        type="text"
                                        value={formData.cta_title || ''}
                                        onChange={(e) => handleChange('cta_title', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        placeholder="사업의 꿈을 현실로!"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                    <textarea
                                        value={formData.cta_desc || ''}
                                        onChange={(e) => handleChange('cta_desc', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        rows="2"
                                        placeholder="혼자 고민하지 마세요..."
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">가입하기 버튼 텍스트</label>
                                    <input
                                        type="text"
                                        value={formData.cta_join_button || ''}
                                        onChange={(e) => handleChange('cta_join_button', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        placeholder="지금 가입하기"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">문의하기 버튼 텍스트</label>
                                    <input
                                        type="text"
                                        value={formData.cta_contact_button || ''}
                                        onChange={(e) => handleChange('cta_contact_button', e.target.value)}
                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        placeholder="문의하기"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">
                                        배경 이미지
                                        <span className="text-xs text-gray-500 font-normal ml-2">
                                            추천 해상도: 1920x1080px (16:9)
                                        </span>
                                    </label>
                                    <div className="flex gap-4 items-start">
                                        {formData.cta_image && (
                                            <div className="relative w-40 h-24 rounded-xl overflow-hidden border-2 border-gray-200 shadow-sm flex-shrink-0">
                                                <img src={getImageUrlWithTimestamp(formData.cta_image)} alt="CTA" className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                <button
                                                    type="button"
                                                    onClick={() => handleChange('cta_image', '')}
                                                    className="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors z-10"
                                                    title="이미지 삭제"
                                                >
                                                    {React.createElement(Icons.X, { size: 14 })}
                                                </button>
                                            </div>
                                        )}
                                        <div className="flex-1">
                                            <input
                                                type="text"
                                                value={formData.cta_image || ''}
                                                onChange={(e) => handleChange('cta_image', e.target.value)}
                                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none mb-2"
                                                placeholder="이미지 URL을 입력하거나 업로드하세요"
                                            />
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={(e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        if (file.size > 10 * 1024 * 1024) {
                                                            alert('이미지 크기는 10MB 이하여야 합니다.');
                                                            e.target.value = '';
                                                            return;
                                                        }
                                                        setCropImageFile(file);
                                                        setCropImageField('cta_image');
                                                        setCropRecommendedSize({ width: 1920, height: 1080 });
                                                        setShowCropModal(true);
                                                        e.target.value = '';
                                                    }
                                                }}
                                                className="hidden"
                                                id="cta-image-upload"
                                            />
                                            <label
                                                htmlFor="cta-image-upload"
                                                className="inline-flex items-center gap-2 px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors cursor-pointer text-sm"
                                            >
                                                {React.createElement(Icons.Camera, { size: 18 })}
                                                <span>{formData.cta_image ? '이미지 교체' : '이미지 업로드'}</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                                                    </div>
                                                                    </div>
                        
                        {/* 페이지 제목 관리 섹션 */}
                        <div className="border-b border-gray-200 pb-8">
                            <h4 className="font-bold text-dark mb-6 text-lg">페이지 제목 관리</h4>
                            <p className="text-sm text-gray-600 mb-6">각 페이지의 메인 제목 텍스트, 크기, 굵기를 설정할 수 있습니다.</p>
                            
                            {(() => {
                                const pageTitles = formData.pageTitles || {};
                                const pageConfigs = [
                                    { key: 'home', label: '홈', defaultText: '함께 성장하는\n청년 사업가 커뮤니티\n부산청년사업가들' },
                                    { key: 'about', label: '소개', defaultText: '함께 성장하는 사업가 네트워크' },
                                    { key: 'programs', label: '프로그램', defaultText: '프로그램' },
                                    { key: 'members', label: '부청사 회원', defaultText: '부청사 회원' },
                                    { key: 'community', label: '커뮤니티', defaultText: '커뮤니티' },
                                    { key: 'restaurants', label: '부산맛집', defaultText: '부산맛집' },
                                    { key: 'donation', label: '후원', defaultText: '후원' },
                                    { key: 'bidSearch', label: '조달청 검색', defaultText: '조달청 입찰공고 검색' },
                                    { key: 'myPage', label: '마이페이지', defaultText: '마이페이지' }
                                ];
                                
                                return (
                                    <div className="space-y-6">
                                        {pageConfigs.map(({ key, label, defaultText }) => {
                                            const pageTitle = pageTitles[key] || { text: defaultText, fontSize: 'text-3xl', fontWeight: 'font-bold' };
                                            
                                            return (
                                                <div key={key} className="bg-gray-50 p-6 rounded-xl border-2 border-gray-200">
                                                    <h5 className="font-bold text-dark mb-4 text-base">{label} 페이지</h5>
                                                    <div className="space-y-4">
                                                        {/* 제목 텍스트 */}
                                                        <div>
                                                            <label className="block text-sm font-bold text-gray-700 mb-2">제목 텍스트</label>
                                                            <textarea
                                                                value={pageTitle.text || defaultText}
                                                                onChange={(e) => {
                                                                    const newPageTitles = {
                                                                        ...pageTitles,
                                                                        [key]: { ...pageTitle, text: e.target.value }
                                                                    };
                                                                    handleChange('pageTitles', newPageTitles);
                                                                }}
                                                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                                rows={key === 'home' ? 3 : 2}
                                                                placeholder={defaultText}
                                                            />
                                                        </div>
                                                        
                                                        {/* 텍스트 크기 및 굵기 */}
                                                        <div className="grid grid-cols-2 gap-4">
                                                            <div>
                                                                <label className="block text-sm font-bold text-gray-700 mb-2">텍스트 크기</label>
                                                                <select
                                                                    value={pageTitle.fontSize || 'text-3xl'}
                                                                    onChange={(e) => {
                                                                        const newPageTitles = {
                                                                            ...pageTitles,
                                                                            [key]: { ...pageTitle, fontSize: e.target.value }
                                                                        };
                                                                        handleChange('pageTitles', newPageTitles);
                                                                    }}
                                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                                >
                                                                    <option value="text-2xl">2xl (작음)</option>
                                                                    <option value="text-3xl">3xl (보통)</option>
                                                                    <option value="text-4xl">4xl (큼)</option>
                                                                    <option value="text-5xl">5xl (매우 큼)</option>
                                                                </select>
                                                            </div>
                                                            <div>
                                                                <label className="block text-sm font-bold text-gray-700 mb-2">텍스트 굵기</label>
                                                                <select
                                                                    value={pageTitle.fontWeight || 'font-bold'}
                                                                    onChange={(e) => {
                                                                        const newPageTitles = {
                                                                            ...pageTitles,
                                                                            [key]: { ...pageTitle, fontWeight: e.target.value }
                                                                        };
                                                                        handleChange('pageTitles', newPageTitles);
                                                                    }}
                                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                                >
                                                                    <option value="font-normal">일반</option>
                                                                    <option value="font-bold">굵게</option>
                                                                    <option value="font-black">매우 굵게</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        
                                                        {/* 미리보기 */}
                                                        <div className="bg-white p-4 rounded-lg border border-gray-300">
                                                            <p className="text-xs text-gray-500 mb-2">미리보기:</p>
                                                            <h2 
                                                                className={`${pageTitle.fontSize || 'text-3xl'} ${pageTitle.fontWeight || 'font-bold'} text-dark mb-2`}
                                                                style={{ whiteSpace: 'pre-line' }}
                                                            >
                                                                {pageTitle.text || defaultText}
                                                            </h2>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                );
                            })()}
                        </div>
                                
                        {/* 저장 버튼 및 상태 표시 */}
                        <div className="flex justify-between items-center pt-6">
                            <div className="text-sm text-gray-500">
                                {saving ? '저장 중...' : '변경사항이 자동으로 저장됩니다'}
                            </div>
                            <button
                                onClick={handleSave}
                                disabled={saving}
                                className="px-8 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors disabled:opacity-50"
                            >
                                {saving ? '저장 중...' : '즉시 저장'}
                            </button>
                        </div>
                    </div>
                    </div>
                    {/* 이미지 크롭 모달 */}
                    {(showCropModal && cropImageFile && cropImageField) ? React.createElement(ImageCropModal, {
                        imageFile: cropImageFile,
                        onCropComplete: handleCropCompleteSettings,
                        onCancel: () => {
                            setShowCropModal(false);
                            setCropImageFile(null);
                            setCropImageField(null);
                        },
                        recommendedWidth: cropRecommendedSize.width,
                        recommendedHeight: cropRecommendedSize.height,
                        aspectRatio: calculateAspectRatio(cropRecommendedSize.width, cropRecommendedSize.height)
                    }) : null}
                </>
            );
        };
        
        // ==========================================
        // 맛집 관리 컴포넌트
        // ==========================================
        const RestaurantManagement = ({ restaurants = [], setRestaurants }) => {
            const [selectedRestaurant, setSelectedRestaurant] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [showAddModal, setShowAddModal] = useState(false);
            const [editFormData, setEditFormData] = useState({});
            const [addFormData, setAddFormData] = useState({
                title: '',
                description: '',
                phone: '',
                openTime: '09:00',
                closeTime: '22:00',
                priceRange: '',
                images: [],
                location: {
                    address: '',
                    lat: null,
                    lng: null
                },
                approvalStatus: 'approved',
                isVisible: true,
                ownerName: '관리자',
                ownerEmail: 'admin@bcsa.com'
            });
            const [uploadingImages, setUploadingImages] = useState(false);
            const [showCropModal, setShowCropModal] = useState(false);
            const [cropImageFile, setCropImageFile] = useState(null);
            const [cropImageContext, setCropImageContext] = useState(null); // 'edit' or 'add'
            const [cropImageIndex, setCropImageIndex] = useState(null); // 이미지 인덱스 (맛집은 여러 이미지)
            
            const handleEdit = (restaurant) => {
                setSelectedRestaurant(restaurant);
                // businessHours를 openTime과 closeTime으로 분리
                let openTime = '09:00';
                let closeTime = '22:00';
                if (restaurant.businessHours) {
                    const timeMatch = restaurant.businessHours.match(/(\d{1,2}):(\d{2})\s*-\s*(\d{1,2}):(\d{2})/);
                    if (timeMatch) {
                        openTime = `${timeMatch[1].padStart(2, '0')}:${timeMatch[2]}`;
                        closeTime = `${timeMatch[3].padStart(2, '0')}:${timeMatch[4]}`;
                    }
                }
                
                setEditFormData({
                    title: restaurant.title || '',
                    description: restaurant.description || '',
                    phone: restaurant.phone || '',
                    openTime: openTime,
                    closeTime: closeTime,
                    businessHours: restaurant.businessHours || '',
                    priceRange: restaurant.priceRange || '',
                    images: restaurant.images || [],
                    location: restaurant.location || { address: '', lat: null, lng: null },
                    menuItems: restaurant.menuItems || [],
                    naverReservationUrl: restaurant.naverReservationUrl || '',
                    smartPlaceUrl: restaurant.smartPlaceUrl || '',
                    approvalStatus: restaurant.approvalStatus || 'pending',
                    isVisible: restaurant.isVisible !== false, // 기본값 true
                });
                setShowEditModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!selectedRestaurant) return;
                
                // 필수 필드 검증
                if (!editFormData.title || !editFormData.title.trim()) {
                    alert('제목을 입력해주세요.');
                    return;
                }
                
                if (!editFormData.location || !editFormData.location.address) {
                    alert('주소를 입력해주세요.');
                    return;
                }
                
                // businessHours 업데이트 (openTime과 closeTime이 있으면 사용)
                const updateData = { ...editFormData };
                if (updateData.openTime && updateData.closeTime) {
                    updateData.businessHours = `${updateData.openTime} - ${updateData.closeTime}`;
                }
                
                // menuItems 필터링 (빈 항목 제거)
                if (updateData.menuItems) {
                    updateData.menuItems = updateData.menuItems.filter(m => m.name && m.name.trim());
                }
                
                // images 필터링 (빈 항목 제거)
                if (updateData.images) {
                    updateData.images = updateData.images.filter(img => img && typeof img === 'string' && img.trim() !== '');
                }
                
                try {
                    await window.firebaseService.updateRestaurant(selectedRestaurant.id, updateData);
                    
                    const updatedRestaurants = restaurants.map(r => 
                        r.id === selectedRestaurant.id ? {...r, ...updateData} : r
                    );
                    setRestaurants(updatedRestaurants);
                    setShowEditModal(false);
                    alert('수정되었습니다.');
                } catch (error) {
                    console.error('❌ 맛집 수정 오류:', error);
                    console.error('에러 상세:', {
                        code: error.code,
                        message: error.message,
                        stack: error.stack,
                        restaurantId: selectedRestaurant.id,
                        updateData: updateData
                    });
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '수정 중 오류가 발생했습니다.';
                    alert(`수정에 실패했습니다.\n${errorMessage}\n\n콘솔을 확인해주세요.`);
                }
            };
            
            const handleDelete = async (restaurant) => {
                if (!confirm(`정말 "${restaurant.title}" 맛집을 삭제하시겠습니까?`)) return;
                try {
                    await window.firebaseService.deleteRestaurant(restaurant.id);
                    setRestaurants(restaurants.filter(r => r.id !== restaurant.id));
                    alert('삭제되었습니다.');
                } catch (error) {
                    console.error('맛집 삭제 오류:', error);
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '삭제 중 오류가 발생했습니다.';
                    alert(`삭제에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            const handleApprove = async (restaurant) => {
                try {
                    await window.firebaseService.updateRestaurant(restaurant.id, { 
                        approvalStatus: 'approved',
                        isVisible: true 
                    });
                    const updatedRestaurants = restaurants.map(r => 
                        r.id === restaurant.id ? {...r, approvalStatus: 'approved', isVisible: true} : r
                    );
                    setRestaurants(updatedRestaurants);
                    alert('승인되었습니다.');
                } catch (error) {
                    console.error('맛집 승인 오류:', error);
                    alert('승인에 실패했습니다.');
                }
            };
            
            const handleReject = async (restaurant) => {
                if (!confirm(`"${restaurant.title}" 맛집을 거절하시겠습니까?`)) return;
                try {
                    await window.firebaseService.updateRestaurant(restaurant.id, { 
                        approvalStatus: 'rejected',
                        isVisible: false 
                    });
                    const updatedRestaurants = restaurants.map(r => 
                        r.id === restaurant.id ? {...r, approvalStatus: 'rejected', isVisible: false} : r
                    );
                    setRestaurants(updatedRestaurants);
                    alert('거절되었습니다.');
                } catch (error) {
                    console.error('맛집 거절 오류:', error);
                    alert('거절에 실패했습니다.');
                }
            };
            
            const handleToggleVisibility = async (restaurant) => {
                const newVisibility = !restaurant.isVisible;
                try {
                    await window.firebaseService.updateRestaurant(restaurant.id, { isVisible: newVisibility });
                    const updatedRestaurants = restaurants.map(r => 
                        r.id === restaurant.id ? {...r, isVisible: newVisibility} : r
                    );
                    setRestaurants(updatedRestaurants);
                } catch (error) {
                    console.error('노출 여부 변경 오류:', error);
                    alert('노출 여부 변경에 실패했습니다.');
                }
            };

            const handleAdd = () => {
                setAddFormData({
                    title: '',
                    description: '',
                    phone: '',
                    openTime: '09:00',
                    closeTime: '22:00',
                    priceRange: '',
                    images: [],
                    location: {
                        address: '',
                        lat: null,
                        lng: null
                    },
                    approvalStatus: 'approved',
                    isVisible: true,
                    ownerName: '관리자',
                    ownerEmail: 'admin@bcsa.com'
                });
                setShowAddModal(true);
            };

            // 크롭 완료 핸들러 (맛집 관리용)
            const handleCropCompleteRestaurant = async (croppedImageBase64) => {
                if (!cropImageFile) return;
                
                try {
                    setUploadingImages(true);
                    const uploaded = await uploadImageToImgBB(croppedImageBase64, cropImageFile.name);
                    
                    if (!uploaded || !uploaded.url) {
                        throw new Error('이미지 업로드 응답에 URL이 없습니다.');
                    }
                    
                    if (cropImageContext === 'edit') {
                        // 함수형 업데이트 사용
                        setEditFormData(prevData => {
                            const currentImages = prevData.images || [];
                            let newImages;
                            
                            if (cropImageIndex !== null && cropImageIndex >= 0) {
                                // 특정 인덱스 교체
                                newImages = [...currentImages];
                                newImages[cropImageIndex] = uploaded.url;
                            } else {
                                // 새 이미지 추가
                                newImages = [...currentImages, uploaded.url];
                            }
                            
                            return {
                                ...prevData,
                                images: newImages
                            };
                        });
                    } else if (cropImageContext === 'add') {
                        // 함수형 업데이트 사용
                        setAddFormData(prevData => ({
                            ...prevData,
                            images: [...(prevData.images || []), uploaded.url]
                        }));
                    }
                    
                    // 렌더링 시간 확보 후 모달 닫기
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            setShowCropModal(false);
                            setCropImageFile(null);
                            setCropImageContext(null);
                            setCropImageIndex(null);
                        });
                    });
                } catch (error) {
                    console.error('❌ 이미지 업로드 오류:', error);
                    alert(`이미지 업로드에 실패했습니다.\n${error.message || '알 수 없는 오류'}`);
                } finally {
                    setUploadingImages(false);
                }
            };
            
            // 이미지 업로드 핸들러 (추가용) - 크롭 모달로 변경
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                if (addFormData.images.length >= 10) {
                    alert('이미지는 최대 10장까지 업로드할 수 있습니다.');
                    e.target.value = '';
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) {
                    alert('이미지 크기는 10MB 이하여야 합니다.');
                    e.target.value = '';
                    return;
                }
                
                setCropImageFile(file);
                setCropImageContext('add');
                setCropImageIndex(null);
                setShowCropModal(true);
                e.target.value = '';
            };

            // 이미지 삭제 핸들러 (추가용)
            const handleImageRemove = (index) => {
                const newImages = addFormData.images.filter((_, i) => i !== index);
                setAddFormData({ ...addFormData, images: newImages });
            };
            
            // 수정용 이미지 업로드 핸들러 - 크롭 모달로 변경
            const handleEditImageUpload = (e, index = null) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const currentImages = editFormData.images || [];
                
                if (index !== null) {
                    // 특정 인덱스 교체
                    if (file.size > 10 * 1024 * 1024) {
                        alert('이미지 크기는 10MB 이하여야 합니다.');
                        e.target.value = '';
                        return;
                    }
                    setCropImageFile(file);
                    setCropImageContext('edit');
                    setCropImageIndex(index);
                    setShowCropModal(true);
                    e.target.value = '';
                } else {
                    // 새 이미지 추가
                    if (currentImages.length >= 10) {
                        alert('이미지는 최대 10장까지 업로드할 수 있습니다.');
                        e.target.value = '';
                        return;
                    }
                    
                    if (file.size > 10 * 1024 * 1024) {
                        alert('이미지 크기는 10MB 이하여야 합니다.');
                        e.target.value = '';
                        return;
                    }
                    
                    setCropImageFile(file);
                    setCropImageContext('edit');
                    setCropImageIndex(null);
                    setShowCropModal(true);
                    e.target.value = '';
                }
            };

            // 수정용 이미지 삭제 핸들러
            const handleEditImageRemove = (index) => {
                const newImages = (editFormData.images || []).filter((_, i) => i !== index);
                setEditFormData({ ...editFormData, images: newImages });
            };
            
            // 수정용 메뉴 추가/삭제 핸들러
            const handleEditAddMenuItem = () => {
                const currentMenuItems = editFormData.menuItems || [];
                if (currentMenuItems.length >= 10) {
                    alert('대표메뉴는 최대 10개까지 등록할 수 있습니다.');
                    return;
                }
                setEditFormData({
                    ...editFormData,
                    menuItems: [...currentMenuItems, { name: '', price: '' }]
                });
            };
            
            const handleEditRemoveMenuItem = (index) => {
                const currentMenuItems = editFormData.menuItems || [];
                const newMenuItems = currentMenuItems.filter((_, i) => i !== index);
                setEditFormData({ ...editFormData, menuItems: newMenuItems.length > 0 ? newMenuItems : [] });
            };
            
            // 수정용 주소 검색 핸들러
            const handleEditAddressSearch = () => {
                if (!window.kakao || !window.kakao.maps) {
                    alert('카카오맵 API가 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                    return;
                }
                
                openKakaoPlacesSearch((place) => {
                    setEditFormData({
                        ...editFormData,
                        location: {
                            name: place.name || editFormData.location?.name || '',
                            address: place.address,
                            lat: place.lat,
                            lng: place.lng
                        },
                        phone: place.phone || editFormData.phone || ''
                    });
                });
            };

            // 카카오맵 주소 검색 핸들러
            const handleAddressSearch = () => {
                if (!window.kakao || !window.kakao.maps) {
                    alert('카카오맵 API가 로드되지 않았습니다. 잠시 후 다시 시도해주세요.');
                    return;
                }
                
                openKakaoPlacesSearch((place) => {
                    setAddFormData({
                        ...addFormData,
                        location: {
                            address: place.address,
                            lat: place.lat,
                            lng: place.lng
                        },
                        phone: place.phone || addFormData.phone
                    });
                });
            };

            const handleSaveAdd = async () => {
                if (!addFormData.title || !addFormData.location.address) {
                    alert('제목과 주소는 필수 입력 항목입니다.');
                    return;
                }
                try {
                    // businessHours를 openTime과 closeTime으로 구성
                    const businessHours = `${addFormData.openTime} - ${addFormData.closeTime}`;
                    const restaurantData = {
                        ...addFormData,
                        businessHours: businessHours
                    };
                    
                    const restaurantId = await window.firebaseService.createRestaurant(restaurantData);
                    const newRestaurant = {
                        id: restaurantId,
                        ...restaurantData,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    };
                    setRestaurants([...restaurants, newRestaurant]);
                    setShowAddModal(false);
                    alert('맛집이 추가되었습니다.');
                } catch (error) {
                    console.error('맛집 추가 오류:', error);
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '맛집 추가 중 오류가 발생했습니다.';
                    alert(`맛집 추가에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-bold text-dark">맛집 관리</h3>
                        <button
                            onClick={handleAdd}
                            className="px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors flex items-center gap-2"
                        >
                            <Icons.Plus size={20} />
                            맛집 추가
                        </button>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="w-full">
                            <thead>
                                <tr className="border-b border-gray-200">
                                    <th className="text-left p-4 font-bold text-dark">제목</th>
                                    <th className="text-left p-4 font-bold text-dark">등록자</th>
                                    <th className="text-left p-4 font-bold text-dark">주소</th>
                                    <th className="text-left p-4 font-bold text-dark">승인 상태</th>
                                    <th className="text-left p-4 font-bold text-dark">노출 여부</th>
                                    <th className="text-left p-4 font-bold text-dark">액션</th>
                                </tr>
                            </thead>
                            <tbody>
                                {restaurants.length === 0 ? (
                                    <tr>
                                        <td colSpan="6" className="text-center py-8 text-gray-400">맛집이 없습니다.</td>
                                    </tr>
                                ) : (
                                    restaurants.map(restaurant => (
                                        <tr key={restaurant.id} className="border-b border-gray-100 hover:bg-gray-50">
                                            <td className="p-4 font-bold text-dark">{restaurant.title || '제목 없음'}</td>
                                            <td className="p-4 text-gray-600">{restaurant.ownerName || '-'}</td>
                                            <td className="p-4 text-gray-600">
                                                {restaurant.location?.address ? (
                                                    <span className="line-clamp-1 max-w-xs">{restaurant.location.address}</span>
                                                ) : '-'}
                                            </td>
                                            <td className="p-4">
                                                <span className={`text-xs px-2 py-1 rounded font-bold ${
                                                    restaurant.approvalStatus === 'approved' ? 'bg-green-100 text-green-700' :
                                                    restaurant.approvalStatus === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                                    'bg-red-100 text-red-700'
                                                }`}>
                                                    {restaurant.approvalStatus === 'approved' ? '승인' :
                                                     restaurant.approvalStatus === 'pending' ? '대기' : '거절'}
                                                </span>
                                            </td>
                                            <td className="p-4">
                                                <button
                                                    onClick={() => handleToggleVisibility(restaurant)}
                                                    className={`text-xs px-2 py-1 rounded font-bold ${
                                                        restaurant.isVisible !== false ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'
                                                    }`}
                                                >
                                                    {restaurant.isVisible !== false ? '노출' : '비노출'}
                                                </button>
                                            </td>
                                            <td className="p-4">
                                                <div className="flex gap-2">
                                                    {restaurant.approvalStatus !== 'approved' && (
                                                        <button
                                                            onClick={() => handleApprove(restaurant)}
                                                            className="p-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors"
                                                            title="승인"
                                                        >
                                                            <Icons.CheckCircle size={16} />
                                                        </button>
                                                    )}
                                                    {restaurant.approvalStatus !== 'rejected' && (
                                                        <button
                                                            onClick={() => handleReject(restaurant)}
                                                            className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                                            title="거절"
                                                        >
                                                            <Icons.X size={16} />
                                                        </button>
                                                    )}
                                                    <button
                                                        onClick={() => handleEdit(restaurant)}
                                                        className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                                        title="수정"
                                                    >
                                                        <Icons.Edit size={16} />
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(restaurant)}
                                                        className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                                        title="삭제"
                                                    >
                                                        <Icons.Trash size={16} />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))
                                )}
                            </tbody>
                        </table>
                    </div>
                    
                    {/* 수정 모달 */}
                    {showEditModal && selectedRestaurant && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4" onClick={() => setShowEditModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto modal-scroll" onClick={(e) => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-6">
                                    <h4 className="text-xl font-bold text-dark">맛집 수정</h4>
                                    <button
                                        onClick={() => setShowEditModal(false)}
                                        className="p-2 hover:bg-gray-100 rounded-lg"
                                    >
                                        <Icons.X size={24} />
                                    </button>
                                </div>
                                <div className="space-y-6">
                                    {/* 제목 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">제목 *</label>
                                        <input
                                            type="text"
                                            value={editFormData.title || ''}
                                            onChange={(e) => setEditFormData({...editFormData, title: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="맛집 이름"
                                        />
                                    </div>
                                    
                                    {/* 설명 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                        <textarea
                                            value={editFormData.description || ''}
                                            onChange={(e) => setEditFormData({...editFormData, description: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            rows="3"
                                            placeholder="맛집 설명"
                                        />
                                    </div>
                                    
                                    {/* 이미지 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">
                                            이미지 (최대 10장)
                                            <span className="text-xs text-gray-500 font-normal ml-2">
                                                추천 해상도: 1200x800px (3:2)
                                            </span>
                                        </label>
                                        <div className="space-y-3">
                                            {/* 기존 이미지 표시 */}
                                            {(editFormData.images || []).length > 0 && (
                                                <div className="grid grid-cols-5 gap-2">
                                                    {editFormData.images.map((imageUrl, index) => (
                                                        <div key={index} className="relative group">
                                                            <img
                                                                src={getImageUrlWithTimestamp(imageUrl)}
                                                                alt={`맛집 이미지 ${index + 1}`}
                                                                className="w-full h-24 object-cover rounded-xl border-2 border-gray-200"
                                                                onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }}
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={() => handleEditImageRemove(index)}
                                                                className="absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                                                            >
                                                                <Icons.X size={14} />
                                                            </button>
                                                            <label className="absolute inset-0 cursor-pointer">
                                                                <input
                                                                    type="file"
                                                                    accept="image/*"
                                                                    onChange={(e) => handleEditImageUpload(e, index)}
                                                                    className="hidden"
                                                                    disabled={uploadingImages}
                                                                />
                                                            </label>
                                                            <div className="absolute bottom-1 left-1 px-2 py-0.5 bg-black/50 text-white text-xs rounded opacity-0 group-hover:opacity-100">
                                                                클릭하여 교체
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                            {/* 새 이미지 추가 */}
                                            {(editFormData.images || []).length < 10 && (
                                                <div className="flex items-center gap-2">
                                                    <label className="flex-1 p-3 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-brand transition-colors text-center">
                                                        <input
                                                            type="file"
                                                            accept="image/*"
                                                            multiple
                                                            onChange={(e) => handleEditImageUpload(e)}
                                                            disabled={uploadingImages || (editFormData.images || []).length >= 10}
                                                            className="hidden"
                                                        />
                                                        <span className="text-sm font-bold text-gray-600">
                                                            {uploadingImages ? '업로드 중...' : '이미지 추가'}
                                                        </span>
                                                    </label>
                                                    <span className="text-sm text-gray-500">
                                                        {(editFormData.images || []).length}/10
                                                    </span>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* 위치 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">주소 *</label>
                                        {editFormData.location?.address && (
                                            <div className="p-3 bg-gray-50 rounded-xl mb-2">
                                                <p className="font-bold text-sm">{editFormData.location.name || '위치'}</p>
                                                <p className="text-xs text-gray-600">{editFormData.location.address}</p>
                                            </div>
                                        )}
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={editFormData.location?.address || ''}
                                                onChange={(e) => setEditFormData({
                                                    ...editFormData,
                                                    location: {...(editFormData.location || {}), address: e.target.value}
                                                })}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                placeholder="부산광역시 해운대구..."
                                            />
                                            <button
                                                type="button"
                                                onClick={handleEditAddressSearch}
                                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors whitespace-nowrap"
                                            >
                                                주소 검색
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* 대표메뉴 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">대표메뉴 (최대 10개)</label>
                                        <div className="space-y-2">
                                            {(editFormData.menuItems || []).map((menu, index) => (
                                                <div key={index} className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        value={menu.name || ''}
                                                        onChange={(e) => {
                                                            const newMenuItems = [...(editFormData.menuItems || [])];
                                                            newMenuItems[index] = {...newMenuItems[index], name: e.target.value};
                                                            setEditFormData({...editFormData, menuItems: newMenuItems});
                                                        }}
                                                        className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                        placeholder="메뉴명"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={menu.price || ''}
                                                        onChange={(e) => {
                                                            const newMenuItems = [...(editFormData.menuItems || [])];
                                                            newMenuItems[index] = {...newMenuItems[index], price: e.target.value};
                                                            setEditFormData({...editFormData, menuItems: newMenuItems});
                                                        }}
                                                        className="w-32 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                        placeholder="가격"
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => handleEditRemoveMenuItem(index)}
                                                        className="px-4 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600"
                                                    >
                                                        삭제
                                                    </button>
                                                </div>
                                            ))}
                                            {(editFormData.menuItems || []).length < 10 && (
                                                <button
                                                    type="button"
                                                    onClick={handleEditAddMenuItem}
                                                    className="mt-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300"
                                                >
                                                    메뉴 추가
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* 전화번호 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">전화번호</label>
                                        <input
                                            type="text"
                                            value={editFormData.phone || ''}
                                            onChange={(e) => setEditFormData({...editFormData, phone: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="051-123-4567"
                                        />
                                    </div>
                                    
                                    {/* 영업시간 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">영업시간</label>
                                        <div className="flex items-center gap-3">
                                            <input
                                                type="time"
                                                value={editFormData.openTime || '09:00'}
                                                onChange={(e) => setEditFormData({...editFormData, openTime: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            />
                                            <span className="text-gray-600 font-bold">~</span>
                                            <input
                                                type="time"
                                                value={editFormData.closeTime || '22:00'}
                                                onChange={(e) => setEditFormData({...editFormData, closeTime: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            />
                                        </div>
                                        <input
                                            type="text"
                                            value={editFormData.businessHours || ''}
                                            onChange={(e) => setEditFormData({...editFormData, businessHours: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none mt-2"
                                            placeholder="또는 직접 입력 (예: 11:00 - 22:00)"
                                        />
                                    </div>
                                    
                                    {/* 가격대 */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">가격대</label>
                                        <input
                                            type="text"
                                            value={editFormData.priceRange || ''}
                                            onChange={(e) => setEditFormData({...editFormData, priceRange: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="1만원 - 3만원"
                                        />
                                    </div>
                                    
                                    {/* 네이버 예약 URL */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">네이버 예약 URL</label>
                                        <input
                                            type="url"
                                            value={editFormData.naverReservationUrl || ''}
                                            onChange={(e) => setEditFormData({...editFormData, naverReservationUrl: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="https://booking.naver.com/..."
                                        />
                                    </div>
                                    
                                    {/* 스마트플레이스 URL */}
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">스마트플레이스 URL</label>
                                        <input
                                            type="url"
                                            value={editFormData.smartPlaceUrl || ''}
                                            onChange={(e) => setEditFormData({...editFormData, smartPlaceUrl: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="https://place.naver.com/..."
                                        />
                                    </div>
                                    
                                    {/* 승인 상태 및 노출 여부 */}
                                    <div className="grid grid-cols-2 gap-4 pt-4 border-t border-gray-200">
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">승인 상태</label>
                                        <select
                                                value={editFormData.approvalStatus || 'pending'}
                                            onChange={(e) => setEditFormData({...editFormData, approvalStatus: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        >
                                            <option value="pending">대기</option>
                                            <option value="approved">승인</option>
                                            <option value="rejected">거절</option>
                                        </select>
                                    </div>
                                        <div className="flex items-end">
                                            <div className="flex items-center gap-2 w-full">
                                        <input
                                            type="checkbox"
                                                    checked={editFormData.isVisible !== false}
                                            onChange={(e) => setEditFormData({...editFormData, isVisible: e.target.checked})}
                                                    className="w-5 h-5"
                                        />
                                        <label className="text-sm font-bold text-gray-700">노출 여부</label>
                                    </div>
                                        </div>
                                    </div>
                                    
                                    {/* 저장 버튼 */}
                                    <div className="flex gap-4 pt-4">
                                        <button
                                            onClick={() => setShowEditModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                                        >
                                            취소
                                        </button>
                                        <button
                                            onClick={handleSaveEdit}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            저장
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 관리자 추가 모달 */}
                    {showAddModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={() => setShowAddModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <h4 className="text-xl font-bold text-dark mb-4">맛집 추가</h4>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">제목 *</label>
                                        <input
                                            type="text"
                                            value={addFormData.title}
                                            onChange={(e) => setAddFormData({...addFormData, title: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="맛집 이름"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                        <textarea
                                            value={addFormData.description}
                                            onChange={(e) => setAddFormData({...addFormData, description: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            rows="3"
                                            placeholder="맛집 설명"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">전화번호</label>
                                        <input
                                            type="text"
                                            value={addFormData.phone}
                                            onChange={(e) => setAddFormData({...addFormData, phone: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="010-1234-5678"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">영업시간</label>
                                        <div className="flex items-center gap-3">
                                            <input
                                                type="time"
                                                value={addFormData.openTime}
                                                onChange={(e) => setAddFormData({...addFormData, openTime: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            />
                                            <span className="text-gray-600 font-bold">~</span>
                                            <input
                                                type="time"
                                                value={addFormData.closeTime}
                                                onChange={(e) => setAddFormData({...addFormData, closeTime: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">가격대</label>
                                        <input
                                            type="text"
                                            value={addFormData.priceRange}
                                            onChange={(e) => setAddFormData({...addFormData, priceRange: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="1만원 - 3만원"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">주소 *</label>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={addFormData.location.address}
                                                onChange={(e) => setAddFormData({
                                                    ...addFormData, 
                                                    location: {...addFormData.location, address: e.target.value}
                                                })}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                placeholder="부산광역시 해운대구..."
                                            />
                                            <button
                                                type="button"
                                                onClick={handleAddressSearch}
                                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors whitespace-nowrap"
                                            >
                                                주소 검색
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">
                                            이미지 (최대 10장)
                                            <span className="text-xs text-gray-500 font-normal ml-2">
                                                추천 해상도: 1200x800px (3:2)
                                            </span>
                                        </label>
                                        <div className="space-y-3">
                                            <div className="flex items-center gap-2">
                                                <label className="flex-1 p-3 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-brand transition-colors text-center">
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        onChange={handleImageUpload}
                                                        disabled={uploadingImages || addFormData.images.length >= 10}
                                                        className="hidden"
                                                    />
                                                    <span className="text-sm font-bold text-gray-600">
                                                        {uploadingImages ? '업로드 중...' : '이미지 선택'}
                                                    </span>
                                                </label>
                                                <span className="text-sm text-gray-500">
                                                    {addFormData.images.length}/10
                                                </span>
                                            </div>
                                            {addFormData.images.length > 0 && (
                                                <div className="grid grid-cols-5 gap-2">
                                                    {addFormData.images.map((imageUrl, index) => (
                                                        <div key={index} className="relative group">
                                                            <img
                                                                src={getImageUrlWithTimestamp(imageUrl)}
                                                                alt={`맛집 이미지 ${index + 1}`}
                                                                className="w-full h-24 object-cover rounded-xl border-2 border-gray-200"
                                                                onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }}
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={() => handleImageRemove(index)}
                                                                className="absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                                                            >
                                                                <Icons.X size={14} />
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="flex gap-4">
                                <button
                                    onClick={() => setShowAddModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                                        >
                                            취소
                                        </button>
                                        <button
                                            onClick={handleSaveAdd}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            추가
                                </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 크롭 모달 (맛집 관리용) */}
                    {(showCropModal && cropImageFile) ? React.createElement(ImageCropModal, {
                        imageFile: cropImageFile,
                        onCropComplete: handleCropCompleteRestaurant,
                        onCancel: () => {
                            setShowCropModal(false);
                            setCropImageFile(null);
                            setCropImageContext(null);
                            setCropImageIndex(null);
                        },
                        recommendedWidth: 1200,
                        recommendedHeight: 800,
                        aspectRatio: calculateAspectRatio(1200, 800)
                    }) : null}
                                </div>
            );
        };
        
        // ==========================================
        // 회원 관리 컴포넌트
        // ==========================================
        const UserManagement = ({ users = [], setUsers }) => {
            const [selectedUser, setSelectedUser] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [editFormData, setEditFormData] = useState({});
            
            const handleEdit = (user) => {
                setSelectedUser(user);
                setEditFormData({
                    approvalStatus: user.approvalStatus || 'pending',
                    isAdmin: user.isAdmin || false,
                    memberGrade: user.memberGrade || '일반회원'
                });
                setShowEditModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!selectedUser) return;
                try {
                    await window.firebaseService.updateUser(selectedUser.id, editFormData);
                    const updatedUsers = users.map(u => 
                        u.id === selectedUser.id ? {...u, ...editFormData} : u
                    );
                    setUsers(updatedUsers);
                    setShowEditModal(false);
                    alert('수정되었습니다.');
                                                                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '수정 중 오류가 발생했습니다.';
                    alert(`수정에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            const handleDelete = async (user) => {
                if (!confirm(`정말 ${user.name || user.email} 회원을 삭제하시겠습니까?`)) return;
                try {
                    await window.firebaseService.deleteUser(user.id);
                    setUsers(users.filter(u => u.id !== user.id));
                    alert('삭제되었습니다.');
                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '삭제 중 오류가 발생했습니다.';
                    alert(`삭제에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <h3 className="text-xl font-bold text-dark mb-6">회원 관리</h3>
                    <div className="overflow-x-auto">
                            <table className="w-full">
                            <thead>
                                <tr className="border-b border-gray-200">
                                    <th className="text-left p-4 font-bold text-dark">이름</th>
                                    <th className="text-left p-4 font-bold text-dark">이메일</th>
                                    <th className="text-left p-4 font-bold text-dark">회원 유형</th>
                                    <th className="text-left p-4 font-bold text-dark">승인 상태</th>
                                    <th className="text-left p-4 font-bold text-dark">가입일</th>
                                    <th className="text-left p-4 font-bold text-dark">액션</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {users.length === 0 ? (
                                    <tr>
                                        <td colSpan="6" className="text-center py-8 text-gray-400">회원이 없습니다.</td>
                                    </tr>
                                ) : (
                                    users.map(user => {
                                        const isHaetban = user.name === '햇반' || 
                                                         user.email === 'haetban@bcsa-b190f.firebaseapp.com' || 
                                                         (user.isAdmin === true && user.name === '햇반');
                                        return (
                                        <tr key={user.id || user.uid} className="border-b border-gray-100 hover:bg-gray-50">
                                            <td className="p-4 font-bold text-dark">
                                                {user.name || '이름 없음'}
                                                {isHaetban && (
                                                    <span className="ml-2 text-xs px-2 py-1 bg-red-100 text-red-700 rounded font-bold">
                                                        관리자
                                                    </span>
                                                )}
                                            </td>
                                            <td className="p-4 text-gray-600">{user.email || '-'}</td>
                                            <td className="p-4 text-gray-600">{user.userType || '-'}</td>
                                                <td className="p-4">
                                                    <span className={`text-xs px-2 py-1 rounded font-bold ${
                                                    user.approvalStatus === 'approved' ? 'bg-green-100 text-green-700' :
                                                    user.approvalStatus === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                                    'bg-red-100 text-red-700'
                                                }`}>
                                                    {user.approvalStatus === 'approved' ? '승인' :
                                                     user.approvalStatus === 'pending' ? '대기' : '거부'}
                                                    </span>
                                                </td>
                                            <td className="p-4 text-gray-600">
                                                {user.createdAt?.toDate ? 
                                                    user.createdAt.toDate().toLocaleDateString('ko-KR') :
                                                    user.createdAt ? new Date(user.createdAt).toLocaleDateString('ko-KR') : '-'}
                                            </td>
                                            <td className="p-4">
                                                <div className="flex gap-2">
                                                                <button 
                                                        onClick={() => handleEdit(user)}
                                                        className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                                    >
                                                        <Icons.Edit size={16} />
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(user)}
                                                        className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                                    >
                                                        <Icons.Trash size={16} />
                                                    </button>
                                                </div>
                                            </td>
                                                    </tr>
                                        );
                                    })
                                )}
                                </tbody>
                            </table>
                                        </div>
                                        
                    {/* 수정 모달 */}
                    {showEditModal && selectedUser && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={() => setShowEditModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
                                <h4 className="text-xl font-bold text-dark mb-4">회원 수정</h4>
                                        <div className="space-y-4">
                                                <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">승인 상태</label>
                                        <select
                                            value={editFormData.approvalStatus}
                                            onChange={(e) => setEditFormData({...editFormData, approvalStatus: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        >
                                            <option value="pending">대기</option>
                                            <option value="approved">승인</option>
                                            <option value="rejected">거부</option>
                                                </select>
                                                </div>
                                                <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">회원 등급</label>
                                        <input
                                            type="text"
                                            value={editFormData.memberGrade}
                                            onChange={(e) => setEditFormData({...editFormData, memberGrade: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            placeholder="일반회원"
                                            />
                                                </div>
                                    <div className="flex items-center gap-2">
                                        <input
                                            type="checkbox"
                                            checked={editFormData.isAdmin}
                                            onChange={(e) => setEditFormData({...editFormData, isAdmin: e.target.checked})}
                                        />
                                        <label className="text-sm font-bold text-gray-700">관리자 권한</label>
                                                    </div>
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => setShowEditModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                                        >
                                        취소
                                    </button>
                                        <button
                                            onClick={handleSaveEdit}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            저장
                                                                </button>
                                    </div>
                                                            </div>
                                                                </div>
                                                            </div>
                                    )}
                                                    </div>
            );
        };

        // ==========================================
        // 게시글 관리 컴포넌트
        // ==========================================
        const PostManagement = ({ posts = [], setPosts }) => {
            const [selectedPost, setSelectedPost] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [editFormData, setEditFormData] = useState({});
            
            const handleEdit = (post) => {
                setSelectedPost(post);
                setEditFormData({
                    title: post.title || '',
                    content: post.content || '',
                    category: post.category || ''
                });
                setShowEditModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!selectedPost) return;
                try {
                    await window.firebaseService.updatePost(selectedPost.id, editFormData);
                    const updatedPosts = posts.map(p => 
                        p.id === selectedPost.id ? {...p, ...editFormData} : p
                    );
                    setPosts(updatedPosts);
                    setShowEditModal(false);
                    alert('수정되었습니다.');
                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '수정 중 오류가 발생했습니다.';
                    alert(`수정에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            const handleDelete = async (post) => {
                if (!confirm(`정말 "${post.title}" 게시글을 삭제하시겠습니까?`)) return;
                try {
                    await window.firebaseService.deletePost(post.id);
                    setPosts(posts.filter(p => p.id !== post.id));
                    alert('삭제되었습니다.');
                } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '삭제 중 오류가 발생했습니다.';
                    alert(`삭제에 실패했습니다.\n${errorMessage}`);
                }
            };
                            
                            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <h3 className="text-xl font-bold text-dark mb-6">게시글 관리</h3>
                    <div className="space-y-4">
                        {posts.length === 0 ? (
                            <p className="text-center py-8 text-gray-400">게시글이 없습니다.</p>
                        ) : (
                            posts.map(post => (
                                <div key={post.id} className="border border-gray-200 rounded-xl p-4 hover:bg-gray-50">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                            <h4 className="font-bold text-dark mb-2">{post.title || '제목 없음'}</h4>
                                            <p className="text-sm text-gray-600 mb-2">{post.author || '작성자 없음'}</p>
                                            <p className="text-sm text-gray-500">{post.category || '카테고리 없음'}</p>
                                    </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => handleEdit(post)}
                                                className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                            >
                                                <Icons.Edit size={16} />
                                            </button>
                                            <button
                                                onClick={() => handleDelete(post)}
                                                className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                            >
                                                <Icons.Trash size={16} />
                                            </button>
                                    </div>
                                                    </div>
                                                    </div>
                            ))
                        )}
                    </div>
                    
                    {/* 수정 모달 */}
                    {showEditModal && selectedPost && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={() => setShowEditModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <h4 className="text-xl font-bold text-dark mb-4">게시글 수정</h4>
                                <div className="space-y-4">
                                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">제목</label>
                                        <input
                                            type="text"
                                            value={editFormData.title}
                                            onChange={(e) => setEditFormData({...editFormData, title: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        />
                                                    </div>
                                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">내용</label>
                                        <textarea
                                            value={editFormData.content}
                                            onChange={(e) => setEditFormData({...editFormData, content: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                            rows="10"
                                        />
                                                    </div>
                                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">카테고리</label>
                                        <input
                                            type="text"
                                            value={editFormData.category}
                                            onChange={(e) => setEditFormData({...editFormData, category: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                        />
                                                    </div>
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => setShowEditModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                                        >
                                            취소
                                        </button>
                                        <button
                                            onClick={handleSaveEdit}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            저장
                                        </button>
                                                    </div>
                                                    </div>
                            </div>
                                                    </div>
                                                )}
                                                    </div>
            );
        };
        
        // ==========================================
        // 프로그램 관리 컴포넌트
        // ==========================================
        const ProgramManagement = ({ seminars = [], setSeminars }) => {
            const [selectedSeminar, setSelectedSeminar] = useState(null);
            const [showEditModal, setShowEditModal] = useState(false);
            const [showAddModal, setShowAddModal] = useState(false);
            const [showMapModal, setShowMapModal] = useState(false);
            const [editFormData, setEditFormData] = useState({});
            const [uploadingImage, setUploadingImage] = useState(false);
            const [showCropModal, setShowCropModal] = useState(false);
            const [cropImageFile, setCropImageFile] = useState(null);
            const [cropImageType, setCropImageType] = useState(null); // 'edit' or 'add'
            
            const handleEdit = (seminar) => {
                setSelectedSeminar(seminar);
                // images 배열과 img 필드 모두 처리 (App.jsx와 동일한 정규화 로직)
                let imagesArray = [];
                
                if (Array.isArray(seminar.images)) {
                    // 배열인 경우: 빈 문자열, null, undefined 필터링
                    imagesArray = seminar.images.filter(img => 
                        img !== null && 
                        img !== undefined && 
                        typeof img === 'string' && 
                        img.trim() !== ''
                    );
                } else if (typeof seminar.images === 'string' && seminar.images.trim() !== '') {
                    // 문자열인 경우 배열로 변환
                    try {
                        const parsed = JSON.parse(seminar.images);
                        if (Array.isArray(parsed)) {
                            imagesArray = parsed.filter(img => 
                                img !== null && 
                                img !== undefined && 
                                typeof img === 'string' && 
                                img.trim() !== ''
                            );
                        } else {
                            imagesArray = [seminar.images];
                        }
                    } catch (e) {
                        // JSON 파싱 실패 시 단일 문자열로 처리
                        imagesArray = [seminar.images];
                    }
                }
                
                // images 배열이 비어있고 img 필드가 있으면 img 필드 사용
                if (imagesArray.length === 0 && seminar.img && typeof seminar.img === 'string' && seminar.img.trim() !== '') {
                    imagesArray = [seminar.img];
                }
                
                setEditFormData({
                    title: seminar.title || '',
                    desc: seminar.desc || seminar.description || '',
                    description: seminar.description || seminar.desc || '',
                    date: seminar.date || '',
                    location: seminar.location || '',
                    images: imagesArray,
                    img: seminar.img || (imagesArray.length > 0 ? imagesArray[0] : ''),
                    category: seminar.category || '',
                    status: seminar.status || '모집중',
                    price: seminar.price || 0,
                    requiresPayment: seminar.requiresPayment || false,
                    maxParticipants: seminar.maxParticipants || 0,
                    currentParticipants: seminar.currentParticipants || 0,
                    deadline: seminar.deadline || ''
                });
                setShowEditModal(true);
            };
            
            const handleAdd = () => {
                setSelectedSeminar(null);
                setEditFormData({
                    title: '',
                    desc: '',
                    description: '',
                    date: '',
                    location: '',
                    images: [],
                    img: '',
                    category: '',
                    status: '모집중',
                    price: 0,
                    requiresPayment: false,
                    maxParticipants: 0,
                    currentParticipants: 0,
                    deadline: ''
                });
                setShowAddModal(true);
            };
            
            const handleSaveEdit = async () => {
                if (!selectedSeminar) return;
                
                // 필수 필드 검증
                if (!editFormData.title || !editFormData.title.trim()) {
                    alert('제목을 입력해주세요.');
                    return;
                }
                
                if (!editFormData.date || !editFormData.date.trim()) {
                    alert('날짜를 입력해주세요.');
                    return;
                }
                
                try {
                    // images 배열 처리 및 정규화
                    const imagesArray = editFormData.images && Array.isArray(editFormData.images)
                        ? editFormData.images.filter(img => img && img && typeof img === 'string' && img.trim() !== '')
                        : (editFormData.img && typeof editFormData.img === 'string' && editFormData.img.trim() !== '' ? [editFormData.img] : []);
                    
                    // desc와 description 통합 (desc 우선)
                    const saveData = {
                        ...editFormData,
                        images: imagesArray,
                        img: imagesArray.length > 0 ? imagesArray[0] : (editFormData.img || ''),
                        desc: editFormData.desc || editFormData.description || '',
                        description: editFormData.desc || editFormData.description || '',
                    };
                    
                    // 저장 전 최종 데이터 검증
                    await window.firebaseService.updateSeminar(selectedSeminar.id, saveData);
                    
                    const updatedSeminars = seminars.map(s => 
                        s.id === selectedSeminar.id ? {...s, ...saveData} : s
                    );
                    setSeminars(updatedSeminars);
                    setShowEditModal(false);
                    alert('수정되었습니다.');
                } catch (error) {
                    console.error('❌ 프로그램 수정 오류:', error);
                    console.error('에러 상세:', {
                        code: error.code,
                        message: error.message,
                        stack: error.stack,
                        seminarId: selectedSeminar.id,
                        editFormData: editFormData
                    });
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '수정 중 오류가 발생했습니다.';
                    alert(`수정에 실패했습니다.\n${errorMessage}\n\n콘솔을 확인해주세요.`);
                }
            };
            
            // 크롭 완료 핸들러
            const handleCropComplete = async (croppedImageBase64) => {
                if (!cropImageFile) return;
                
                try {
                    setUploadingImage(true);
                    const uploaded = await uploadImageToImgBB(croppedImageBase64, cropImageFile.name);
                    
                    if (!uploaded || !uploaded.url) {
                        throw new Error('이미지 업로드 응답에 URL이 없습니다.');
                    }
                    
                    // 함수형 업데이트 사용
                    setEditFormData(prevData => {
                        const currentImages = prevData.images || [];
                        const newImages = [...currentImages, uploaded.url];
                        
                        return {
                            ...prevData,
                            images: newImages,
                            img: newImages.length > 0 ? newImages[0] : ''
                        };
                    });
                    
                    // 렌더링 시간 확보 후 모달 닫기
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            setShowCropModal(false);
                            setCropImageFile(null);
                            setCropImageType(null);
                        });
                    });
                } catch (error) {
                    console.error('❌ 이미지 업로드 오류:', error);
                    alert(`이미지 업로드에 실패했습니다.\n${error.message || '알 수 없는 오류'}`);
                } finally {
                    setUploadingImage(false);
                }
            };
            
            const handleSaveAdd = async () => {
                // 필수 필드 검증
                if (!editFormData.title || !editFormData.title.trim()) {
                    alert('제목을 입력해주세요.');
                    return;
                }
                
                if (!editFormData.date || !editFormData.date.trim()) {
                    alert('날짜를 입력해주세요.');
                    return;
                }
                
                try {
                    // images 배열 처리 및 정규화
                    const imagesArray = editFormData.images && Array.isArray(editFormData.images)
                        ? editFormData.images.filter(img => img && img && typeof img === 'string' && img.trim() !== '')
                        : (editFormData.img && typeof editFormData.img === 'string' && editFormData.img.trim() !== '' ? [editFormData.img] : []);
                    
                    // desc와 description 통합 (desc 우선)
                    const saveData = {
                        ...editFormData,
                        images: imagesArray,
                        img: imagesArray.length > 0 ? imagesArray[0] : (editFormData.img || ''),
                        desc: editFormData.desc || editFormData.description || '',
                        description: editFormData.desc || editFormData.description || '',
                    };
                    
                    const newId = await window.firebaseService.createSeminar(saveData);
                    
                    const newSeminars = await window.firebaseService.getSeminars();
                    setSeminars(newSeminars);
                    setShowAddModal(false);
                    alert('추가되었습니다.');
                } catch (error) {
                    console.error('❌ 프로그램 추가 오류:', error);
                    console.error('에러 상세:', {
                        code: error.code,
                        message: error.message,
                        stack: error.stack,
                        editFormData: editFormData
                    });
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '추가 중 오류가 발생했습니다.';
                    alert(`추가에 실패했습니다.\n${errorMessage}\n\n콘솔을 확인해주세요.`);
                }
            };
            
            const handleDelete = async (seminar) => {
                if (!confirm(`정말 "${seminar.title}" 프로그램을 삭제하시겠습니까?`)) return;
                try {
                    await window.firebaseService.deleteSeminar(seminar.id);
                    setSeminars(seminars.filter(s => s.id !== seminar.id));
                    alert('삭제되었습니다.');
                                                            } catch (error) {
                    
                    const errorMessage = translateFirebaseError ? translateFirebaseError(error) : '삭제 중 오류가 발생했습니다.';
                    alert(`삭제에 실패했습니다.\n${errorMessage}`);
                }
            };
            
            return (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                    <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-bold text-dark">프로그램 관리</h3>
                        <button
                            onClick={handleAdd}
                            className="px-4 py-2 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors flex items-center gap-2"
                        >
                            <Icons.Plus size={20} />
                            추가
                                </button>
                    </div>
                    <div className="space-y-4">
                        {seminars.length === 0 ? (
                            <p className="text-center py-8 text-gray-400">프로그램이 없습니다.</p>
                        ) : (
                            seminars.map(seminar => (
                                <div key={seminar.id} className="border border-gray-200 rounded-xl p-4 hover:bg-gray-50">
                                    <div className="flex items-start justify-between">
                                        <div className="flex-1">
                                            <h4 className="font-bold text-dark mb-2">{seminar.title || '제목 없음'}</h4>
                                            <p className="text-sm text-gray-600 mb-2">{seminar.description || '설명 없음'}</p>
                                            <p className="text-sm text-gray-500">{seminar.date || '날짜 없음'} | {seminar.location || '장소 없음'}</p>
                                        </div>
                                        <div className="flex gap-2">
                                <button
                                                onClick={() => handleEdit(seminar)}
                                                className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                            >
                                                <Icons.Edit size={16} />
                                </button>
                                <button
                                                onClick={() => handleDelete(seminar)}
                                                className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                            >
                                                <Icons.Trash size={16} />
                                </button>
                            </div>
                        </div>
                                </div>
                            ))
                        )}
                                    </div>
                    
                    {/* 수정 모달 */}
                    {showEditModal && selectedSeminar && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4" onClick={() => setShowEditModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto modal-scroll" onClick={(e) => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-6">
                                    <h4 className="text-xl font-bold text-dark">프로그램 수정</h4>
                                    <button
                                        onClick={() => setShowEditModal(false)}
                                        className="p-2 hover:bg-gray-100 rounded-lg"
                                    >
                                        <Icons.X size={24} />
                                    </button>
                                </div>
                                <div className="space-y-6">
                                    {/* 기본 정보 */}
                                    <div className="border-b border-gray-200 pb-4">
                                        <h5 className="font-bold text-gray-700 mb-4">기본 정보</h5>
                                <div className="space-y-4">
                        <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">제목 *</label>
                                        <input
                                            type="text"
                                                    value={editFormData.title || ''}
                                            onChange={(e) => setEditFormData({...editFormData, title: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    placeholder="프로그램 제목"
                                />
                            </div>
                        <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                            <textarea 
                                                    value={editFormData.desc || editFormData.description || ''}
                                                    onChange={(e) => setEditFormData({...editFormData, desc: e.target.value, description: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    rows="4"
                                                    placeholder="프로그램 설명"
                            />
                            </div>
                                <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">이미지 (최대 5장)</label>
                                                <div className="space-y-3">
                                                    {/* 이미지 갤러리 */}
                                                    {(editFormData.images && editFormData.images.length > 0) ? (
                                                        <div className="grid grid-cols-1 gap-3">
                                                            {(editFormData.images || []).map((imgUrl, idx) => (
                                                                <div key={idx} className="relative group">
                                                                    <div className="w-full h-32 rounded-xl overflow-hidden border-2 border-gray-200 shadow-sm flex-shrink-0">
                                                                        <img src={getImageUrlWithTimestamp(imgUrl)} alt={`프로그램 이미지 ${idx + 1}`} className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                                    </div>
                                                                    <button
                                                                        type="button"
                                                                        onClick={() => {
                                                                            const newImages = (editFormData.images || []).filter((_, i) => i !== idx);
                                                                            setEditFormData({...editFormData, images: newImages, img: newImages.length > 0 ? newImages[0] : ''});
                                                                        }}
                                                                        className="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600"
                                                                    >
                                                                        <Icons.X size={16} />
                                                                    </button>
                                                                    <div className="absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded">
                                                                        {idx + 1}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    ) : null}
                                                    
                                                    {/* 이미지 업로드 버튼 (최대 5장) */}
                                                    {(!editFormData.images || editFormData.images.length < 5) ? (
                                                        <>
                                                            <label
                                                                htmlFor="edit-seminar-image-upload"
                                                                className="flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-brand hover:bg-brand/5 transition-colors"
                                                            >
                                                                <Icons.Camera size={32} className="text-gray-400 mb-2" />
                                                                <span className="text-sm font-bold text-gray-600">이미지 업로드</span>
                                                                <span className="text-xs text-gray-500 mt-1">
                                                                    클릭하여 이미지 선택 ({editFormData.images?.length || 0}/5)
                                                                </span>
                                                            </label>
                                                            <input
                                                                type="file"
                                                                accept="image/*"
                                                                id="edit-seminar-image-upload"
                                                                className="hidden"
                                                                onChange={(e) => {
                                                                    const file = e.target.files[0];
                                                                    if (!file) return;
                                                                    
                                                                    const currentImages = editFormData.images || [];
                                                                    if (currentImages.length >= 5) {
                                                                        alert('이미지는 최대 5장까지 업로드할 수 있습니다.');
                                                                        e.target.value = '';
                                                                        return;
                                                                    }
                                                                    
                                                                    if (file.size > 10 * 1024 * 1024) {
                                                                        alert('이미지 크기는 10MB 이하여야 합니다.');
                                                                        e.target.value = '';
                                                                        return;
                                                                    }
                                                                    
                                                                    // 크롭 모달 표시
                                                                    setCropImageFile(file);
                                                                    setCropImageType('edit');
                                                                    setShowCropModal(true);
                                                                    e.target.value = '';
                                                                }}
                                                            />
                                                        </>
                                                    ) : (
                                                        <div className="flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 rounded-xl bg-gray-50">
                                                            <Icons.CheckCircle size={32} className="text-green-500 mb-2" />
                                                            <span className="text-sm font-bold text-gray-600">이미지 업로드 완료</span>
                                                            <span className="text-xs text-gray-500 mt-1">
                                                                최대 5장까지 업로드 가능합니다 (5/5)
                                                            </span>
                                                        </div>
                                                    )}

                                                    {/* 이미지 URL 직접 입력 */}
                                                    <div>
                                                        <label className="block text-xs text-gray-500 mb-1">
                                                            또는 이미지 URL 직접 입력 <span className="text-brand font-bold">({editFormData.images?.length || 0}/5)</span>
                                                        </label>
                                                        <div className="flex gap-2">
                                                            <input
                                                                type="text"
                                                                id="edit-image-url-input"
                                                                className="flex-1 p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"
                                                                placeholder={(editFormData.images?.length || 0) >= 5 ? "최대 5장까지 업로드 가능합니다" : "https://..."}
                                                                disabled={(editFormData.images?.length || 0) >= 5}
                                                                onKeyPress={(e) => {
                                                                    if (e.key === 'Enter') {
                                                                        e.preventDefault();
                                                                        const currentImages = editFormData.images || [];
                                                                        if (currentImages.length >= 5) {
                                                                            alert('이미지는 최대 5장까지 업로드할 수 있습니다.');
                                                                            return;
                                                                        }
                                                                        const url = e.target.value.trim();
                                                                        if (url) {
                                                                            if (currentImages.includes(url)) {
                                                                                alert('이미 추가된 이미지입니다.');
                                                                                e.target.value = '';
                                                                                return;
                                                                            }
                                                                            const newImages = [...currentImages, url];
                                                                            setEditFormData({
                                                                                ...editFormData,
                                                                                images: newImages,
                                                                                img: newImages.length > 0 ? newImages[0] : ''
                                                                            });
                                                                            e.target.value = '';
                                                                        }
                                                                    }
                                                                }}
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={() => {
                                                                    const input = document.getElementById('edit-image-url-input');
                                                                    const url = input?.value.trim();
                                                                    if (url) {
                                                                        const currentImages = editFormData.images || [];
                                                                        if (currentImages.length >= 5) {
                                                                            alert('이미지는 최대 5장까지 업로드할 수 있습니다.');
                                                                            return;
                                                                        }
                                                                        if (currentImages.includes(url)) {
                                                                            alert('이미 추가된 이미지입니다.');
                                                                            return;
                                                                        }
                                                                        const newImages = [...currentImages, url];
                                                                        setEditFormData({
                                                                            ...editFormData,
                                                                            images: newImages,
                                                                            img: newImages.length > 0 ? newImages[0] : ''
                                                                        });
                                                                        if (input) input.value = '';
                                                                    }
                                                                }}
                                                                disabled={(editFormData.images?.length || 0) >= 5}
                                                                className="px-4 py-2 bg-brand text-white rounded-lg font-bold hover:bg-blue-700 transition-colors whitespace-nowrap disabled:bg-gray-300 disabled:cursor-not-allowed disabled:hover:bg-gray-300"
                                                            >
                                                                추가
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">카테고리</label>
                                                    <select
                                                        value={editFormData.category || ''}
                                                        onChange={(e) => setEditFormData({...editFormData, category: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    >
                                                        <option value="">선택 안함</option>
                                                        <option value="교육/세미나">교육/세미나</option>
                                                        <option value="네트워킹/모임">네트워킹/모임</option>
                                                        <option value="투자/IR">투자/IR</option>
                                                        <option value="멘토링/상담">멘토링/상담</option>
                                                        <option value="기타">기타</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">상태</label>
                                                    <select
                                                        value={editFormData.status || '모집중'}
                                                        onChange={(e) => setEditFormData({...editFormData, status: e.target.value})}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    >
                                                        <option value="모집중">모집중</option>
                                                        <option value="마감임박">마감임박</option>
                                                        <option value="종료">종료</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* 일정 및 장소 */}
                                    <div className="border-b border-gray-200 pb-4">
                                        <h5 className="font-bold text-gray-700 mb-4">일정 및 장소</h5>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">날짜 *</label>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="date"
                                                        value={editFormData.date ? (() => {
                                                            const match = editFormData.date.match(/(\d{4})[.-](\d{1,2})[.-](\d{1,2})/);
                                                            if (match) {
                                                                return `${match[1]}-${match[2].padStart(2, '0')}-${match[3].padStart(2, '0')}`;
                                                            }
                                                            return '';
                                                        })() : ''}
                                                        onChange={(e) => {
                                                            const dateValue = e.target.value;
                                                            if (dateValue) {
                                                                const [year, month, day] = dateValue.split('-');
                                                                setEditFormData({...editFormData, date: `${year}.${month}.${day}`});
                                                            } else {
                                                                setEditFormData({...editFormData, date: ''});
                                                            }
                                                        }}
                                                        className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={editFormData.date || ''}
                                                        onChange={(e) => setEditFormData({...editFormData, date: e.target.value})}
                                                        className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                        placeholder="또는 직접 입력 (예: 2024.01.15)"
                                                    />
                                                </div>
                                </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">장소</label>
                                        <div className="flex gap-2">
                                            <input 
                                                type="text"
                                                        value={editFormData.location || ''}
                                                onChange={(e) => setEditFormData({...editFormData, location: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                placeholder="장소를 검색하거나 직접 입력하세요"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => openKakaoPlacesSearch((place) => {
                                                    setEditFormData({
                                                        ...editFormData,
                                                        location: `${place.name} (${place.address})`
                                                    });
                                                })}
                                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors whitespace-nowrap"
                                            >
                                                장소 검색
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => setShowMapModal(true)}
                                                className="px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors whitespace-nowrap"
                                            >
                                                지도 선택
                                            </button>
                                        </div>
                </div>
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">신청 마감일</label>
                                                <input
                                                    type="text"
                                                    value={editFormData.deadline || ''}
                                                    onChange={(e) => setEditFormData({...editFormData, deadline: e.target.value})}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    placeholder="예: 2024.01.10"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* 참가 정보 */}
                                    <div className="border-b border-gray-200 pb-4">
                                        <h5 className="font-bold text-gray-700 mb-4">참가 정보</h5>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">최대 인원수</label>
                                                <input
                                                    type="number"
                                                    value={editFormData.maxParticipants || 0}
                                                    onChange={(e) => setEditFormData({...editFormData, maxParticipants: parseInt(e.target.value) || 0})}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    min="0"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">현재 인원수</label>
                                                <input
                                                    type="number"
                                                    value={editFormData.currentParticipants || 0}
                                                    onChange={(e) => setEditFormData({...editFormData, currentParticipants: parseInt(e.target.value) || 0})}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    min="0"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* 가격 정보 */}
                                    <div>
                                        <h5 className="font-bold text-gray-700 mb-4">가격 정보</h5>
                                        <div className="space-y-4">
                                            <div className="flex items-center gap-2">
                                                <input
                                                    type="checkbox"
                                                    checked={editFormData.requiresPayment || false}
                                                    onChange={(e) => setEditFormData({...editFormData, requiresPayment: e.target.checked})}
                                                    className="w-5 h-5"
                                                />
                                                <label className="text-sm font-bold text-gray-700">유료 프로그램</label>
                                            </div>
                                            {editFormData.requiresPayment && (
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">가격 (원)</label>
                                                    <input
                                                        type="number"
                                                        value={editFormData.price || 0}
                                                        onChange={(e) => setEditFormData({...editFormData, price: parseInt(e.target.value) || 0})}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                        min="0"
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* 저장 버튼 */}
                                    <div className="flex gap-4 pt-4">
                                    <button
                                            onClick={() => setShowEditModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                            >
                                            취소
                                    </button>
                                    <button
                                            onClick={handleSaveEdit}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                            >
                                저장
                                    </button>
                                </div>
                            </div>
                                </div>
                        </div>
                    )}
                    
                    {/* 크롭 모달 */}
                    {(showCropModal && cropImageFile) ? React.createElement(ImageCropModal, {
                        imageFile: cropImageFile,
                        onCropComplete: handleCropComplete,
                        onCancel: () => {
                            setShowCropModal(false);
                            setCropImageFile(null);
                            setCropImageType(null);
                        },
                        recommendedWidth: 1200,
                        recommendedHeight: 800,
                        aspectRatio: calculateAspectRatio(1200, 800)
                    }) : null}
                    
                    {/* 추가 모달 */}
                    {showAddModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4" onClick={() => setShowAddModal(false)}>
                            <div className="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto modal-scroll" onClick={(e) => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-6">
                                    <h4 className="text-xl font-bold text-dark">프로그램 추가</h4>
                                    <button
                                        onClick={() => setShowAddModal(false)}
                                        className="p-2 hover:bg-gray-100 rounded-lg"
                                    >
                                        <Icons.X size={24} />
                                    </button>
                                </div>
                                <div className="space-y-6">
                                    {/* 기본 정보 */}
                                    <div className="border-b border-gray-200 pb-4">
                                        <h5 className="font-bold text-gray-700 mb-4">기본 정보</h5>
                    <div className="space-y-4">
                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">제목 *</label>
                                    <input
                                type="text"
                                                    value={editFormData.title || ''}
                                            onChange={(e) => setEditFormData({...editFormData, title: e.target.value})}
                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    placeholder="프로그램 제목"
                            />
                                </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">설명</label>
                                        <textarea
                                                    value={editFormData.desc || editFormData.description || ''}
                                                    onChange={(e) => setEditFormData({...editFormData, desc: e.target.value, description: e.target.value})}
                                            className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    rows="4"
                                                    placeholder="프로그램 설명"
                                        />
                                    </div>
                                    <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">
                                                    이미지 (최대 5장)
                                                    <span className="text-xs text-gray-500 font-normal ml-2">
                                                        추천 해상도: 1200x800px (16:9)
                                                    </span>
                                                </label>
                                                <div className="space-y-3">
                                                    {/* 이미지 갤러리 */}
                                                    {(editFormData.images && editFormData.images.length > 0) ? (
                                                        <div className="grid grid-cols-1 gap-3">
                                                            {(editFormData.images || []).map((imgUrl, idx) => (
                                                                <div key={idx} className="relative group">
                                                                    <div className="w-full h-32 rounded-xl overflow-hidden border-2 border-gray-200 shadow-sm flex-shrink-0">
                                                                        <img src={getImageUrlWithTimestamp(imgUrl)} alt={`프로그램 이미지 ${idx + 1}`} className="w-full h-full object-cover" onError={(e) => { e.target.style.display = 'none'; e.target.parentElement.style.display = 'none'; }} />
                                                                    </div>
                                                                    <button
                                                                        type="button"
                                                                        onClick={() => {
                                                                            const newImages = (editFormData.images || []).filter((_, i) => i !== idx);
                                                                            setEditFormData({...editFormData, images: newImages, img: newImages.length > 0 ? newImages[0] : ''});
                                                                        }}
                                                                        className="absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600"
                                                                    >
                                                                        <Icons.X size={16} />
                                                                    </button>
                                                                    <div className="absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded">
                                                                        {idx + 1}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    ) : null}
                                                    
                                                    {/* 이미지 업로드 버튼 (최대 5장) */}
                                                    {(!editFormData.images || editFormData.images.length < 5) ? (
                                                        <>
                                                            <label
                                                                htmlFor="add-seminar-image-upload"
                                                                className="flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 rounded-xl cursor-pointer hover:border-brand hover:bg-brand/5 transition-colors"
                                                            >
                                                                <Icons.Camera size={32} className="text-gray-400 mb-2" />
                                                                <span className="text-sm font-bold text-gray-600">이미지 업로드</span>
                                                                <span className="text-xs text-gray-500 mt-1">
                                                                    클릭하여 이미지 선택 ({editFormData.images?.length || 0}/5)
                                                                </span>
                                                            </label>
                                                            <input
                                                                type="file"
                                                                accept="image/*"
                                                                id="add-seminar-image-upload"
                                                                className="hidden"
                                                                onChange={(e) => {
                                                                    const file = e.target.files[0];
                                                                    if (!file) return;
                                                                    
                                                                    const currentImages = editFormData.images || [];
                                                                    if (currentImages.length >= 5) {
                                                                        alert('이미지는 최대 5장까지 업로드할 수 있습니다.');
                                                                        e.target.value = '';
                                                                        return;
                                                                    }
                                                                    
                                                                    if (file.size > 10 * 1024 * 1024) {
                                                                        alert('이미지 크기는 10MB 이하여야 합니다.');
                                                                        e.target.value = '';
                                                                        return;
                                                                    }
                                                                    
                                                                    // 크롭 모달 표시
                                                                    setCropImageFile(file);
                                                                    setCropImageType('add');
                                                                    setShowCropModal(true);
                                                                    e.target.value = '';
                                                                }}
                                                            />
                                                        </>
                                                    ) : (
                                                        <div className="flex flex-col items-center justify-center p-6 border-2 border-dashed border-gray-300 rounded-xl bg-gray-50">
                                                            <Icons.CheckCircle size={32} className="text-green-500 mb-2" />
                                                            <span className="text-sm font-bold text-gray-600">이미지 업로드 완료</span>
                                                            <span className="text-xs text-gray-500 mt-1">
                                                                최대 5장까지 업로드 가능합니다 (5/5)
                                                            </span>
                                                        </div>
                                                    )}

                                                    {/* 이미지 URL 직접 입력 */}
                                                    <div>
                                                        <label className="block text-xs text-gray-500 mb-1">
                                                            또는 이미지 URL 직접 입력 <span className="text-brand font-bold">({editFormData.images?.length || 0}/5)</span>
                                                        </label>
                                                        <div className="flex gap-2">
                                                            <input
                                                                type="text"
                                                                id="add-image-url-input"
                                                                className="flex-1 p-2 border-2 border-gray-200 rounded-lg focus:border-brand focus:outline-none text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"
                                                                placeholder={(editFormData.images?.length || 0) >= 5 ? "최대 5장까지 업로드 가능합니다" : "https://..."}
                                                                disabled={(editFormData.images?.length || 0) >= 5}
                                                                onKeyPress={(e) => {
                                                                    if (e.key === 'Enter') {
                                                                        e.preventDefault();
                                                                        const currentImages = editFormData.images || [];
                                                                        if (currentImages.length >= 5) {
                                                                            alert('이미지는 최대 5장까지 업로드할 수 있습니다.');
                                                                            return;
                                                                        }
                                                                        const url = e.target.value.trim();
                                                                        if (url) {
                                                                            if (currentImages.includes(url)) {
                                                                                alert('이미 추가된 이미지입니다.');
                                                                                e.target.value = '';
                                                                                return;
                                                                            }
                                                                            const newImages = [...currentImages, url];
                                                                            setEditFormData({
                                                                                ...editFormData,
                                                                                images: newImages,
                                                                                img: newImages.length > 0 ? newImages[0] : ''
                                                                            });
                                                                            e.target.value = '';
                                                                        }
                                                                    }
                                                                }}
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={() => {
                                                                    const input = document.getElementById('add-image-url-input');
                                                                    const url = input?.value.trim();
                                                                    if (url) {
                                                                        const currentImages = editFormData.images || [];
                                                                        if (currentImages.length >= 5) {
                                                                            alert('이미지는 최대 5장까지 업로드할 수 있습니다.');
                                                                            return;
                                                                        }
                                                                        if (currentImages.includes(url)) {
                                                                            alert('이미 추가된 이미지입니다.');
                                                                            return;
                                                                        }
                                                                        const newImages = [...currentImages, url];
                                                                        setEditFormData({
                                                                            ...editFormData,
                                                                            images: newImages,
                                                                            img: newImages.length > 0 ? newImages[0] : ''
                                                                        });
                                                                        if (input) input.value = '';
                                                                    }
                                                                }}
                                                                disabled={(editFormData.images?.length || 0) >= 5}
                                                                className="px-4 py-2 bg-brand text-white rounded-lg font-bold hover:bg-blue-700 transition-colors whitespace-nowrap disabled:bg-gray-300 disabled:cursor-not-allowed disabled:hover:bg-gray-300"
                                                            >
                                                                추가
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">카테고리</label>
                                                    <select
                                                        value={editFormData.category || ''}
                                                        onChange={(e) => setEditFormData({...editFormData, category: e.target.value})}
                                className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    >
                                                        <option value="">선택 안함</option>
                                                        <option value="교육/세미나">교육/세미나</option>
                                                        <option value="네트워킹/모임">네트워킹/모임</option>
                                                        <option value="투자/IR">투자/IR</option>
                                                        <option value="멘토링/상담">멘토링/상담</option>
                                                        <option value="기타">기타</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">상태</label>
                                                    <select
                                                        value={editFormData.status || '모집중'}
                                                        onChange={(e) => setEditFormData({...editFormData, status: e.target.value})}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    >
                                                        <option value="모집중">모집중</option>
                                                        <option value="마감임박">마감임박</option>
                                                        <option value="종료">종료</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* 일정 및 장소 */}
                                    <div className="border-b border-gray-200 pb-4">
                                        <h5 className="font-bold text-gray-700 mb-4">일정 및 장소</h5>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">날짜 *</label>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="date"
                                                        value={editFormData.date ? (() => {
                                                            const match = editFormData.date.match(/(\d{4})[.-](\d{1,2})[.-](\d{1,2})/);
                                                            if (match) {
                                                                return `${match[1]}-${match[2].padStart(2, '0')}-${match[3].padStart(2, '0')}`;
                                                            }
                                                            return '';
                                                        })() : ''}
                                                        onChange={(e) => {
                                                            const dateValue = e.target.value;
                                                            if (dateValue) {
                                                                const [year, month, day] = dateValue.split('-');
                                                                setEditFormData({...editFormData, date: `${year}.${month}.${day}`});
                                                            } else {
                                                                setEditFormData({...editFormData, date: ''});
                                                            }
                                                        }}
                                                        className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={editFormData.date || ''}
                                                        onChange={(e) => setEditFormData({...editFormData, date: e.target.value})}
                                                        className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                        placeholder="또는 직접 입력 (예: 2024.01.15)"
                                                    />
                                                </div>
                                    </div>
                        <div>
                                        <label className="block text-sm font-bold text-gray-700 mb-2">장소</label>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                        value={editFormData.location || ''}
                                                onChange={(e) => setEditFormData({...editFormData, location: e.target.value})}
                                                className="flex-1 p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                placeholder="장소를 검색하거나 직접 입력하세요"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => openKakaoPlacesSearch((place) => {
                                                    setEditFormData({
                                                        ...editFormData,
                                                        location: `${place.name} (${place.address})`
                                                    });
                                                })}
                                                className="px-4 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors whitespace-nowrap"
                                            >
                                                장소 검색
                                            </button>
                                            <button
                                                type="button"
                                                onClick={() => setShowMapModal(true)}
                                                className="px-4 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors whitespace-nowrap"
                                            >
                                                지도 선택
                                            </button>
                                        </div>
                            </div>
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">신청 마감일</label>
                                                <input
                                                    type="text"
                                                    value={editFormData.deadline || ''}
                                                    onChange={(e) => setEditFormData({...editFormData, deadline: e.target.value})}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    placeholder="예: 2024.01.10"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* 참가 정보 */}
                                    <div className="border-b border-gray-200 pb-4">
                                        <h5 className="font-bold text-gray-700 mb-4">참가 정보</h5>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">최대 인원수</label>
                                                <input
                                                    type="number"
                                                    value={editFormData.maxParticipants || 0}
                                                    onChange={(e) => setEditFormData({...editFormData, maxParticipants: parseInt(e.target.value) || 0})}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    min="0"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-bold text-gray-700 mb-2">현재 인원수</label>
                                                <input
                                                    type="number"
                                                    value={editFormData.currentParticipants || 0}
                                                    onChange={(e) => setEditFormData({...editFormData, currentParticipants: parseInt(e.target.value) || 0})}
                                                    className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                    min="0"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* 가격 정보 */}
                                    <div>
                                        <h5 className="font-bold text-gray-700 mb-4">가격 정보</h5>
                                        <div className="space-y-4">
                                            <div className="flex items-center gap-2">
                                                <input
                                                    type="checkbox"
                                                    checked={editFormData.requiresPayment || false}
                                                    onChange={(e) => setEditFormData({...editFormData, requiresPayment: e.target.checked})}
                                                    className="w-5 h-5"
                                                />
                                                <label className="text-sm font-bold text-gray-700">유료 프로그램</label>
                                            </div>
                                            {editFormData.requiresPayment && (
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2">가격 (원)</label>
                                                    <input
                                                        type="number"
                                                        value={editFormData.price || 0}
                                                        onChange={(e) => setEditFormData({...editFormData, price: parseInt(e.target.value) || 0})}
                                                        className="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none"
                                                        min="0"
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* 저장 버튼 */}
                                    <div className="flex gap-4 pt-4">
                                <button
                                            onClick={() => setShowAddModal(false)}
                                            className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition-colors"
                        >
                                            취소
                                    </button>
                                    <button
                                            onClick={handleSaveAdd}
                                            className="flex-1 py-3 bg-brand text-white rounded-xl font-bold hover:bg-blue-700 transition-colors"
                                        >
                                            추가
                                        </button>
                            </div>
                            </div>
                                </div>
                        </div>
                    )}
                    
                    {/* 크롭 모달 (추가 모달용) */}
                    {(showCropModal && cropImageFile && cropImageType === 'add') ? React.createElement(ImageCropModal, {
                        imageFile: cropImageFile,
                        onCropComplete: handleCropComplete,
                        onCancel: () => {
                            setShowCropModal(false);
                            setCropImageFile(null);
                            setCropImageType(null);
                        },
                        recommendedWidth: 1200,
                        recommendedHeight: 800,
                        aspectRatio: calculateAspectRatio(1200, 800)
                    }) : null}
                    
                    {/* 지도 선택 모달 */}
                    {showMapModal && (
                        <KakaoMapModal
                            onClose={() => setShowMapModal(false)}
                            onSelectLocation={(location) => {
                                setEditFormData({
                                    ...editFormData,
                                    location: location.address || `${location.name || ''} (${location.address || ''})`.trim()
                                });
                                setShowMapModal(false);
                            }}
                            initialLocation={editFormData.location ? null : null}
                        />
                    )}
                </div>
            );
        };

        // ==========================================
        // 관리자 대시보드 컴포넌트
        // ==========================================
        const AdminDashboard = () => {
            try {
            // 인증 상태
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isChecking, setIsChecking] = useState(false);
            const [pinCode, setPinCode] = useState('');
            const [authError, setAuthError] = useState(null);
            
            // 활성 메뉴 (사이드바)
            const [activeMenu, setActiveMenu] = useState('dashboard');
            
            // Firebase 초기화 상태
            const [firebaseReady, setFirebaseReady] = useState(false);
            
            // Firebase 데이터 상태
            const [users, setUsers] = useState([]);
            const [seminars, setSeminars] = useState([]);
            const [posts, setPosts] = useState([]);
            const [settings, setSettings] = useState({});
            const [loading, setLoading] = useState(false);
            
            // 기존 데이터 상태 (호환성 유지 - Firebase에서 로드됨)
            const [members, setMembers] = useState([]);
            const [content, setContent] = useState({});
            const [menuEnabled, setMenuEnabled] = useState({
                '홈': true,
                '소개': true,
                '프로그램': true,
                '부청사 회원': true,
                '커뮤니티': true,
                '입찰공고': true,
                '후원': true,
                '부산맛집': true,
            });
            const [menuNames, setMenuNames] = useState({
                '홈': '홈',
                '소개': '소개',
                '프로그램': '프로그램',
                '부청사 회원': '부청사 회원',
                '커뮤니티': '커뮤니티',
                '입찰공고': '입찰공고',
                '후원': '후원',
                '부산맛집': '부산맛집',
            });
            const [restaurants, setRestaurants] = useState([]);
            
            
            // 관리자 인증 체크 (초기 로드 시 - sessionStorage 확인)
            useEffect(() => {
                const isAuth = sessionStorage.getItem('admin_authenticated') === 'true';
                setIsAuthenticated(isAuth);
            }, []);
            
            // Firebase 초기화 대기
            useEffect(() => {
                const handleFirebaseInitialized = () => {
                    setFirebaseReady(true);
                };
                
                const handleFirebaseInitFailed = (event) => {
                    console.error('Firebase 초기화 실패:', event.detail);
                    // Firebase가 초기화되지 않아도 계속 진행 (데이터 로드는 나중에 시도)
                };
                
                // 이미 초기화된 경우
                if (window.firebaseServices && window.firebaseServices.db) {
                    setFirebaseReady(true);
                            } else {
                    // 이벤트 리스너 등록
                    window.addEventListener('firebaseInitialized', handleFirebaseInitialized);
                    window.addEventListener('firebaseInitFailed', handleFirebaseInitFailed);
                    
                    // Firebase 초기화 대기
                    waitForFirebase().then((isReady) => {
                        if (isReady) {
                            setFirebaseReady(true);
                        }
                    });
                }
                
                return () => {
                    window.removeEventListener('firebaseInitialized', handleFirebaseInitialized);
                    window.removeEventListener('firebaseInitFailed', handleFirebaseInitFailed);
                };
            }, []);
            
            // Firebase 초기화 대기 함수
            const waitForFirebase = () => {
                return new Promise((resolve) => {
                    let attempts = 0;
                    const maxAttempts = 100; // 최대 10초 대기 (100ms * 100)
                    
                    const checkInterval = setInterval(() => {
                        attempts++;
                        if (window.firebaseServices && window.firebaseService && window.firebaseServices.db) {
                            clearInterval(checkInterval);
                            resolve(true);
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkInterval);
                            resolve(false);
                        }
                    }, 100);
                });
            };
            
            // Firebase 데이터 로드
            useEffect(() => {
                if (!isAuthenticated || !firebaseReady) return;
                
                const loadFirebaseData = async () => {
                    setLoading(true);
                    
                    // Firebase 서비스 확인 (이미 firebaseReady가 true이므로 추가 확인만)
                    if (!window.firebaseServices || !window.firebaseService || !window.firebaseServices.db) {
                        alert('Firebase 서비스가 초기화되지 않았습니다. 페이지를 새로고침해주세요.');
                        setLoading(false);
                        return;
                    }
                    
                    let retryCount = 0;
                    const maxRetries = 3;
                    
                    const attemptLoad = async () => {
                        try {
                            if (window.firebaseService && window.firebaseService.getUsers) {
                                const usersData = await window.firebaseService.getUsers();
                                setUsers(usersData || []);
                                setMembers(usersData || []);
                            }
                            
                            if (window.firebaseService && window.firebaseService.getSeminars) {
                                const seminarsData = await window.firebaseService.getSeminars();
                                setSeminars(seminarsData || []);
                            }
                            
                            if (window.firebaseService && window.firebaseService.getPosts) {
                                const postsData = await window.firebaseService.getPosts();
                                setPosts(postsData || []);
                            }
                            
                            if (window.firebaseService && window.firebaseService.getSettings) {
                                const settingsData = await window.firebaseService.getSettings();
                                setSettings(settingsData || {});
                                
                                // Firebase Settings에서 menuEnabled와 menuNames 로드
                                if (settingsData && settingsData.menuEnabled) {
                                    setMenuEnabled(prev => ({ ...prev, ...settingsData.menuEnabled }));
                                }
                                if (settingsData && settingsData.menuNames) {
                                    setMenuNames(prev => ({ ...prev, ...settingsData.menuNames }));
                                }
                            }
                            
                            if (window.firebaseService && window.firebaseService.getRestaurants) {
                                const restaurantsData = await window.firebaseService.getRestaurants();
                                setRestaurants(restaurantsData || []);
                            }
                            
                            // 로컬스토리지에서 menuEnabled 로드 (Firebase에 없을 경우 폴백)
                            if (typeof Storage !== 'undefined' && typeof localStorage !== 'undefined') {
                                try {
                                    // Firebase Settings 확인
                                    let firebaseSettings = null;
                                    if (window.firebaseService && window.firebaseService.getSettings) {
                                        try {
                                            firebaseSettings = await window.firebaseService.getSettings();
                                        } catch (e) {
                                            // Firebase 로드 실패 시 무시
                                        }
                                    }
                                    
                                    const stored = localStorage.getItem('busan_ycc_menu_enabled');
                                    if (stored) {
                                        const parsed = JSON.parse(stored);
                                        setMenuEnabled(prev => {
                                            // Firebase에 없으면 localStorage 사용
                                            if (!firebaseSettings || !firebaseSettings.menuEnabled) {
                                                return { ...prev, ...parsed };
                                            }
                                            return prev;
                                        });
                                    }
                                    // menuNames 로드 (Firebase에 없을 경우 폴백)
                                    const storedNames = localStorage.getItem('busan_ycc_menu_names');
                                    if (storedNames) {
                                        const parsedNames = JSON.parse(storedNames);
                                        setMenuNames(prev => {
                                            // Firebase에 없으면 localStorage 사용
                                            if (!firebaseSettings || !firebaseSettings.menuNames) {
                                                return { ...prev, ...parsedNames };
                                            }
                                            return prev;
                                        });
                                    }
                                } catch (error) {
                                    console.error('메뉴 설정 로드 실패:', error);
                                }
                            }
                        } catch (error) {
                            retryCount++;
                            
                            if (retryCount < maxRetries) {
                                setTimeout(attemptLoad, 1000 * retryCount); // 지수 백오프
                            } else {
                                alert('데이터를 불러오는 중 오류가 발생했습니다: ' + (error.message || error) + '\n\n브라우저 콘솔을 확인해주세요.');
                                setLoading(false);
                            }
                            return;
                        }
                        
                        setLoading(false);
                    };
                    
                    attemptLoad();
                };
                
                loadFirebaseData();
            }, [isAuthenticated, firebaseReady]);
            
            // 실시간 업데이트 구독
            useEffect(() => {
                if (!isAuthenticated || !firebaseReady) return;
                
                const setupSubscriptions = async () => {
                    // Firebase 초기화 대기
                    const isInitialized = await waitForFirebase();
                    if (!isInitialized) {
                        return;
                    }
                    
                    let unsubscribeUsers = null;
                    let unsubscribeSeminars = null;
                    let unsubscribePosts = null;
                    
                    try {
                        if (window.firebaseService && window.firebaseService.subscribeUsers) {
                            unsubscribeUsers = window.firebaseService.subscribeUsers((users) => {
                                setUsers(users || []);
                                setMembers(users || []);
                            });
                        }
                        
                        if (window.firebaseService && window.firebaseService.subscribeSeminars) {
                            unsubscribeSeminars = window.firebaseService.subscribeSeminars((seminars) => {
                                setSeminars(seminars || []);
                            });
                        }
                        
                        if (window.firebaseService && window.firebaseService.subscribePosts) {
                            unsubscribePosts = window.firebaseService.subscribePosts((posts) => {
                                setPosts(posts || []);
                            });
                        }
                        
                        let unsubscribeRestaurants = null;
                        if (window.firebaseService && window.firebaseService.subscribeRestaurants) {
                            unsubscribeRestaurants = window.firebaseService.subscribeRestaurants((restaurants) => {
                                setRestaurants(restaurants || []);
                            });
                        }
                        
                        // Settings 실시간 구독 (menuNames, menuEnabled 포함)
                        let unsubscribeSettings = null;
                        if (window.firebaseService && window.firebaseService.subscribeSettings) {
                            unsubscribeSettings = window.firebaseService.subscribeSettings((settingsData) => {
                                if (settingsData) {
                                    setSettings(settingsData);
                                    
                                    // menuEnabled와 menuNames도 실시간 업데이트
                                    if (settingsData.menuEnabled) {
                                        setMenuEnabled(prev => ({ ...prev, ...settingsData.menuEnabled }));
                                    }
                                    if (settingsData.menuNames) {
                                        setMenuNames(prev => ({ ...prev, ...settingsData.menuNames }));
                                    }
                                }
                            });
                        }
                    } catch (error) {
                    }
                    
                    return () => {
                        if (unsubscribeUsers) unsubscribeUsers();
                        if (unsubscribeSeminars) unsubscribeSeminars();
                        if (unsubscribePosts) unsubscribePosts();
                        if (unsubscribeRestaurants) unsubscribeRestaurants();
                        if (unsubscribeSettings) unsubscribeSettings();
                    };
                };
                
                const cleanup = setupSubscriptions();
                
                return () => {
                    if (cleanup && typeof cleanup.then === 'function') {
                        cleanup.then(cleanupFn => {
                            if (cleanupFn) cleanupFn();
                        });
                    } else if (cleanup) {
                        cleanup();
                    }
                };
            }, [isAuthenticated]);
            
            // ==========================================
            // CSV 자동 백업 함수
            // ==========================================
            
            /**
             * 데이터를 CSV 형식으로 변환하여 Google Sheets에 백업
             * @param {Array} data - 백업할 데이터 배열
             * @param {string} type - 데이터 타입 ('members', 'seminars', 'posts')
             */
            const backupToCSV = async (data, type) => {
                try {
                    if (!data || !Array.isArray(data) || data.length === 0) {
                        return;
                    }
                
                    // CSV 변환
                    const csvContent = convertToCSV(data);
                    
                    if (!csvContent) {
                        
                        addLog('ERROR', type, `CSV 변환 실패: ${type}`, currentUser?.name);
                        return;
                    }
                    
                    // Google Apps Script API를 통한 백업 시도
                    if (typeof CONFIG !== 'undefined' && CONFIG.GOOGLE_APPS_SCRIPT?.WEB_APP_URL) {
                        try {
                            // Google Apps Script 웹앱에 CSV 데이터 전송
                            const response = await fetch(CONFIG.GOOGLE_APPS_SCRIPT.WEB_APP_URL, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    action: 'backupCSV',
                                    type: type,
                                    csvContent: csvContent,
                                    data: data
                                })
                            });
                            
                            if (response.ok) {
                                const result = await response.json();
                                if (result.success) {
                                    addLog('BACKUP', type, `${type} 데이터 CSV 백업 완료 (${data.length}개)`, currentUser?.name);
                                } else {
                                    throw new Error(result.error || '백업 실패');
                                }
                            } else {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                        } catch (error) {
                            
                            addLog('ERROR', type, `CSV 백업 실패: ${error.message}`, currentUser?.name);
                            // Google Apps Script 실패 시 CSV 다운로드 링크 생성 (수동 백업)
                            // downloadCSVFile(csvContent, type); // 주석 처리: 자동 다운로드는 사용자 경험을 해칠 수 있음
                        }
                    } else {
                        // Google Apps Script URL이 없으면 로그만 기록
                        addLog('INFO', type, `CSV 백업 준비 완료 (Google Apps Script URL 미설정)`, currentUser?.name);
                    }
                } catch (error) {
                    
                    addLog('ERROR', type, `CSV 백업 중 오류 발생: ${error.message}`, currentUser?.name);
                }
            };
            
            /**
             * CSV 파일 다운로드 (수동 백업용)
             * @param {string} csvContent - CSV 문자열
             * @param {string} type - 파일 타입
             */
            const downloadCSVFile = (csvContent, type) => {
                try {
                    const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' }); // BOM 추가 (한글 깨짐 방지)
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `backup_${type}_${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                } catch (error) {
                    
                }
            };
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            // CSV 백업은 필요시에만 사용 (현재는 사용하지 않음)
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            // 테스트 데이터 필터링은 필요시에만 사용 (현재는 사용하지 않음)
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            
            // 데이터는 Firebase에서 실시간으로 관리되므로 localStorage 저장 불필요
            
            // 로그 추가 함수
            const addLog = (action, targetType, details, adminName, itemInfo) => {
                const newLog = {
                    timestamp: new Date().toLocaleString('ko-KR'),
                    action,
                    targetType,
                    details,
                    adminName: adminName || '관리자',
                    itemInfo: itemInfo || '',
                };
                setLogs(prev => [...prev, newLog]);
            };
            
            // 데이터 초기화 함수
            const handleResetAllData = async () => {
                // 확인 다이얼로그
                const confirmMessage = '⚠️ 경고: 모든 데이터가 삭제됩니다.\n\n' +
                    '다음 데이터가 삭제됩니다:\n' +
                    '- 모든 사용자 (햇반 계정 제외)\n' +
                    '- 모든 프로그램\n' +
                    '- 모든 게시글\n' +
                    '- 모든 신청\n' +
                    '- 모든 설정 (기본값으로 초기화)\n\n' +
                    '이 작업은 되돌릴 수 없습니다. 정말 진행하시겠습니까?';
                
                if (!confirm(confirmMessage)) {
                    return;
                }
                
                // 최종 확인
                if (!confirm('정말로 모든 데이터를 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다!')) {
                                                                    return;
                                                                }
                
                setLoading(true);
                try {
                    const adminEmail = 'haetban@bcsa-b190f.firebaseapp.com';
                    
                    // 1. 사용자 삭제 (햇반 계정 제외)
                    const deletedUsers = await window.firebaseService.deleteAllUsers(adminEmail);
                    
                    // 2. 프로그램 삭제
                    const deletedSeminars = await window.firebaseService.deleteAllSeminars();
                    
                    // 3. 게시글 삭제
                    const deletedPosts = await window.firebaseService.deleteAllPosts();
                    
                    // 4. 신청 삭제
                    const deletedApplications = await window.firebaseService.deleteAllApplications();
                    
                    // 5. Settings 초기화
                    await window.firebaseService.resetSettings(defaultContent);
                    
                    // 상태 업데이트
                    setUsers([]);
                    setSeminars([]);
                    setPosts([]);
                    setSettings(defaultContent);
                    
                    alert(`✅ 데이터 초기화가 완료되었습니다.\n\n` +
                        `삭제된 데이터:\n` +
                        `- 사용자: ${deletedUsers}명\n` +
                        `- 프로그램: ${deletedSeminars}개\n` +
                        `- 게시글: ${deletedPosts}개\n` +
                        `- 신청: ${deletedApplications}개\n` +
                        `- 설정: 초기화됨`);
                    
                    // 페이지 새로고침
                    window.location.reload();
                                                            } catch (error) {
                    
                    alert(`데이터 초기화 중 오류가 발생했습니다.\n${error.message}`);
                                                            } finally {
                    setLoading(false);
                }
            };
            
            // 로그인 핸들러 (PIN 검증)
            const handleLogin = (pin) => {
                    setIsChecking(true);
                    setAuthError(null);
                    
                const ADMIN_PIN = '0219';
                
                if (pin === ADMIN_PIN) {
                    // PIN이 맞으면 sessionStorage에 인증 상태 저장
                    sessionStorage.setItem('admin_authenticated', 'true');
                        setIsAuthenticated(true);
                        setAuthError(null);
                    } else {
                        setIsAuthenticated(false);
                    setAuthError('PIN 번호가 올바르지 않습니다.');
                }
                
                    setIsChecking(false);
            };
            
            const handleLogout = () => {
                sessionStorage.removeItem('admin_authenticated');
                setIsAuthenticated(false);
                setPinCode('');
                setAuthError(null);
            };
            
            // 로그인 폼 제출 핸들러
            const handleLoginSubmit = (e) => {
                e.preventDefault();
                handleLogin(pinCode);
            };
            
            // PIN 입력 핸들러 (숫자만 입력 가능, 최대 4자리)
            const handlePinChange = (e) => {
                const value = e.target.value.replace(/\D/g, ''); // 숫자만 허용
                if (value.length <= 4) {
                    setPinCode(value);
                    setAuthError(null);
                }
            };
            
            // 인증 실패 - 로그인 화면
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-soft flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-lg p-8 max-w-md w-full">
                            <div className="text-center mb-6">
                                <Icons.Lock className="w-16 h-16 text-brand mx-auto mb-4" />
                                <h2 className="text-2xl font-bold text-dark mb-2">관리자 로그인</h2>
                                <p className="text-gray-600">관리자 계정으로 로그인해주세요</p>
                            </div>
                            
                            <form onSubmit={handleLoginSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">PIN 번호</label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        pattern="[0-9]*"
                                        value={pinCode}
                                        onChange={handlePinChange}
                                        placeholder="4자리 숫자를 입력하세요"
                                        className="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-brand focus:outline-none text-center text-2xl tracking-widest"
                                        maxLength="4"
                                        required
                                        autoFocus
                                    />
                                </div>
                                
                                {authError && (
                                    <p className="text-sm text-red-600 text-center">{authError}</p>
                                )}
                                
                                <button
                                    type="submit"
                                    disabled={isChecking || pinCode.length !== 4}
                                    className={`w-full py-3 rounded-xl font-bold transition-colors ${
                                        isChecking || pinCode.length !== 4
                                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                            : 'bg-brand text-white hover:bg-blue-700'
                                    }`}
                                >
                                    {isChecking ? '확인 중...' : '로그인'}
                                </button>
                            </form>
                            
                            <button
                                onClick={() => window.location.href = 'index.html'}
                                className="w-full mt-4 py-3 border-2 border-gray-200 text-gray-600 rounded-xl font-bold hover:bg-gray-50 transition-colors"
                            >
                                메인 페이지로 이동
                            </button>
                        </div>
                    </div>
                );
            }
            
            // 메뉴 표시/비표시 토글 함수
            const toggleMenuEnabled = (menuKey) => {
                const newMenuEnabled = { ...menuEnabled, [menuKey]: !menuEnabled[menuKey] };
                setMenuEnabled(newMenuEnabled);
                // 로컬스토리지에 저장
                try {
                    localStorage.setItem('busan_ycc_menu_enabled', JSON.stringify(newMenuEnabled));
                } catch (error) {
                    console.error('메뉴 설정 저장 실패:', error);
                }
            };
            
            // 메뉴 항목 정의
            const menuItems = [
                { id: 'dashboard', label: '대시보드 홈', icon: Icons.List },
                { id: 'main', label: '메인 관리', icon: Icons.Settings },
                { id: 'users', label: '회원 관리', icon: Icons.Users },
                { id: 'posts', label: '게시글 관리', icon: Icons.MessageSquare },
                { id: 'programs', label: '프로그램 관리', icon: Icons.Calendar },
                { id: 'restaurants', label: '맛집 관리', icon: Icons.MapPin },
            ];

            return (
                <div className="min-h-screen bg-soft flex">
                    {/* 사이드바 */}
                    <div className="w-64 bg-white border-r border-gray-200 fixed h-screen overflow-y-auto">
                        <div className="p-6 border-b border-gray-200">
                            <h1 className="text-xl font-bold text-dark mb-1">관리자 대시보드</h1>
                            <p className="text-xs text-gray-500">부산청년사업가</p>
                                                    </div>
                        <nav className="p-4">
                            {menuItems.map(item => (
                                                            <button
                                    key={item.id}
                                    onClick={() => setActiveMenu(item.id)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-colors mb-2 ${
                                        activeMenu === item.id
                                            ? 'bg-brand text-white'
                                            : 'text-gray-700 hover:bg-gray-100'
                                    }`}
                                >
                                    {React.createElement(item.icon, { size: 20 })}
                                    {item.label}
                                </button>
                            ))}
                        </nav>
                                            </div>
                        
                    {/* 메인 콘텐츠 영역 */}
                    <div className="flex-1 ml-64">
                        {/* 헤더 */}
                        <div className="bg-white border-b border-gray-200 sticky top-0 z-50">
                            <div className="px-6 py-4 flex items-center justify-between">
                                <h2 className="text-xl font-bold text-dark">
                                    {menuItems.find(m => m.id === activeMenu)?.label || '대시보드'}
                                </h2>
                                <div className="flex items-center gap-4">
                                    <button 
                                        onClick={handleResetAllData}
                                        className="px-4 py-2 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 transition-colors"
                                        title="모든 데이터 초기화"
                            >
                                        데이터 초기화
                                    </button>
                                    <button
                                        onClick={handleLogout}
                                        className="px-4 py-2 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition-colors"
                            >
                                        로그아웃
                                    </button>
                                <button
                                        onClick={() => window.location.href = 'index.html'}
                                        className="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-bold text-gray-700 transition-colors"
                        >
                                        메인으로
                                                </button>
                                            </div>
                                    </div>
                                </div>
                    
                    {/* 콘텐츠 영역 */}
                        <div className="p-6">
                            {loading ? (
                                <div className="text-center py-12">
                                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-brand mx-auto mb-4"></div>
                                    <p className="text-gray-600">데이터를 불러오는 중...</p>
                                </div>
                            ) : null}
                            {!loading && activeMenu === 'dashboard' && typeof DashboardHome !== 'undefined' ? React.createElement(DashboardHome, {
                                users: users || [],
                                posts: posts || [],
                                seminars: seminars || [],
                                menuEnabled: menuEnabled,
                                setMenuEnabled: setMenuEnabled,
                                menuNames: menuNames,
                                setMenuNames: setMenuNames,
                                settings: settings || {}
                            }) : null}
                            {!loading && activeMenu === 'main' && typeof MainContentManagement !== 'undefined' ? React.createElement(MainContentManagement, {
                                settings: settings || {},
                                setSettings: setSettings,
                                menuEnabled: menuEnabled,
                                setMenuEnabled: setMenuEnabled,
                                menuNames: menuNames,
                                setMenuNames: setMenuNames
                            }) : null}
                            {!loading && activeMenu === 'users' && typeof UserManagement !== 'undefined' ? React.createElement(UserManagement, {
                                users: users || [],
                                setUsers: setUsers
                            }) : null}
                            {!loading && activeMenu === 'posts' && typeof PostManagement !== 'undefined' ? React.createElement(PostManagement, {
                                posts: posts || [],
                                setPosts: setPosts
                            }) : null}
                            {!loading && activeMenu === 'programs' && typeof ProgramManagement !== 'undefined' ? React.createElement(ProgramManagement, {
                                seminars: seminars || [],
                                setSeminars: setSeminars
                            }) : null}
                            {!loading && activeMenu === 'restaurants' && typeof RestaurantManagement !== 'undefined' ? React.createElement(RestaurantManagement, {
                                restaurants: restaurants || [],
                                setRestaurants: setRestaurants
                            }) : null}
                        </div>
                    </div>
                </div>
            );
            } catch (error) {
                console.error('AdminDashboard 렌더링 오류:', error);
                return React.createElement('div', { className: 'min-h-screen bg-soft flex items-center justify-center p-4' },
                    React.createElement('div', { className: 'bg-white rounded-3xl shadow-lg p-8 max-w-md w-full' },
                        React.createElement('div', { className: 'text-center' },
                            React.createElement('p', { className: 'text-red-500 mb-4' }, '대시보드 로드 중 오류가 발생했습니다.'),
                            React.createElement('p', { className: 'text-sm text-gray-600 mb-4' }, error.message || '알 수 없는 오류'),
                            React.createElement('button', {
                                onClick: () => window.location.reload(),
                                className: 'px-4 py-2 bg-brand text-white rounded-lg font-bold hover:bg-blue-700 transition-colors'
                            }, '페이지 새로고침')
                        )
                    )
                );
            }
        };

        // 기존 탭 컴포넌트들 (호환성 유지)
        const MembersTab = ({ members, setMembers, addLog, currentUser }) => {
            if (typeof UserManagement === 'undefined') {
                return React.createElement('div', { className: 'p-4' }, 'UserManagement 컴포넌트를 찾을 수 없습니다.');
            }
            return <UserManagement users={members} setUsers={setMembers} />;
        };
        
        const SeminarsTab = ({ seminars, setSeminars, addLog, currentUser }) => {
            if (typeof ProgramManagement === 'undefined') {
                return React.createElement('div', { className: 'p-4' }, 'ProgramManagement 컴포넌트를 찾을 수 없습니다.');
            }
            return <ProgramManagement seminars={seminars} setSeminars={setSeminars} />;
        };
        
        const CommunityTab = ({ posts, setPosts, addLog, currentUser }) => {
            if (typeof PostManagement === 'undefined') {
                return React.createElement('div', { className: 'p-4' }, 'PostManagement 컴포넌트를 찾을 수 없습니다.');
            }
            return <PostManagement posts={posts} setPosts={setPosts} />;
        };
        
        // 기존 코드 유지 (호환성)
        const MasterTab = ({ addLog, currentUser }) => {
            return (
                                        <div>
                    <p>마스터 탭 (기존 코드 유지)</p>
                </div>
            );
        };

        const InquiriesTab = ({ addLog, currentUser }) => {
            return (
                <div>
                    <p>문의하기 탭 (기존 코드 유지)</p>
                </div>
            );
        };
        
        // 기존 코드의 불완전한 부분 제거됨 (새로운 레이아웃으로 대체)
        // 마스터 로그인 모달은 새로운 레이아웃에서 사용하지 않으므로 제거됨

        // ==========================================
        // App 컴포넌트
        // ==========================================
        const App = () => {
            try {
                if (typeof AdminDashboard === 'undefined') {
                    console.error('AdminDashboard 컴포넌트가 정의되지 않았습니다.');
                    return React.createElement('div', { className: 'p-6' }, 
                        React.createElement('p', { className: 'text-red-500' }, 'AdminDashboard 컴포넌트를 찾을 수 없습니다.')
                    );
                }
                return React.createElement(AdminDashboard);
            } catch (error) {
                console.error('App 컴포넌트 렌더링 오류:', error);
                return React.createElement('div', { className: 'p-6' }, 
                    React.createElement('p', { className: 'text-red-500' }, '애플리케이션 로드 중 오류가 발생했습니다: ' + error.message)
                );
            }
        };

        // 렌더링
        const rootElement = document.getElementById('root');
        if (!rootElement) {
            console.error('Root element not found');
            return;
        }
        
        try {
            const root = ReactDOM.createRoot(rootElement);
            root.render(React.createElement(App));
        } catch (error) {
            console.error('React 렌더링 오류:', error);
        }
        })(); // IIFE 종료 - 스코프 격리
    </script>
</body>
</html>
