<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="부산 지역 청년 사업가들이 모여 아이디어를 공유하고, 네트워킹하며 함께 성장해나가는 커뮤니티">
    <title>부산청년사업가들 - Busan Young CEO Community</title>
    
    <!-- SVG 파비콘 (라이트/다크 모드 자동 지원) -->
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg" id="favicon-svg">
    <!-- 폴백용 PNG 파비콘 (SVG를 지원하지 않는 브라우저용) -->
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png" id="favicon-32">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png" id="favicon-16">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon.png">
    
    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- 외부 라이브러리 (CDN - window 전역 객체 필요) -->
    <script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    
    <!-- Firebase SDK (compat 버전 - window 전역 객체) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase 초기화 및 헬퍼 함수들 (window 전역 객체로 노출) -->
    <script>
        // Firebase 초기화
        const firebaseConfig = {
            apiKey: "AIzaSyD42iMqX0UvEoIlwB2GFMlNy4MzYPzfA3A",
            authDomain: "busan-ycc-website.firebaseapp.com",
            projectId: "busan-ycc-website",
            storageBucket: "busan-ycc-website.firebasestorage.app",
            messagingSenderId: "619883969668",
            appId: "1:619883969668:web:45e0e3dcd9db1dbb88ab1c"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const firebaseAuth = firebase.auth();
        const firebaseDb = firebase.firestore();
        window.firebaseAuth = firebaseAuth;
        window.firebaseDb = firebaseDb;

        // PortOne 초기화
        const PORTONE_IMP_CODE = 'imp00000000'; // TODO: 실제 가맹점 식별코드로 변경
        if (window.IMP) {
            window.IMP.init(PORTONE_IMP_CODE);
        }
        window.PORTONE_IMP_CODE = PORTONE_IMP_CODE;

        // ImgBB API 키
        const IMGBB_API_KEY = '4c975214037cdf1889d5d02a01a7831d';

        // 이미지 업로드 헬퍼 함수들
        window.fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };

        window.resizeImage = (file, maxWidth, maxHeight, quality = 0.9) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth || height > maxHeight) {
                            const ratio = Math.min(maxWidth / width, maxHeight / height);
                            width = width * ratio;
                            height = height * ratio;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob((blob) => {
                            if (blob) {
                                const reader = new FileReader();
                                reader.onloadend = () => resolve(reader.result);
                                reader.onerror = reject;
                                reader.readAsDataURL(blob);
                            } else {
                                reject(new Error('이미지 리사이징 실패'));
                            }
                        }, file.type || 'image/png', quality);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        };

        window.uploadImageToImgBB = async (base64Image, fileName) => {
            try {
                const base64Data = base64Image.split(',')[1] || base64Image;
                const formData = new FormData();
                formData.append('key', IMGBB_API_KEY);
                formData.append('image', base64Data);
                formData.append('name', fileName || 'image');

                const response = await fetch('https://api.imgbb.com/1/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.success && data.data && data.data.url) {
                    return {
                        success: true,
                        url: data.data.url,
                        deleteUrl: data.data.delete_url || null,
                        id: data.data.id
                    };
                } else {
                    throw new Error(data.error?.message || data.error || '이미지 업로드 실패');
                }
            } catch (error) {
                console.error('ImgBB 업로드 오류:', error);
                throw error;
            }
        };

        // 다음 우편번호 서비스 함수
        window.openDaumPostcode = (onComplete) => {
            new daum.Postcode({
                oncomplete: function(data) {
                    const roadAddress = data.roadAddress;
                    const jibunAddress = data.jibunAddress || data.autoJibunAddress;
                    const zonecode = data.zonecode;
                    const buildingName = data.buildingName;
                    
                    onComplete({
                        roadAddress: roadAddress,
                        jibunAddress: jibunAddress,
                        zipCode: zonecode,
                        buildingName: buildingName
                    });
                },
                width: '100%',
                height: '100%'
            }).open();
        };

        // 캘린더 다운로드 함수
        window.generateAndDownloadCalendar = (seminar) => {
            const parts = seminar.date.match(/(\d{4})[\.-](\d{2})[\.-](\d{2})/);
            if (!parts) {
                console.error('날짜 형식 오류');
                return;
            }
            const startStr = `${parts[1]}${parts[2]}${parts[3]}T090000`;
            let endHour = 9 + 2;
            let endStr = `${parts[1]}${parts[2]}${parts[3]}T${endHour.toString().padStart(2,'0')}0000`;
            const icsContent = `BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nDTSTART:${startStr}\nDTEND:${endStr}\nSUMMARY:${seminar.title}\nDESCRIPTION:${seminar.desc}\nLOCATION:${seminar.location}\nEND:VEVENT\nEND:VCALENDAR`;
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.setAttribute('download', `${seminar.title}.ics`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // CONFIG를 window에 노출 (레거시 코드 호환성)
        window.CONFIG = {
            PORTONE: { IMP_CODE: PORTONE_IMP_CODE },
            IMGBB: { API_KEY: IMGBB_API_KEY },
            PUBLIC_DATA_API: { API_KEY: '' }
        };
    </script>

    <!-- Vite 엔트리 포인트 -->
    <script type="module" src="/src/main.jsx"></script>
</body>
</html>
