# Firestore 인덱스 생성 가이드

## Firebase Console에서 인덱스 생성하기

### 1단계: Firebase Console 접속

1. 브라우저에서 [Firebase Console](https://console.firebase.google.com) 접속
2. Google 계정으로 로그인
3. 프로젝트 선택: **bcsa-b190f**

### 2단계: Firestore Database 접속

1. 왼쪽 메뉴에서 **Firestore Database** 클릭
2. 상단 탭에서 **인덱스** 클릭
3. **인덱스 만들기** 버튼 클릭

---

## 인덱스 1: 북마크 조회 (getBookmarkByBidNo)

이 인덱스는 특정 입찰공고가 북마크되어 있는지 확인할 때 사용됩니다.

### 설정 값:

- **컬렉션 ID**: `bookmarks`
- **쿼리 범위**: 컬렉션

### 필드 추가:

1. **첫 번째 필드:**
   - 필드 경로: `userId`
   - 정렬: 오름차순 (Ascending)
   - 추가 버튼 클릭

2. **두 번째 필드:**
   - 필드 경로: `bidNtceNo`
   - 정렬: 오름차순 (Ascending)
   - 추가 버튼 클릭

3. **세 번째 필드:**
   - 필드 경로: `bidNtceOrd`
   - 정렬: 오름차순 (Ascending)
   - 추가 버튼 클릭

### 최종 확인:

- 컬렉션 ID: `bookmarks`
- 필드: `userId` (오름차순), `bidNtceNo` (오름차순), `bidNtceOrd` (오름차순)
- 쿼리 범위: 컬렉션

**만들기** 버튼 클릭

---

## 인덱스 2: 사용자 북마크 목록 (getUserBookmarks)

이 인덱스는 사용자의 모든 북마크를 시간순으로 조회할 때 사용됩니다.

### 설정 값:

- **컬렉션 ID**: `bookmarks`
- **쿼리 범위**: 컬렉션

### 필드 추가:

1. **첫 번째 필드:**
   - 필드 경로: `userId`
   - 정렬: 오름차순 (Ascending)
   - 추가 버튼 클릭

2. **두 번째 필드:**
   - 필드 경로: `bookmarkedAt`
   - 정렬: 내림차순 (Descending)
   - 추가 버튼 클릭

### 최종 확인:

- 컬렉션 ID: `bookmarks`
- 필드: `userId` (오름차순), `bookmarkedAt` (내림차순)
- 쿼리 범위: 컬렉션

**만들기** 버튼 클릭

---

## 인덱스 3: 검색 로그 (searchLogs)

이 인덱스는 검색 로그를 시간순으로 조회할 때 사용됩니다.

### 설정 값:

- **컬렉션 ID**: `searchLogs`
- **쿼리 범위**: 컬렉션

### 필드 추가:

1. **첫 번째 필드:**
   - 필드 경로: `searchedAt`
   - 정렬: 내림차순 (Descending)
   - 추가 버튼 클릭

### 최종 확인:

- 컬렉션 ID: `searchLogs`
- 필드: `searchedAt` (내림차순)
- 쿼리 범위: 컬렉션

**만들기** 버튼 클릭

---

## 인덱스 생성 완료 확인

### 인덱스 상태 확인

1. Firestore Database > 인덱스 탭에서 생성한 인덱스 확인
2. 각 인덱스의 상태가 **"사용 가능"**으로 변경될 때까지 대기
3. 보통 1-2분 정도 소요됩니다

### 생성된 인덱스 목록

다음 3개의 인덱스가 모두 "사용 가능" 상태여야 합니다:

- ✅ `bookmarks` - userId, bidNtceNo, bidNtceOrd (오름차순)
- ✅ `bookmarks` - userId (오름차순), bookmarkedAt (내림차순)
- ✅ `searchLogs` - searchedAt (내림차순)

---

## 자동 인덱스 생성 (대안)

만약 인덱스를 수동으로 생성하기 전에 쿼리를 실행하면, Firebase가 자동으로 인덱스 생성 링크를 제공합니다.

### 브라우저 콘솔에서 인덱스 생성

1. 웹사이트에서 입찰공고 검색 기능 사용
2. 브라우저 개발자 도구 > Console 탭 열기
3. 인덱스 생성 링크가 표시되면 클릭
4. Firebase Console에서 인덱스 생성 페이지로 이동
5. **인덱스 만들기** 버튼 클릭

---

## 문제 해결

### 인덱스가 생성되지 않는 경우

1. 필드 이름이 정확한지 확인 (대소문자 구분)
2. 컬렉션 ID가 정확한지 확인
3. 정렬 순서가 올바른지 확인
4. Firebase Console에서 인덱스 생성 오류 메시지 확인

### 인덱스 상태가 "빌드 중"인 경우

- 인덱스 생성에는 시간이 걸립니다 (보통 1-2분)
- 데이터가 많을수록 더 오래 걸릴 수 있습니다
- "사용 가능" 상태가 될 때까지 기다려주세요

### 인덱스 오류가 발생하는 경우

1. Firestore Database > 인덱스 탭에서 오류 메시지 확인
2. 오류가 있는 인덱스 삭제 후 다시 생성
3. 필드 이름과 정렬 순서를 다시 확인

---

## 참고

- 인덱스는 한 번 생성하면 자동으로 유지됩니다
- 데이터가 추가/수정/삭제될 때마다 인덱스가 자동으로 업데이트됩니다
- 인덱스는 Firestore의 읽기 성능을 향상시킵니다
- 복합 쿼리를 사용할 때는 반드시 인덱스가 필요합니다


