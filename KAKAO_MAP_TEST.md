# 카카오맵 API 테스트 가이드

## 1. API Key 확인

- **현재 API Key**: `f35b8c9735d77cced1235c5775c7c3b1`
- **위치**: `src/hooks/useKakaoMap.js:47`
- **라이브러리**: services (주소 검색, 장소 검색)

## 2. 카카오맵 사용 위치

### 2.1 ProgramManagement (프로그램 관리)
- **파일**: `src/pages/Admin/components/ProgramManagement.jsx`
- **기능**: 프로그램 등록 시 장소 선택
- **사용 컴포넌트**: `KakaoMapModal`

### 2.2 RestaurantForm (맛집 등록)
- **파일**: `src/App.jsx` (RestaurantFormView 컴포넌트 내)
- **기능**: 맛집 등록 시 장소 선택
- **사용 컴포넌트**: `KakaoMapModal`

## 3. 테스트 방법

### 3.1 프로그램 관리에서 테스트

1. **Admin 페이지 접속**
   - URL: `http://localhost:5173/admin`
   - 마스터 코드 입력: `0219`

2. **프로그램 관리 탭 선택**
   - 좌측 사이드바에서 "프로그램 관리" 클릭

3. **프로그램 추가**
   - "프로그램 추가" 버튼 클릭
   - 프로그램 정보 입력 폼 표시

4. **장소 선택 버튼 클릭**
   - "장소 선택" 또는 "카카오맵에서 선택" 버튼 클릭
   - 카카오맵 모달 열림

5. **카카오맵 모달 테스트**
   - ✅ 지도가 정상적으로 로딩되는지 확인
   - ✅ 기본 위치: 부산 중심 (35.1796, 129.0756)
   - ✅ 줌 컨트롤 표시 확인

6. **장소 검색 테스트**
   ```
   검색어 예시:
   - "부산 해운대구"
   - "센텀시티"
   - "부산역"
   - "해운대 센텀2로 25"
   ```
   - ✅ 검색 결과가 표시되는지 확인
   - ✅ 검색 결과 클릭 시 지도 이동 확인
   - ✅ 마커 표시 확인

7. **지도 클릭 테스트**
   - ✅ 지도를 직접 클릭하여 위치 선택
   - ✅ 마커 이동 확인
   - ✅ 역지오코딩으로 주소 표시 확인

8. **장소 확정**
   - ✅ 선택된 장소 정보 표시 확인 (노란색 박스)
   - ✅ "선택 완료" 버튼 클릭
   - ✅ 폼에 장소 정보 자동 입력 확인

## 4. 예상 동작

### 4.1 정상 동작
- 카카오맵 SDK 로딩 완료 메시지: "카카오맵이 로드되었습니다"
- 지도 정상 표시 (부산 중심)
- 검색 기능 정상 작동
- 마커 표시 및 이동
- 좌표 → 주소 변환 (역지오코딩)
- 장소 선택 완료 시 정보 반환

### 4.2 오류 발생 시
- **SDK 로드 실패**: 빨간색 오류 모달 표시
- **검색 결과 없음**: "검색 결과가 없습니다" 알림
- **지도 로딩 중**: "지도 로딩 중..." 스피너 표시

## 5. 카카오맵 Hook (useKakaoMap)

### 5.1 제공 기능
```javascript
const { 
  kakao,           // 카카오맵 객체
  isLoaded,        // 로딩 완료 여부
  isError,         // 오류 발생 여부
  error,           // 오류 객체
  geocodeAddress,  // 주소 → 좌표 변환
  reverseGeocode,  // 좌표 → 주소 변환
  searchPlaces     // 장소 검색
} = useKakaoMap();
```

### 5.2 사용 예시
```javascript
// 장소 검색
const results = await searchPlaces('부산 해운대구');

// 주소를 좌표로 변환
const { lat, lng } = await geocodeAddress('부산 해운대구 센텀2로 25');

// 좌표를 주소로 변환
const address = await reverseGeocode(35.1796, 129.0756);
```

## 6. 테스트 체크리스트

### 기본 기능
- [ ] 카카오맵 SDK 정상 로드
- [ ] 지도 표시
- [ ] 줌 컨트롤 작동
- [ ] 지도 클릭 이벤트

### 검색 기능
- [ ] 키워드 검색 (장소명)
- [ ] 주소 검색
- [ ] 검색 결과 표시
- [ ] 검색 결과 클릭 시 지도 이동

### 마커 기능
- [ ] 마커 표시
- [ ] 마커 이동
- [ ] 클릭 시 마커 위치 변경

### 지오코딩
- [ ] 역지오코딩 (좌표 → 주소)
- [ ] 주소 표시
- [ ] 도로명 주소 우선 표시

### 장소 선택
- [ ] 선택된 장소 정보 표시
- [ ] 장소 확정 버튼 작동
- [ ] 장소 정보 폼 자동 입력

## 7. 문제 해결

### 카카오맵이 로드되지 않는 경우
1. API Key가 유효한지 확인
2. 인터넷 연결 확인
3. 브라우저 콘솔에서 오류 메시지 확인
4. 카카오맵 SDK 스크립트 로드 확인:
   ```javascript
   console.log(window.kakao);
   console.log(window.kakao?.maps);
   ```

### 검색이 작동하지 않는 경우
1. `libraries=services` 파라미터 확인
2. 카카오맵 SDK 로드 완료 후 검색 시도
3. 검색어가 비어있지 않은지 확인

### 지도 클릭이 작동하지 않는 경우
1. 지도가 완전히 로드되었는지 확인
2. 이벤트 리스너 등록 확인
3. 브라우저 콘솔에서 오류 확인

## 8. 성능 최적화

- SDK는 한 번만 로드 (useEffect 의존성 배열 비어있음)
- 스크립트 중복 로드 방지 (existingScript 체크)
- 타임아웃 설정 (5초)
- 비동기 로딩 (async=true)

## 9. 추가 참고사항

### 카카오맵 API 문서
- https://apis.map.kakao.com/web/

### 제한사항
- 무료 API: 일일 300,000건
- 유료 전환 시 더 많은 요청 가능
- API Key는 도메인 제한 가능 (현재 미설정)

## 10. 테스트 결과 (2026-01-27)

### 테스트 환경
- URL: http://localhost:3001/admin
- 브라우저: Chromium
- 카카오맵 Hook: `src/hooks/useKakaoMap.js`
- 카카오맵 Modal: `src/pages/Admin/components/KakaoMapModal.jsx`

### 테스트 결과

#### ✅ 성공 항목
- Admin 페이지 접속 성공
- 프로그램 관리 탭 정상 작동
- 프로그램 추가 모달 정상 표시
- 카카오맵 모달 정상 열림
- 메뉴 관리 탭 정상 추가 (드래그앤드롭 기능 포함)

#### ❌ 실패 항목
- **카카오맵 SDK 로드 실패**
  - 오류 메시지: "카카오맵 SDK 로드 타임아웃"
  - 원인: SDK 스크립트 로드 실패 (script.onerror 발생)
  - 네트워크 요청: `https://dapi.kakao.com/v2/maps/sdk.js?appkey=f35b8c9735d77cced1235c5775c7c3b1&libraries=services&autoload=false` 전송됨
  
### 문제 원인 분석

1. **API Key 문제 가능성**
   - 현재 API Key: `f35b8c9735d77cced1235c5775c7c3b1`
   - API Key가 유효하지 않거나 만료되었을 수 있음
   - 도메인 제한이 설정되어 localhost가 차단되었을 수 있음

2. **네트워크 문제**
   - 스크립트는 요청되었으나 응답이 오지 않음
   - CORS 문제 또는 카카오 서버 문제일 수 있음

### 해결 방법

1. **카카오 개발자 콘솔 확인**
   - https://developers.kakao.com/console
   - API Key 상태 확인
   - 도메인 설정 확인 (localhost, 127.0.0.1 추가)
   - 플랫폼 설정: Web 플랫폼 등록

2. **새 API Key 발급**
   - 기존 키가 문제라면 새로 발급
   - `src/hooks/useKakaoMap.js:47` 수정

3. **대체 방안**
   - Google Maps API 사용 고려
   - 직접 주소 입력 방식 유지

### 권장사항
카카오맵 API Key를 카카오 개발자 콘솔에서 확인하고, localhost를 허용 도메인에 추가한 후 다시 테스트해주세요.
